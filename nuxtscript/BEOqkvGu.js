import{I as D,i as f,u as U,O as q,m as N,r as c,e as G,ay as Y,a5 as j,ai as x,l as H}from"./cyCOdGck.js";import{U as W}from"./D2ZKPdBb.js";const Q=D("auth",()=>{const{$client:r}=f(),{CONSTANTS:h,DEV:z,PROD:B}=U().public,{LOCAL_STORAGE_DAY:p}=h,{showMenu:d,hideMenu:m,getIsDrawerShowing:g}=q(),l=N(),u=c({id_user:-1,email:"",picture:"",name:""}),a=c({access:"",refresh:""}),s=c({prevFooterMenuIsVisible:!0,prevRoutePath:"",isModalOpen:!1,success:!1,clientInfo:{ip:""},logInPath:""}),o=G();async function I(){if(a.access)return!!a.access;const{$client:t}=f();a.access=Y("access_token").value||"";const e=await t.user.initAuth.mutate({token:a.access});if(s.success=e.isSuccess,e.isSuccess||console.log(`SYSTEM => initAuth: ${e.message}`),e.user&&!j.chckIsEmpty(e.user)){const{id_user:n,email:i,picture:V,name:$}=e.user;u.id_user=n,u.email=i,u.picture=V,u.name=$}return e.isSuccess&&!a.access&&(a.access=e.token??""),s.clientInfo=e.clientInfo,e.isSuccess}function v(){return u}function w(){return s.success&&u.id_user>0&&!!u.email}function S(){return a.access}function M(){return s.clientInfo}async function O(t,e,n=!1){const i=await r.user.logIn.mutate({email:t,pwd:e,rememberMe:n});return i.isEmailAuth?i.isPwdMatched?i.datas.length?(a.access=i.datas[1],a.refresh=i.datas[2],i.datas):"인터넷이 불안정해요. 다시 시도해주세요":"비밀번호가 맞지 않습니다":"등록된 이메일이 아니에요. 회원가입이나 오탈자를 잘 봐주세요"}async function P(t,e){a.access="",a.refresh="",u.id_user=-1,u.email="",u.picture="",u.name="",await r.user.logOut.mutate(),W.setItem(p,{logInLastWelcome:""}),setTimeout(()=>{t&&t(),e?x(e):location.reload()},1e3)}function y(t){o.value=t}function A(){return s.isModalOpen}function R(){s.isModalOpen=!0,g()?s.prevFooterMenuIsVisible=!0:s.prevFooterMenuIsVisible=!1}function b(){const t=H();s.isModalOpen=!1,s.prevFooterMenuIsVisible&&d();const e=window.history.state.current;if(e!=null&&e.includes&&(e.includes("/auth/email")||e.includes("/auth/confirmation")||e.includes("/auth/retrieve")))return;const n=s.prevRoutePath||t.path;window.history.pushState({},"",n),s.prevRoutePath=""}function T(t,e,n=()=>{}){if(s.prevRoutePath=e.fullPath,t.fullPath!=="/auth"||t.fullPath==="/auth/email")return n();if(s.isModalOpen=!0,window.history.pushState({},"",t.path),!o.value)return l.push(e.href);o.value.show(),m()}async function _(t="",e=""){const n={path:"/auth"};t&&(n.query={email:t}),s.logInPath=e,await l.push(n)}function k(){o.value&&o.value.hide()}function L(){return s.isModalOpen}const C=()=>s.logInPath;async function E(t,e){return await r.user.update.mutate({email:t,name:e})}function F(t,e,n){}return{getUserToken:S,getClientInfo:M,initAuth:I,getProfile:v,isAuth:w,logIn:O,logOut:P,register:y,isOpen:A,seqShow:R,seqHide:b,beforeRouteLeave:T,show:_,hide:k,getIsModalOpen:L,getLogInPath:C,update:E,mountedGoogle:F}});export{Q as u};
