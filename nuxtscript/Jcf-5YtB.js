import"./B5Qt9EMX.js";const l={timeMerge:200,tileSize:100,tweenSpeed:50,tileSpacing:5,COLUM:10,ROW:10,START_DIAMOND:500,BLOCK_BODER_ALPHA:.7,BLOCK_SCALE_DEFAULT:.25,TITLE_SCALE_DEFAULT:.3,CIRCLE_BODER_SCALE_DEFAULT:.26,BG_COLOR:"0xFDEFEB",CHECK_SOUND:!0};class S extends Phaser.GameObjects.Image{constructor(e,n,a,o,i){super(e,n,a,o,i),this.x=n,this.y=a,this.texture=o,this.scale=.43,this.tint="0xffffff",e.add.existing(this)}}class I{constructor(){}BtnClickAnim(e,n,a){e.tweens.add({targets:n,scale:{from:n.scale-.15,to:n.scale},ease:"Bounce",duration:500,onComplete:H.bind(e,a)})}ObjectMove(e,n,a,o){e.tweens.add({targets:n,props:{x:{value:a,duration:800,ease:"Bounce"},y:{value:o,duration:800,ease:"Bounce"}}})}}function H(t){switch(t){case"btnSound":break;case"btnHome":this.scene.start("game_menu");break;case"btnReload":this.scene.start("game_play");break;case"btnPlay":this.scene.start("game_play");break}}class R{constructor(){}SoundPlay(e,n){if(l.CHECK_SOUND)if(n=="bg_music"){let a=e.sound.add(n);a.play(),a.setLoop(!0)}else e.sound.play(n)}}const j=Phaser.Math.Between;let y,w=0,U=0,L=!1,_=[1,2,3],W=["0xFF3131","0xCB6CE6","0x00BF63","0x5E17EB","0x0097B2","0x7ED957","0xFF914D","0x5CE1E6"],p=[],s=[],u=[],h=[],O;class N extends Phaser.Scene{constructor(){super({key:"game_play"})}create(){this.cameras.main.fadeIn(500,0,0,0),O=new R,G(this),de(this),ue(this),ce(this),re(this),localStorage.getItem("tutorial")==null&&D(this)}}function G(t){let e=357,n=78;t.add.rectangle(360,640,2e3,2e3,l.BG_COLOR);let a,o=2.5;s=[],w=0;for(var i=0;i<l.ROW;i++){s[i]=[],p[i]=[];for(var d=0;d<l.COLUM;d++)a=t.add.image(n,e,"block").setScale(l.TITLE_SCALE_DEFAULT),a.alpha=.8,a.tint="0x6e85d8",a.visible=1,a.depth=-1,p[i][d]=a,k(t,a.x,a.y,s,i,d),n+=a.width*a.scale+o;e+=a.width*a.scale+o,n=78}}function k(t,e,n,a,o,i){let d=j(1,_.length),c=t.add.image(0,0,"circle_boder").setScale(l.CIRCLE_BODER_SCALE_DEFAULT);c.tint="0x004AAD",c.visible=!1;let f=t.add.image(0,0,"circle").setScale(l.BLOCK_SCALE_DEFAULT);f.tint=W[d-1];let r=t.add.container(e,n,[f,c]);return r.setSize(f.width*l.BLOCK_SCALE_DEFAULT,f.height*l.BLOCK_SCALE_DEFAULT),r.i=o,r.j=i,r.check=!1,r.value=d,r.can_merge=!1,r.selected=!1,a[o][i]=r,r.setInteractive(),r.on("pointerdown",function(){L=!0,h=[],u=[],U=r.value,r.selected=!0;let b=r.list[1];M(t,b,this),u.push(this),P(t,this)}),r.on("pointerover",function(){K(t,this)}),t.input.on("pointerup",function(){z(t)}),t.tweens.add({targets:r,props:{alpha:{value:1,duration:1e3,ease:"linear"}}}),r}function K(t,e){if(e.value==U&&e.can_merge==!0)if(u.indexOf(e)==-1){let n=u[u.length-1];e.scale=1,e.selected=!0;let a=e.list[1];M(t,a,e),$(t,n,e,e.list[0].tint),u.push(e),P(t,e)}else h[h.length-1].destroy(),h.splice(h.length-1,1),u[u.length-1].list[1].visible=!1,u.splice(u.length-1,1),P(t,e)}function M(t,e,n){e.visible=!0,e.tint=n.list[0].tint,e.scale=.3,t.tweens.add({targets:e,props:{scale:{value:e.scale+.1,duration:500,ease:"Bounce"},alpha:{value:.2,duration:500,ease:"Bounce"}},repeat:-1})}function z(t,e){L==!0&&(Y(t),F(),L=!1)}function P(t,e){for(let B=0;B<l.ROW;B++)for(let E=0;E<l.ROW;E++){let A=s[B][E];A!=null&&(A.can_merge=!1)}let n=e.i,a=e.j,o=e.value,i=ee(n,a);i!=null&&i.value==o&&i.can_merge==!1&&g(i);let d=te(n,a);d!=null&&d.value==o&&d.can_merge==!1&&g(d);let c=ne(n,a);c!=null&&c.value==o&&c.can_merge==!1&&g(c);let f=ae(n,a);f!=null&&f.value==o&&f.can_merge==!1&&g(f);let r=oe(n,a);r!=null&&r.value==o&&r.can_merge==!1&&g(r);let b=ie(n,a);b!=null&&b.value==o&&b.can_merge==!1&&g(b);let C=le(n,a);C!=null&&C.value==o&&C.can_merge==!1&&g(C);let x=se(n,a);x!=null&&x.value==o&&x.can_merge==!1&&g(x)}function g(t){t.setScale(1),t.can_merge=!0}const q=t=>new Promise(e=>setTimeout(e,t));async function Y(t){if(u.length>1){Z(t,u.length*5);for(let e=0;e<u.length;e++){const n=u[e];let a=n.list[0].tint;fe(t,n,a),Q(t,n,5),n.destroy(),s[n.i][n.j]=void 0,O.SoundPlay(t,"merge"),await q(100)}X(t)}else F();u=[]}function F(t){for(let e=0;e<l.ROW;e++)for(let n=0;n<l.ROW;n++){let a=s[e][n];a!=null&&(a.scale=1,a.can_merge=!1,a.selected=!1,a.list[1].visible=!1,a.list[1].scale=.3)}h.forEach(e=>{e.destroy()})}function $(t,e,n,a){const o=t.add.graphics();o.lineStyle(10,a,1),o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(n.x,n.y),o.closePath(),o.strokePath(),h.push(o)}function V(t){for(let e=0;e<l.ROW;e++)for(let n=0;n<l.COLUM;n++)if(e<l.ROW-1&&s[e][n]==null){let a=k(t,p[e][n].x,100,s,e,n);t.tweens.add({targets:a,props:{x:{value:p[e][n].x,duration:50,ease:"Linear"},y:{value:p[e][n].y,duration:50,ease:"Linear"}}})}}function X(t){for(let e=0;e<l.ROW;e++)J();setTimeout(function(){for(let e=0;e<l.ROW;e++)V(t)},100)}function J(t){for(let e=0;e<l.ROW;e++)for(let n=0;n<l.COLUM;n++)e<l.ROW-1&&s[e+1][n]==null&&s[e][n]!=null&&(s[e][n].setPosition(p[e+1][n].x,p[e+1][n].y),s[e+1][n]=s[e][n],s[e+1][n].i=e+1,s[e+1][n].j=n,s[e][n].alpha=1,s[e][n]=void 0)}function Q(t,e,n,a){let o=t.add.text(e.x,e.y,"+"+n,{font:"25px Arial Black",fill:"#fff"});o.setStroke("#00f",10),t.tweens.add({targets:o,props:{y:{value:o.y-50,duration:500,ease:"Bounce"}},onComplete:function(){o.destroy()}})}function Z(t,e){let n=w+e,a=w;t.tweens.addCounter({from:a,to:n,duration:500,ease:"linear",onUpdate:i=>{const d=Math.round(i.getValue());y.text=d},onComplete:function(){w=parseInt(y.text)}});let o=_.length*500-1500;if(n>o+500){let i=_[_.length-1]+1;i<9&&_.push(i)}}function ee(t,e){return t<=0?null:s[t-1][e]}function te(t,e){return t>=l.ROW-1?null:s[t+1][e]}function ne(t,e){return e<=0?null:s[t][e-1]}function ae(t,e){return e>=l.COLUM?null:s[t][e+1]}function oe(t,e){return t<=0||e<=0?null:s[t-1][e-1]}function le(t,e){return e<=0||t>=l.ROW-1?null:s[t+1][e-1]}function ie(t,e){return t<=0||e>=l.COLUM?null:s[t-1][e+1]}function se(t,e){return e>=l.COLUM||t>=l.ROW-1?null:s[t+1][e+1]}function re(t){let e=new S(t,0,0,"boder").setScale(.3),n=new S(t,0,0,"btnHome");n.setScale(.3);let a=t.add.container(50,50,[e,n]);a.setSize(100,100),a.setInteractive(),a.on("pointerdown",function(o){O.SoundPlay(t,"click"),t.tweens.add({targets:a,scale:{from:a.scale-.15,to:a.scale},ease:"Bounce",duration:500,onComplete:function(){t.cameras.main.fadeOut(500,0,0,0)}})}),t.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(o,i)=>{t.scene.start("game_menu")})}function de(t){localStorage.getItem("hscore"),y=t.add.text(360,160,0,{font:"75px Arial Black",fill:"#fff",align:"center"}).setOrigin(.5,.5),y.setStroke("#000",10)}function ue(t){let e=new S(t,650,50,"boder").setScale(.3).setInteractive(),n=new S(t,e.x,e.y,"btnSoundOn");n.setScale(.3),e.on("pointerdown",function(a){t.tweens.add({targets:n,scale:{from:n.scale-.15,to:n.scale},ease:"Bounce",duration:500,onComplete:function(){l.CHECK_SOUND?(t.sound.stopAll(),l.CHECK_SOUND=!1,n.setTexture("btnSoundOff")):(l.CHECK_SOUND=!0,O.SoundPlay(t,"bg_music"),n.setTexture("btnSoundOn"))}})})}function ce(t){let e=new S(t,580,50,"boder").setScale(.3).setInteractive(),n=new S(t,e.x,e.y,"btnInfo");n.setScale(.3),e.on("pointerdown",function(a){O.SoundPlay(t,"click"),t.tweens.add({targets:n,scale:{from:n.scale-.15,to:n.scale},ease:"Bounce",duration:500,onComplete:function(){D(t)}})})}function D(t){{let e=t.add.rectangle(360,640,2e3,2e3,"0x000000");e.alpha=.9;let n=t.add.image(360,640,"tutorial").setInteractive(),a=t.add.container(0,0,[e,n]);n.on("pointerdown",function(o){a.setPosition(-2e3,-2e3),localStorage.setItem("tutorial","show")})}}function fe(t,e,n){t.add.particles(0,0,"circle",{x:e.x,y:e.y,speed:{min:-600,max:600},angle:{min:0,max:360},scale:{start:.1,end:0},color:[n],frequency:5,lifespan:600,gravityY:800,quantity:3,maxParticles:15})}class ge extends Phaser.Scene{constructor(){super({key:"preload"})}preload(){var e=this.add.graphics();this.add.graphics();var n=720,a=1280,o=this.make.text({x:n/2,y:a/2+20,text:"0%",style:{font:"18px monospace",fill:"#ffffff"}});o.setOrigin(.5,.5),this.load.on("progress",function(i){o.setText(parseInt(i*100)+"%"),e.clear(),e.fillStyle(16734039,1),e.fillRect(206,1280/2+8,300*i,25)}),this.load.bitmapFont("popin","assets/fonts/popin.png","assets/fonts/popin.xml"),this.load.audio("merge","assets/audio/merge.wav"),this.load.audio("bg_music","assets/audio/bg.mp3"),this.load.audio("click","assets/audio/button_click.mp3"),this.load.image("circle","assets/image/circle.png"),this.load.image("circle_boder","assets/image/circle_boder.png"),this.load.image("title","assets/image/color_title.png"),this.load.image("btnSoundOn","assets/image/btnSoundOn.png"),this.load.image("btnSoundOff","assets/image/btnSoundOff.png"),this.load.image("btnInfo","assets/image/btnInfo.png"),this.load.image("btnPlay","assets/image/btnPlay.png"),this.load.image("btnReload","assets/image/btnReload.png"),this.load.image("btnHome","assets/image/btnHome.png"),this.load.image("crown","assets/image/crown.png"),this.load.image("boder","assets/image/boder.png"),this.load.image("light","assets/image/light.png"),this.load.image("block","assets/image/block.png"),this.load.image("tutorial","assets/image/tutorial.png")}create(){this.music_bg=this.sound.add("bg_music"),this.music_bg.play(),this.music_bg.setLoop(!0),this.scene.start("game_menu")}}class me extends Phaser.Scene{constructor(){super({key:"game_menu"})}create(){window.UtilPlatform.sendMsg2Parent("ShowNavFooterPlay"),this.add.rectangle(360,640,2e3,2e3,l.BG_COLOR),he(this),this.cameras.main.fadeIn(300,0,0,0)}}let v,T;function he(t){v=new I,T=new R;let e=t.add.image(0,640,"btnPlay").setScale(1).setInteractive();e.on("pointerdown",function(a){window.UtilPlatform.sendMsg2Parent("HideNavFooterPlay"),v.BtnClickAnim(t,e,"btnPlay"),T.SoundPlay(t,"click")}),v.ObjectMove(t,e,360,640);let n=t.add.image(360,-1e3,"title").setScale(1);v.ObjectMove(t,n,360,400)}class pe extends Phaser.Scene{constructor(){super({key:"game_over"})}create(){be(this)}}let m;function be(t){let e=localStorage.getItem("hscore");e==null&&(e=0),t.add.rectangle(360,640,600,1e3,"0xEFE230");let n=t.add.image(260,-1e3,"crown").setScale(.8),a=t.add.text(300,-1e3,e,{fontFamily:"lovelo",fontSize:"102px",color:"#FF3131"});a.setAlign("left"),m=new I;let o=t.add.image(260,2e3,"btnReload").setScale(.8).setInteractive();o.on("pointerdown",function(c){m.BtnClickAnim(t,o,"btnReload")});let i=t.add.image(460,2e3,"btnHome").setScale(.8).setInteractive();i.on("pointerdown",function(c){m.BtnClickAnim(t,i,"btnHome")}),m.ObjectMove(t,o,260,940),m.ObjectMove(t,i,460,940),m.ObjectMove(t,n,260,640),m.ObjectMove(t,a,360,580);let d=t.add.image(360,-1e3,"title").setScale(2);m.ObjectMove(t,d,360,400)}window.onload=function(){let t={type:Phaser.AUTO,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,parent:"game",width:720,height:1280},backgroundColor:l.BG_COLOR,scene:[ge,me,N,pe]};new Phaser.Game(t)};
