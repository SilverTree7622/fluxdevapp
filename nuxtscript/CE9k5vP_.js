import"./B5Qt9EMX.js";const r={timeMerge:200,tileSize:100,tweenSpeed:50,tileSpacing:5,COLUM:10,ROW:10,START_DIAMOND:500,BLOCK_BODER_ALPHA:.7,BLOCK_SCALE_DEFAULT:.3};class me extends Phaser.GameObjects.Container{constructor(e,a,n,o){super(e,a,n,o),e.add.existing(this)}}class S extends Phaser.GameObjects.Image{constructor(e,a,n,o,i){super(e,a,n,o,i),this.x=a,this.y=n,this.texture=o,this.scale=.43,this.tint="0xffffff",e.add.existing(this)}}class M extends Phaser.GameObjects.BitmapText{constructor(e,a,n,o,i,d,s){super(e,a,n-10,o,i,d,s),this.setOrigin(.5),this.tint=s,this.align=1,this.setCenterAlign(),e.add.existing(this)}updateText(e){this.setText(e)}}class F{constructor(){}BtnClickAnim(e,a,n){e.tweens.add({targets:a,scale:{from:a.scale-.15,to:a.scale},ease:"Bounce",duration:500,onComplete:D.bind(e,n)})}ObjectMove(e,a,n,o){e.tweens.add({targets:a,props:{x:{value:n,duration:800,ease:"Bounce"},y:{value:o,duration:800,ease:"Bounce"}}})}}function D(t){switch(t){case"btnSound":break;case"btnHome":this.scene.start("game_menu");break;case"btnReload":this.scene.start("game_play");break;case"btnPlay":this.scene.start("game_play");break}}const G=Phaser.Math.Between;let U,_=0,L=0,P=!0,A=0,v,y,w=[1,2,3],O=[],l=[],x=[],C=0;class K extends Phaser.Scene{constructor(){super({key:"game_play"})}create(){this.cameras.main.fadeIn(500,0,0,0),z(this),ne(this),ie(this),oe(this),ae(this),localStorage.getItem("tutorial")==null&&N(this)}}function z(t){let e=357,a=78;t.add.rectangle(360,640,2e3,2e3,"0x2f0045"),t.add.image(360,640,"grid").setScale(.9);let n,o=2.5;l=[],w=[1,2,3],_=0;for(var i=0;i<r.ROW;i++){l[i]=[],O[i]=[];for(var d=0;d<r.COLUM;d++)n=t.add.image(a,e,"block").setScale(r.BLOCK_SCALE_DEFAULT),n.alpha=.8,n.tint="0x6e85d8",n.visible=1,n.depth=-1,O[i][d]=n,E(t,n.x,n.y,l,i,d),a+=n.width*n.scale+o;e+=n.width*n.scale+o,a=78}}function E(t,e,a,n,o,i){let d=G(1,w.length),s=t.add.image(e,a,"nb"+d).setScale(r.BLOCK_SCALE_DEFAULT);return s.setDataEnabled(),s.data.set("i",o),s.data.set("j",i),s.data.set("value",d),s.data.set("check",!1),n[o][i]=s,s.setInteractive().on("pointerdown",function(){$(t,this)}),s}function $(t,e){y=!0;let a;if(C++,C==1)H(t,e),v=0,y&&(t.tweens.add({targets:e,props:{scale:{value:e.scale-.1,duration:500,ease:"Bounce"}},yoyo:!0}),C=0);else{if(X(e)){let n=e.data.get("value"),o=e.data.get("i"),i=e.data.get("j");for(let d=0;d<r.COLUM;d++)for(let s=0;s<r.ROW;s++){const f=l[d][s];f!=null&&f.data.get("check")==null&&f!=e&&(v++,v>5&&(v=5),a=t.tweens.chain({targets:f,tweens:[{y:f.y-30,ease:"Linear",duration:300},{x:e.x,y:e.y,ease:"Linear",duration:100*v}],onComplete:function(){let g=t.add.image(e.x,e.y,"boder").setScale(.3);t.tweens.add({targets:g,props:{scale:{value:g.scale+.15,duration:500,ease:"Bounce"},alpha:{value:0,duration:500,ease:"Bounce"}},onComplete:function(){g.destroy()}});let p=f.data.get("value"),c=new M(t,e.x,e.y,"popin","+"+p,30);t.tweens.add({targets:c,props:{y:{value:c.y-60,duration:500,ease:"Bounce"},alpha:{value:0,duration:500,ease:"Bounce"}},onComplete:function(){c.destroy()}}),h(n),l[d][s]=void 0,f.destroy()}}))}a!=null&&a.on("complete",function(){let d=l[o][i];R(t,"merge"),d.scale=r.BLOCK_SCALE_DEFAULT,d.data.set("check",!1),d.data.set("value",n+1),d.setTexture("nb"+(n+1)),n+1>w[w.length-1]&&w.length<9&&w.push(n+1),setTimeout(function(){W(t)},100)})}else for(let n=0;n<r.ROW;n++)for(let o=0;o<r.COLUM;o++)l[n][o]!=null&&(t.tweens.add({targets:l[n][o],props:{scale:{value:r.BLOCK_SCALE_DEFAULT,duration:500,ease:"Bounce"}}}),l[n][o].alpha=1,l[n][o].data.set("check",!1));C=0,v=0}}function q(t){for(let e=0;e<r.ROW;e++)for(let a=0;a<r.COLUM;a++)if(e<r.ROW-1&&l[e][a]==null){let n=E(t,O[e][a].x,100,l,e,a);t.tweens.add({targets:n,props:{x:{value:O[e][a].x,duration:50,ease:"Linear"},y:{value:O[e][a].y,duration:50,ease:"Linear"}}})}}function W(t){for(let e=0;e<r.ROW;e++)Y();setTimeout(function(){for(let e=0;e<r.ROW;e++)q(t)},100),setTimeout(function(){J()&&(t.scene.start("game_over"),console.log("Game Over"))},100)}function Y(t){for(let e=0;e<r.ROW;e++)for(let a=0;a<r.COLUM;a++)e<r.ROW-1&&l[e+1][a]==null&&l[e][a]!=null&&(l[e][a].setPosition(O[e+1][a].x,O[e+1][a].y),l[e+1][a]=l[e][a],l[e+1][a].data.set("i",e+1),l[e+1][a].data.set("j",a),l[e][a].alpha=1,l[e][a]=void 0)}function X(t){return t.data.get("value")==A}function H(t,e){x=[];let a=e.data.get("value"),n=e.data.get("i"),o=e.data.get("j");if(a!=10){if(A=a,n>0){let i=k(n,o);i!=null&&i.data.get("value")==a&&i.data.get("check")==!1&&(t.tweens.add({targets:i,props:{scale:{value:i.scale-.1,duration:500,ease:"Bounce"}}}),i.data.set("check")==!0,y=!1,x.push(i))}if(n<r.ROW-1){let i=T(n,o);i!=null&&i.data.get("value")==a&&i.data.get("check")==!1&&(t.tweens.add({targets:i,props:{scale:{value:i.scale-.1,duration:500,ease:"Bounce"}}}),i.data.set("check")==!0,y=!1,x.push(i))}if(o>0){let i=I(n,o);i!=null&&i.data.get("value")==a&&i.data.get("check")==!1&&(t.tweens.add({targets:i,props:{scale:{value:i.scale-.1,duration:500,ease:"Bounce"}}}),i.data.set("check")==!0,y=!1,x.push(i))}if(o<r.COLUM-1){let i=j(n,o);i!=null&&i.data.get("value")==a&&i.data.get("check")==!1&&(t.tweens.add({targets:i,props:{scale:{value:i.scale-.1,duration:500,ease:"Bounce"}}}),i.data.set("check")==!0,y=!1,x.push(i))}x.forEach(i=>{H(t,i)})}else Q(t,e)}function J(t){for(let e=0;e<r.COLUM;e++)for(let a=0;a<r.ROW;a++){let n=l[e][a],o=n.data.get("value"),i=n.data.get("i"),d=n.data.get("j");if(i>0){let s=k(i,d);if(s!=null&&s.data.get("value")==o&&s.data.get("check")==!1)return!1}if(i<r.ROW-1){let s=T(i,d);if(s!=null&&s.data.get("value")==o&&s.data.get("check")==!1)return!1}if(d>0){let s=I(i,d);if(s!=null&&s.data.get("value")==o&&s.data.get("check")==!1)return!1}if(d<r.COLUM-1){let s=j(i,d);if(s!=null&&s.data.get("value")==o&&s.data.get("check")==!1)return!1}}return!0}function Q(t,e){let a=e.data.get("i"),n=e.data.get("j"),o=k(a,n);if(o!=null){let u=o.data.get("value");h(u),l[o.data.get("i")][o.data.get("j")]=void 0,o.destroy(),m(t,o)}let i=T(a,n);if(i!=null){let u=i.data.get("value");h(u),l[i.data.get("i")][i.data.get("j")]=void 0,i.destroy(),m(t,i)}let d=I(a,n);if(d!=null){let u=d.data.get("value");h(u),l[d.data.get("i")][d.data.get("j")]=void 0,d.destroy(),m(t,d)}let s=j(a,n);if(s!=null){let u=s.data.get("value");h(u),l[s.data.get("i")][s.data.get("j")]=void 0,s.destroy(),m(t,s)}let f=V(a,n);if(f!=null){let u=f.data.get("value");h(u),l[f.data.get("i")][f.data.get("j")]=void 0,f.destroy(),m(t,f)}let g=ee(a,n);if(g!=null){let u=g.data.get("value");h(u),l[g.data.get("i")][g.data.get("j")]=void 0,g.destroy(),m(t,g)}let p=Z(a,n);if(p!=null){let u=p.data.get("value");h(u),l[p.data.get("i")][p.data.get("j")]=void 0,p.destroy(),m(t,p)}let c=te(a,n);if(c!=null){let u=c.data.get("value");h(u),l[c.data.get("i")][c.data.get("j")]=void 0,c.destroy(),m(t,c)}e.destroy(),l[a][n]=void 0,m(t,e),setTimeout(function(){W(t)},100),R(t,"breaking"),C=0,v=0}function h(t){_+=t,_>L&&(L=_,localStorage.setItem("hscore",L)),U.text=_}function k(t,e){return t<=0?null:l[t-1][e]}function T(t,e){return t>=r.ROW-1?null:l[t+1][e]}function I(t,e){return e<=0?null:l[t][e-1]}function j(t,e){return e>=r.COLUM?null:l[t][e+1]}function V(t,e){return t<=0||e<=0?null:l[t-1][e-1]}function Z(t,e){return e<=0||t>=r.ROW-1?null:l[t+1][e-1]}function ee(t,e){return t<=0||e>=r.COLUM?null:l[t-1][e+1]}function te(t,e){return e>=r.COLUM||t>=r.ROW-1?null:l[t+1][e+1]}function ae(t){let e=new S(t,0,0,"boder").setScale(.3),a=new S(t,0,0,"btnHome");a.setScale(.3);let n=t.add.container(50,50,[e,a]);n.setSize(100,100),n.setInteractive(),n.on("pointerdown",function(o){console.log("nnnn"),t.tweens.add({targets:n,scale:{from:n.scale-.15,to:n.scale},ease:"Bounce",duration:500,onComplete:function(){t.cameras.main.fadeOut(500,0,0,0)}})}),t.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(o,i)=>{t.scene.start("game_menu")})}function ne(t){L=localStorage.getItem("hscore"),U=new M(t,360,160,"popin","0",102)}function ie(t){let e=new S(t,650,50,"boder").setScale(.3).setInteractive(),a=new S(t,e.x,e.y,"btnSoundOn");a.setScale(.3),e.on("pointerdown",function(n){t.tweens.add({targets:a,scale:{from:a.scale-.15,to:a.scale},ease:"Bounce",duration:500,onComplete:function(){P?(t.sound.stopAll(),P=!1,a.setTexture("btnSoundOff")):(P=!0,R(t,"bg_music"),a.setTexture("btnSoundOn"))}})})}function oe(t){let e=new S(t,580,50,"boder").setScale(.3).setInteractive(),a=new S(t,e.x,e.y,"btnInfo");a.setScale(.3),e.on("pointerdown",function(n){t.tweens.add({targets:a,scale:{from:a.scale-.15,to:a.scale},ease:"Bounce",duration:500,onComplete:function(){N(t)}})})}function R(t,e){if(P)if(e=="bg_music"){let a=t.sound.add(e);a.play(),a.setLoop(!0)}else t.sound.play(e)}function N(t){{let e=t.add.rectangle(360,640,2e3,2e3,"0x000000");e.alpha=.9;let a=t.add.image(360,640,"tutorial").setInteractive(),n=t.add.container(0,0,[e,a]);a.on("pointerdown",function(o){n.setPosition(-2e3,-2e3),localStorage.setItem("tutorial","show")})}}function m(t,e){t.add.particles(0,0,"block",{x:e.x,y:e.y,speed:{min:-600,max:600},alpha:{min:0,max:.5},angle:{min:0,max:360},scale:{start:.1,end:0},blendMode:"SCREEN",frequency:5,lifespan:600,gravityY:800,quantity:3,maxParticles:15})}class se extends Phaser.Scene{constructor(){super({key:"preload"})}preload(){var e=this.add.graphics(),a=this.add.graphics();a.fillStyle(2236962,.8),a.fillRect(200,1280/2,320,50);var n=720,o=1280,i=this.make.text({x:n/2,y:o/2-30,text:"Loading...",style:{font:"20px monospace",fill:"#ffffff"}});i.setOrigin(.5,.5);var d=this.make.text({x:n/2,y:o/2+25,text:"0%",style:{font:"18px monospace",fill:"#ffffff"}});d.setOrigin(.5,.5),this.load.on("progress",function(s){d.setText(parseInt(s*100)+"%"),e.clear(),e.fillStyle(16777215,1),e.fillRect(206,1280/2+8,300*s,30)}),this.load.on("complete",function(){}),this.load.bitmapFont("popin","assets/fonts/popin.png","assets/fonts/popin.xml"),this.load.font("lovelo","assets/fonts/Lovelo_Black.otf"),this.load.audio("merge","assets/audio/merge.wav"),this.load.audio("drop","assets/audio/drop.wav"),this.load.audio("breaking","assets/audio/breaking.mp3"),this.load.audio("bg_music","assets/audio/bg.mp3"),this.load.image("nb1","assets/image/1.png"),this.load.image("nb2","assets/image/2.png"),this.load.image("nb3","assets/image/3.png"),this.load.image("nb4","assets/image/4.png"),this.load.image("nb5","assets/image/5.png"),this.load.image("nb6","assets/image/6.png"),this.load.image("nb7","assets/image/7.png"),this.load.image("nb8","assets/image/8.png"),this.load.image("nb9","assets/image/9.png"),this.load.image("nb10","assets/image/10.png"),this.load.image("bg","assets/image/bg.png"),this.load.image("bg2","assets/image/bg2.png"),this.load.image("title","assets/image/title.png"),this.load.image("btnSoundOn","assets/image/btnSoundOn.png"),this.load.image("btnSoundOff","assets/image/btnSoundOff.png"),this.load.image("btnInfo","assets/image/btnInfo.png"),this.load.image("btnPlay","assets/image/btnPlay.png"),this.load.image("btnReload","assets/image/btnReload.png"),this.load.image("btnHome","assets/image/btnHome.png"),this.load.image("crown","assets/image/crown.png"),this.load.image("boder","assets/image/boder.png"),this.load.image("light","assets/image/light.png"),this.load.image("block","assets/image/block.png"),this.load.image("grid","assets/image/grid.png"),this.load.image("tutorial","assets/image/tutorial.png")}create(){this.music_bg=this.sound.add("bg_music"),this.music_bg.play(),this.music_bg.setLoop(!0),this.scene.start("game_menu")}}class le extends Phaser.Scene{constructor(){super({key:"game_menu"})}create(){window.UtilPlatform.sendMsg2Parent("ShowNavFooterPlay"),this.add.rectangle(360,640,2e3,2e3,"0x2f0045"),de(this),this.cameras.main.fadeIn(300,0,0,0)}}let B;function de(t){B=new F;let e=t.add.image(0,640,"btnPlay").setScale(1,.9).setInteractive();e.on("pointerdown",function(n){B.BtnClickAnim(t,e,"btnPlay"),window.UtilPlatform.sendMsg2Parent("HideNavFooterPlay")}),B.ObjectMove(t,e,360,640);let a=t.add.image(360,-1e3,"title").setScale(1.7);B.ObjectMove(t,a,360,400)}class re extends Phaser.Scene{constructor(){super({key:"game_over"})}create(){ue(this)}}let b;function ue(t){let e=localStorage.getItem("hscore");e==null&&(e=0),t.add.rectangle(360,640,600,1e3,"0xEFE230");let a=t.add.image(260,-1e3,"crown").setScale(.8),n=t.add.text(300,-1e3,e,{fontFamily:"lovelo",fontSize:"102px",color:"#FF3131"});n.setAlign("left"),b=new F;let o=t.add.image(260,2e3,"btnReload").setScale(.8).setInteractive();o.on("pointerdown",function(s){b.BtnClickAnim(t,o,"btnReload")});let i=t.add.image(460,2e3,"btnHome").setScale(.8).setInteractive();i.on("pointerdown",function(s){b.BtnClickAnim(t,i,"btnHome")}),b.ObjectMove(t,o,260,940),b.ObjectMove(t,i,460,940),b.ObjectMove(t,a,260,640),b.ObjectMove(t,n,360,580);let d=t.add.image(360,-1e3,"title").setScale(2);b.ObjectMove(t,d,360,400)}class fe extends Phaser.Plugins.BasePlugin{constructor(e){super(e),e.registerFileType("font",function(a,n){const o=a;this.addFile(new ge(this,a,o,n))})}}class ge extends Phaser.Loader.File{constructor(e,a,n,o){super(e,{type:"font",key:a,url:o}),this.fontName=n}load(){const e=new FontFace(this.fontName,`url(${this.url})`);document.fonts.add(e),e.load().then(()=>{this.loader.emit("fileprogress",this,1),this.loader.nextFile(this,!0)}).catch(a=>{console.error(`Failed to load ${this.fontName}`,a),this.loader.nextFile(this,!1)})}}window.onload=function(){let t={type:Phaser.AUTO,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,parent:"game",width:720,height:1280},backgroundColor:"#000000",plugins:{global:[{key:"FontLoaderPlugin",plugin:fe,start:!0}]},scene:[se,le,K,re]};new Phaser.Game(t)};
