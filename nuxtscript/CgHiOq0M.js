import"./B5Qt9EMX.js";{class m{constructor(){this._broadcastChannel=typeof BroadcastChannel>"u"?null:new BroadcastChannel("offline"),this._queuedMessages=[],this._onMessageCallback=null,this._broadcastChannel&&(this._broadcastChannel.onmessage=i=>this._OnBroadcastChannelMessage(i))}_OnBroadcastChannelMessage(i){if(this._onMessageCallback){this._onMessageCallback(i);return}this._queuedMessages.push(i)}SetMessageCallback(i){this._onMessageCallback=i;for(let e of this._queuedMessages)this._onMessageCallback(e);this._queuedMessages.length=0}}window.OfflineClientInfo=new m}window.DOMHandler=class{constructor(d,i){this._iRuntime=d,this._componentId=i,this._hasTickCallback=!1,this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(d,i,e,t){this._iRuntime.PostToRuntimeComponent(this._componentId,d,i,e,t)}PostToRuntimeAsync(d,i,e,t){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,d,i,e,t)}_PostToRuntimeMaybeSync(d,i,e){this._iRuntime.UsesWorker()?this.PostToRuntime(d,i,e):this._iRuntime._GetLocalRuntime()._OnMessageFromDOM({type:"event",component:this._componentId,handler:d,dispatchOpts:e||null,data:i,responseId:null})}AddRuntimeMessageHandler(d,i){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,d,i)}AddRuntimeMessageHandlers(d){for(const[i,e]of d)this.AddRuntimeMessageHandler(i,e)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&(this._iRuntime._RemoveRAFCallback(this._tickCallback),this._hasTickCallback=!1)}Tick(){}},window.RateLimiter=class{constructor(d,i){this._callback=d,this._interval=i,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1}SetCanRunImmediate(d){this._canRunImmediate=!!d}Call(){if(this._timerId!==-1)return;const d=Date.now(),i=d-this._lastCallTime,e=this._interval;i>=e&&this._canRunImmediate?(this._lastCallTime=d,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(e-i,4))}_RunCallback(){this._ignoreReset=!0,this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1,this._lastCallTime=Date.now(),this._RunCallback()}_CancelTimer(){this._timerId!==-1&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._timerCallFunc=null}};{class m{constructor(i){this._elem=i,this._hadFirstUpdate=!1,this._isVisibleFlag=!0}SetVisibleFlag(i){this._isVisibleFlag=!!i}GetVisibleFlag(){return this._isVisibleFlag}HadFirstUpdate(){return this._hadFirstUpdate}SetHadFirstUpdate(){this._hadFirstUpdate=!0}GetElement(){return this._elem}}window.DOMElementHandler=class extends self.DOMHandler{constructor(i,e){super(i,e),this._elementMap=new Map,this._autoAttach=!0,this.AddRuntimeMessageHandlers([["create",t=>this._OnCreate(t)],["destroy",t=>this._OnDestroy(t)],["set-visible",t=>this._OnSetVisible(t)],["update-position",t=>this._OnUpdatePosition(t)],["update-state",t=>this._OnUpdateState(t)],["focus",t=>this._OnSetFocus(t)],["set-css-style",t=>this._OnSetCssStyle(t)],["set-attribute",t=>this._OnSetAttribute(t)],["remove-attribute",t=>this._OnRemoveAttribute(t)]]),this.AddDOMElementMessageHandler("get-element",t=>t)}SetAutoAttach(i){this._autoAttach=!!i}AddDOMElementMessageHandler(i,e){this.AddRuntimeMessageHandler(i,t=>{const s=t.elementId,o=this.GetElementById(s);return e(o,t)})}_OnCreate(i){const e=i.elementId,t=this.CreateElement(e,i),s=new m(t);this._elementMap.set(e,s),t.style.boxSizing="border-box",t.style.display="none",s.SetVisibleFlag(i.isVisible);const o=this._GetFocusElement(t);o.addEventListener("focus",l=>this._OnFocus(e)),o.addEventListener("blur",l=>this._OnBlur(e)),this._autoAttach&&document.body.appendChild(t)}CreateElement(i,e){throw new Error("required override")}DestroyElement(i){}_OnDestroy(i){const e=i.elementId,t=this.GetElementById(e);this.DestroyElement(t),this._autoAttach&&t.parentElement.removeChild(t),this._elementMap.delete(e)}PostToRuntimeElement(i,e,t){t||(t={}),t.elementId=e,this.PostToRuntime(i,t)}_PostToRuntimeElementMaybeSync(i,e,t){t||(t={}),t.elementId=e,this._PostToRuntimeMaybeSync(i,t)}_OnSetVisible(i){if(!this._autoAttach)return;const e=this._elementMap.get(i.elementId),t=e.GetElement();e.HadFirstUpdate()?t.style.display=i.isVisible?"":"none":e.SetVisibleFlag(i.isVisible)}_OnUpdatePosition(i){if(!this._autoAttach)return;const e=this._elementMap.get(i.elementId),t=e.GetElement();t.style.left=i.left+"px",t.style.top=i.top+"px",t.style.width=i.width+"px",t.style.height=i.height+"px";const s=i.fontSize;s!==null&&(t.style.fontSize=s+"em"),e.HadFirstUpdate()||(e.SetHadFirstUpdate(),e.GetVisibleFlag()&&(t.style.display=""))}_OnUpdateState(i){const e=this.GetElementById(i.elementId);this.UpdateState(e,i)}UpdateState(i,e){throw new Error("required override")}_GetFocusElement(i){return i}_OnFocus(i){this.PostToRuntimeElement("elem-focused",i)}_OnBlur(i){this.PostToRuntimeElement("elem-blurred",i)}_OnSetFocus(i){const e=this._GetFocusElement(this.GetElementById(i.elementId));i.focus?e.focus():e.blur()}_OnSetCssStyle(i){const e=this.GetElementById(i.elementId),t=i.prop,s=i.val;t.startsWith("--")?e.style.setProperty(t,s):e.style[t]=s}_OnSetAttribute(i){this.GetElementById(i.elementId).setAttribute(i.name,i.val)}_OnRemoveAttribute(i){this.GetElementById(i.elementId).removeAttribute(i.name)}GetElementById(i){const e=this._elementMap.get(i);if(!e)throw new Error(`no element with id ${i}`);return e.GetElement()}}}{let t=function(r){const n=document.createElement("script");return n.async=!1,n.type="module",r.isStringSrc?new Promise(c=>{const _="c3_resolve_"+e;++e,self[_]=c,n.textContent=r.str+`

self["${_}"]();`,document.head.appendChild(n)}):new Promise((c,_)=>{n.onload=c,n.onerror=_,n.src=r,document.head.appendChild(n)})},l=function(){if(!s){try{new Worker("blob://",{get type(){o=!0}})}catch{}s=!0}return o},v=function(r){return new Promise((n,c)=>{const _=new FileReader;_.onload=A=>n(A.target.result),_.onerror=A=>c(A),_.readAsArrayBuffer(r)})},N=function(r){return T.has(r)};const m=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),d=/android/i.test(navigator.userAgent),i=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/|nwjs)/i.test(navigator.userAgent);let e=0,s=!1,o=!1,a=new Audio;const h={"audio/webm; codecs=opus":!!a.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!a.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!a.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!a.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!a.canPlayType("audio/mp4"),"audio/mpeg":!!a.canPlayType("audio/mpeg")};a=null;async function y(r){const n=await v(r);return new TextDecoder("utf-8").decode(n)}const b=[];let g=0;const f=8;window.RealFile=window.File;const u=[],p=new Map,w=new Map;let S=0;const E=[];self.runOnStartup=function(n){if(typeof n!="function")throw new Error("runOnStartup called without a function");E.push(n)};const T=new Set(["cordova","playable-ad","instant-games"]);let C=!1;window.RuntimeInterface=class k{constructor(n){if(this._useWorker=n.useWorker,this._messageChannelPort=null,this._runtimeBaseUrl="",this._scriptFolder=n.scriptFolder,this._workerScriptURLs={},this._worker=null,this._localRuntime=null,this._domHandlers=[],this._runtimeDomHandler=null,this._canvas=null,this._isExportingToVideo=!1,this._exportToVideoDuration=0,this._jobScheduler=null,this._rafId=-1,this._rafFunc=()=>this._OnRAFCallback(),this._rafCallbacks=[],this._exportType=n.exportType,this._isFileProtocol=location.protocol.substr(0,4)==="file",this._useWorker&&(typeof OffscreenCanvas>"u"||!navigator.userActivation||!l())&&(this._useWorker=!1),this._useWorker&&i&&(this._useWorker=!1),(this._exportType==="playable-ad"||this._exportType==="instant-games")&&(this._useWorker=!1),this._exportType==="cordova"&&this._useWorker)if(d){const c=/Chrome\/(\d+)/i.exec(navigator.userAgent);(!c||!(parseInt(c[1],10)>=90))&&(this._useWorker=!1)}else this._useWorker=!1;this._localFileBlobs=null,this._localFileStrings=null,this._exportType==="html5"&&!window.isSecureContext&&console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available."),this.AddRuntimeComponentMessageHandler("runtime","cordova-fetch-local-file",c=>this._OnCordovaFetchLocalFile(c)),this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",c=>this._OnCreateJobWorker(c)),this._exportType==="cordova"?document.addEventListener("deviceready",()=>this._Init(n)):this._Init(n)}Release(){this._CancelAnimationFrame(),this._messageChannelPort&&(this._messageChannelPort.onmessage=null,this._messageChannelPort=null),this._worker&&(this._worker.terminate(),this._worker=null),this._localRuntime&&(this._localRuntime.Release(),this._localRuntime=null),this._canvas&&(this._canvas.parentElement.removeChild(this._canvas),this._canvas=null)}GetCanvas(){return this._canvas}GetRuntimeBaseURL(){return this._runtimeBaseUrl}UsesWorker(){return this._useWorker}GetExportType(){return this._exportType}IsFileProtocol(){return this._isFileProtocol}GetScriptFolder(){return this._scriptFolder}IsiOSCordova(){return m&&this._exportType==="cordova"}IsiOSWebView(){const n=navigator.userAgent;return m&&N(this._exportType)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(n)}IsAndroid(){return d}IsAndroidWebView(){return d&&N(this._exportType)}async _Init(n){if(this._exportType==="macos-wkwebview"&&this._SendWrapperMessage({type:"ready"}),this._exportType==="playable-ad"){this._localFileBlobs=self.c3_base64files,this._localFileStrings={},await this._ConvertDataUrisToBlobs();for(let _=0,A=n.engineScripts.length;_<A;++_){const P=n.engineScripts[_];this._localFileStrings.hasOwnProperty(P)?n.engineScripts[_]={isStringSrc:!0,str:this._localFileStrings[P]}:this._localFileBlobs.hasOwnProperty(P)&&(n.engineScripts[_]=URL.createObjectURL(this._localFileBlobs[P]))}n.workerDependencyScripts=[]}if(this._exportType==="nwjs"&&self.nw&&self.nw.App.manifest["c3-steam-mode"]){let _=0;this._AddRAFCallback(()=>{_++,document.body.style.opacity=_%2===0?"1":"0.999"})}if(n.runtimeBaseUrl)this._runtimeBaseUrl=n.runtimeBaseUrl;else{const _=location.origin;this._runtimeBaseUrl=(_==="null"?"file:///":_)+location.pathname;const A=this._runtimeBaseUrl.lastIndexOf("/");A!==-1&&(this._runtimeBaseUrl=this._runtimeBaseUrl.substr(0,A+1))}n.workerScripts&&(this._workerScriptURLs=n.workerScripts);const c=new MessageChannel;if(this._messageChannelPort=c.port1,this._messageChannelPort.onmessage=_=>this._OnMessageFromRuntime(_.data),window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(_=>this._OnMessageFromDebugger(_)),this._jobScheduler=new self.JobSchedulerDOM(this),await this._jobScheduler.Init(),typeof window.StatusBar=="object"&&window.StatusBar.hide(),typeof window.AndroidFullScreen=="object")try{await new Promise((_,A)=>{window.AndroidFullScreen.immersiveMode(_,A)})}catch(_){console.error("Failed to enter Android immersive mode: ",_)}this._useWorker?await this._InitWorker(n,c.port2):await this._InitDOM(n,c.port2)}_GetWorkerURL(n){let c;return this._workerScriptURLs.hasOwnProperty(n)?c=this._workerScriptURLs[n]:n.endsWith("/workermain.js")&&this._workerScriptURLs.hasOwnProperty("workermain.js")?c=this._workerScriptURLs["workermain.js"]:this._exportType==="playable-ad"&&this._localFileBlobs.hasOwnProperty(n)?c=this._localFileBlobs[n]:c=n,c instanceof Blob&&(c=URL.createObjectURL(c)),c}async CreateWorker(n,c,_){if(n.startsWith("blob:"))return new Worker(n,_);if(this._exportType==="cordova"&&this._isFileProtocol){let I="";_.isC3MainWorker?I=n:I=this._scriptFolder+n;const O=await this.CordovaFetchLocalFileAsArrayBuffer(I),R=new Blob([O],{type:"application/javascript"});return new Worker(URL.createObjectURL(R),_)}const A=new URL(n,c);if(location.origin!==A.origin){const I=await fetch(A);if(!I.ok)throw new Error("failed to fetch worker script");const O=await I.blob();return new Worker(URL.createObjectURL(O),_)}else return new Worker(A,_)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,1)}_GetCommonRuntimeOptions(n){return{runtimeBaseUrl:this._runtimeBaseUrl,previewUrl:location.href,windowInnerWidth:this._GetWindowInnerWidth(),windowInnerHeight:this._GetWindowInnerHeight(),devicePixelRatio:window.devicePixelRatio,isFullscreen:k.IsDocumentFullscreen(),projectData:n.projectData,previewImageBlobs:window.cr_previewImageBlobs||this._localFileBlobs,previewProjectFileBlobs:window.cr_previewProjectFileBlobs,previewProjectFileSWUrls:window.cr_previewProjectFiles,swClientId:window.cr_swClientId||"",exportType:n.exportType,isDebug:new URLSearchParams(self.location.search).has("debug"),ife:!!self.ife,jobScheduler:this._jobScheduler.GetPortData(),supportedAudioFormats:h,opusWasmScriptUrl:window.cr_opusWasmScriptUrl||this._scriptFolder+"opus.wasm.js",opusWasmBinaryUrl:window.cr_opusWasmBinaryUrl||this._scriptFolder+"opus.wasm.wasm",isFileProtocol:this._isFileProtocol,isiOSCordova:this.IsiOSCordova(),isiOSWebView:this.IsiOSWebView(),isFBInstantAvailable:typeof self.FBInstant<"u"}}async _InitWorker(n,c){const _=this._GetWorkerURL(n.workerMainUrl);this._exportType==="preview"?(this._worker=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((O,R)=>{const L=F=>{this._worker.removeEventListener("message",L),F.data&&F.data.type==="ok"?O():R()};this._worker.addEventListener("message",L),this._worker.postMessage({type:"construct-worker-init",import:new URL(_,this._runtimeBaseUrl).toString()})})):this._worker=await this.CreateWorker(_,this._runtimeBaseUrl,{type:"module",name:"Runtime",isC3MainWorker:!0}),this._canvas=document.createElement("canvas"),this._canvas.style.display="none";const A=this._canvas.transferControlToOffscreen();document.body.appendChild(this._canvas),window.c3canvas=this._canvas,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders();let P=n.workerDependencyScripts||[],I=n.engineScripts;if(P=await Promise.all(P.map(O=>this._MaybeGetCordovaScriptURL(O))),I=await Promise.all(I.map(O=>this._MaybeGetCordovaScriptURL(O))),this._exportType==="cordova")for(let O=0,R=n.projectScripts.length;O<R;++O){const L=n.projectScripts[O],F=L[0];(F===n.mainProjectScript||F==="scriptsInEvents.js"||F.endsWith("/scriptsInEvents.js"))&&(L[1]=await this._MaybeGetCordovaScriptURL(F))}this._worker.postMessage(Object.assign(this._GetCommonRuntimeOptions(n),{type:"init-runtime",isInWorker:!0,messagePort:c,canvas:A,workerDependencyScripts:P,engineScripts:I,projectScripts:n.projectScripts,mainProjectScript:n.mainProjectScript,projectScriptsStatus:self.C3_ProjectScriptsStatus}),[c,A,...this._jobScheduler.GetPortTransferables()]),this._domHandlers=u.map(O=>new O(this)),this._FindRuntimeDOMHandler(),this._runtimeDomHandler._EnableWindowResizeEvent(),self.c3_callFunction=(O,R)=>this._runtimeDomHandler._InvokeFunctionFromJS(O,R),this._exportType==="preview"&&(self.goToLastErrorScript=()=>this.PostToRuntimeComponent("runtime","go-to-last-error-script"))}async _InitDOM(n,c){this._canvas=document.createElement("canvas"),this._canvas.style.display="none",document.body.appendChild(this._canvas),window.c3canvas=this._canvas,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this._domHandlers=u.map(R=>new R(this)),this._FindRuntimeDOMHandler();let _=n.engineScripts.map(R=>typeof R=="string"?new URL(R,this._runtimeBaseUrl).toString():R);if(Array.isArray(n.workerDependencyScripts)){const R=[...n.workerDependencyScripts].map(L=>L instanceof Blob?URL.createObjectURL(L):L);_.unshift(...R)}_=await Promise.all(_.map(R=>this._MaybeGetCordovaScriptURL(R))),await Promise.all(_.map(R=>t(R)));const A=self.C3_ProjectScriptsStatus,P=n.mainProjectScript,I=n.projectScripts;for(let[R,L]of I)if(L||(L=R),R===P)try{L=await this._MaybeGetCordovaScriptURL(L),await t(L),this._exportType==="preview"&&!A[R]&&this._ReportProjectMainScriptError(R,"main script did not run to completion")}catch(F){this._ReportProjectMainScriptError(R,F)}else(R==="scriptsInEvents.js"||R.endsWith("/scriptsInEvents.js"))&&(L=await this._MaybeGetCordovaScriptURL(L),await t(L));if(this._exportType==="preview"&&typeof self.C3.ScriptsInEvents!="object"){this._RemoveLoadingMessage();const R="Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax.";console.error("[C3 runtime] "+R),alert(R);return}const O=Object.assign(this._GetCommonRuntimeOptions(n),{isInWorker:!1,messagePort:c,canvas:this._canvas,runOnStartupFunctions:E});this._runtimeDomHandler._EnableWindowResizeEvent(),this._OnBeforeCreateRuntime(),this._localRuntime=self.C3_CreateRuntime(O),await self.C3_InitRuntime(this._localRuntime,O)}_ReportProjectMainScriptError(n,c){this._RemoveLoadingMessage(),console.error(`[Preview] Failed to load project main script (${n}): `,c),alert(`Failed to load project main script (${n}). Check all your JavaScript code has valid syntax. Press F12 and check the console for error details.`)}_OnBeforeCreateRuntime(){this._RemoveLoadingMessage()}_RemoveLoadingMessage(){const n=window.cr_previewLoadingElem;n&&(n.parentElement.removeChild(n),window.cr_previewLoadingElem=null)}async _OnCreateJobWorker(n){const c=await this._jobScheduler._CreateJobWorker();return{outputPort:c,transferables:[c]}}_GetLocalRuntime(){if(this._useWorker)throw new Error("not available in worker mode");return this._localRuntime}PostToRuntimeComponent(n,c,_,A,P){this._messageChannelPort.postMessage({type:"event",component:n,handler:c,dispatchOpts:A||null,data:_,responseId:null},P)}PostToRuntimeComponentAsync(n,c,_,A,P){const I=S++,O=new Promise((R,L)=>{w.set(I,{resolve:R,reject:L})});return this._messageChannelPort.postMessage({type:"event",component:n,handler:c,dispatchOpts:A||null,data:_,responseId:I},P),O}_OnMessageFromRuntime(n){const c=n.type;if(c==="event")return this._OnEventFromRuntime(n);if(c==="result")this._OnResultFromRuntime(n);else if(c==="runtime-ready")this._OnRuntimeReady();else if(c==="alert-error")this._RemoveLoadingMessage(),alert(n.message);else if(c==="creating-runtime")this._OnBeforeCreateRuntime();else throw new Error(`unknown message '${c}'`)}_OnEventFromRuntime(n){const c=n.component,_=n.handler,A=n.data,P=n.responseId,I=p.get(c);if(!I){console.warn(`[DOM] No event handlers for component '${c}'`);return}const O=I.get(_);if(!O){console.warn(`[DOM] No handler '${_}' for component '${c}'`);return}let R=null;try{R=O(A)}catch(L){console.error(`Exception in '${c}' handler '${_}':`,L),P!==null&&this._PostResultToRuntime(P,!1,""+L);return}if(P===null)return R;R&&R.then?R.then(L=>this._PostResultToRuntime(P,!0,L)).catch(L=>{console.error(`Rejection from '${c}' handler '${_}':`,L),this._PostResultToRuntime(P,!1,""+L)}):this._PostResultToRuntime(P,!0,R)}_PostResultToRuntime(n,c,_){let A;_&&_.transferables&&(A=_.transferables),this._messageChannelPort.postMessage({type:"result",responseId:n,isOk:c,result:_},A)}_OnResultFromRuntime(n){const c=n.responseId,_=n.isOk,A=n.result,P=w.get(c);_?P.resolve(A):P.reject(A),w.delete(c)}AddRuntimeComponentMessageHandler(n,c,_){let A=p.get(n);if(A||(A=new Map,p.set(n,A)),A.has(c))throw new Error(`[DOM] Component '${n}' already has handler '${c}'`);A.set(c,_)}static AddDOMHandlerClass(n){if(u.includes(n))throw new Error("DOM handler already added");u.push(n)}_FindRuntimeDOMHandler(){for(const n of this._domHandlers)if(n.GetComponentID()==="runtime"){this._runtimeDomHandler=n;return}throw new Error("cannot find runtime DOM handler")}_OnMessageFromDebugger(n){this.PostToRuntimeComponent("debugger","message",n)}_OnRuntimeReady(){for(const n of this._domHandlers)n.Attach()}static IsDocumentFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||C)}static _SetWrapperIsFullscreenFlag(n){C=!!n}async GetRemotePreviewStatusInfo(){return await this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(n){this._rafCallbacks.push(n),this._RequestAnimationFrame()}_RemoveRAFCallback(n){const c=this._rafCallbacks.indexOf(n);if(c===-1)throw new Error("invalid callback");this._rafCallbacks.splice(c,1),this._rafCallbacks.length||this._CancelAnimationFrame()}_RequestAnimationFrame(){this._rafId===-1&&this._rafCallbacks.length&&(this._rafId=requestAnimationFrame(this._rafFunc))}_CancelAnimationFrame(){this._rafId!==-1&&(cancelAnimationFrame(this._rafId),this._rafId=-1)}_OnRAFCallback(){this._rafId=-1;for(const n of this._rafCallbacks)n();this._RequestAnimationFrame()}TryPlayMedia(n){this._runtimeDomHandler.TryPlayMedia(n)}RemovePendingPlay(n){this._runtimeDomHandler.RemovePendingPlay(n)}_PlayPendingMedia(){this._runtimeDomHandler._PlayPendingMedia()}SetSilent(n){this._runtimeDomHandler.SetSilent(n)}IsAudioFormatSupported(n){return!!h[n]}async _WasmDecodeWebMOpus(n){const c=await this.PostToRuntimeComponentAsync("runtime","opus-decode",{arrayBuffer:n},null,[n]);return new Float32Array(c)}SetIsExportingToVideo(n){this._isExportingToVideo=!0,this._exportToVideoDuration=n}IsExportingToVideo(){return this._isExportingToVideo}GetExportToVideoDuration(){return this._exportToVideoDuration}IsAbsoluteURL(n){return/^(?:[a-z\-]+:)?\/\//.test(n)||n.substr(0,5)==="data:"||n.substr(0,5)==="blob:"}IsRelativeURL(n){return!this.IsAbsoluteURL(n)}async _MaybeGetCordovaScriptURL(n){if(this._exportType==="cordova"&&(n.startsWith("file:")||this._isFileProtocol&&this.IsRelativeURL(n))){let c=n;c.startsWith(this._runtimeBaseUrl)&&(c=c.substr(this._runtimeBaseUrl.length));const _=await this.CordovaFetchLocalFileAsArrayBuffer(c),A=new Blob([_],{type:"application/javascript"});return URL.createObjectURL(A)}else return n}async _OnCordovaFetchLocalFile(n){const c=n.filename;switch(n.as){case"text":return await this.CordovaFetchLocalFileAsText(c);case"buffer":return await this.CordovaFetchLocalFileAsArrayBuffer(c);default:throw new Error("unsupported type")}}_GetPermissionAPI(){const n=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if(typeof n!="object")throw new Error("Permission API is not loaded");return n}_MapPermissionID(n,c){const _=n[c];if(typeof _!="string")throw new Error("Invalid permission name");return _}_HasPermission(n){const c=this._GetPermissionAPI();return new Promise((_,A)=>c.checkPermission(this._MapPermissionID(c,n),P=>_(!!P.hasPermission),A))}_RequestPermission(n){const c=this._GetPermissionAPI();return new Promise((_,A)=>c.requestPermission(this._MapPermissionID(c,n),P=>_(!!P.hasPermission),A))}async RequestPermissions(n){if(this.GetExportType()!=="cordova"||this.IsiOSCordova())return!0;for(const c of n){if(await this._HasPermission(c))continue;if(await this._RequestPermission(c)===!1)return!1}return!0}async RequirePermissions(...n){if(await this.RequestPermissions(n)===!1)throw new Error("Permission not granted")}CordovaFetchLocalFile(n){const c=window.cordova.file.applicationDirectory+"www/"+n;return new Promise((_,A)=>{window.resolveLocalFileSystemURL(c,P=>{P.file(_,A)},A)})}async CordovaFetchLocalFileAsText(n){const c=await this.CordovaFetchLocalFile(n);return await y(c)}_CordovaMaybeStartNextArrayBufferRead(){if(!b.length||g>=f)return;g++;const n=b.shift();this._CordovaDoFetchLocalFileAsAsArrayBuffer(n.filename,n.successCallback,n.errorCallback)}CordovaFetchLocalFileAsArrayBuffer(n){return new Promise((c,_)=>{b.push({filename:n,successCallback:A=>{g--,this._CordovaMaybeStartNextArrayBufferRead(),c(A)},errorCallback:A=>{g--,this._CordovaMaybeStartNextArrayBufferRead(),_(A)}}),this._CordovaMaybeStartNextArrayBufferRead()})}async _CordovaDoFetchLocalFileAsAsArrayBuffer(n,c,_){try{const A=await this.CordovaFetchLocalFile(n),P=await v(A);c(P)}catch(A){_(A)}}_SendWrapperMessage(n){if(this._exportType==="windows-webview2")window.chrome.webview.postMessage(JSON.stringify(n));else if(this._exportType==="macos-wkwebview")window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(n));else throw new Error("cannot send wrapper message")}async _ConvertDataUrisToBlobs(){const n=[];for(const[c,_]of Object.entries(this._localFileBlobs))n.push(this._ConvertDataUriToBlobs(c,_));await Promise.all(n)}async _ConvertDataUriToBlobs(n,c){if(typeof c=="object")this._localFileBlobs[n]=new Blob([c.str],{type:c.type}),this._localFileStrings[n]=c.str;else{let _=await this._FetchDataUri(c);_||(_=this._DataURIToBinaryBlobSync(c)),this._localFileBlobs[n]=_}}async _FetchDataUri(n){try{return await(await fetch(n)).blob()}catch(c){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",c),null}}_DataURIToBinaryBlobSync(n){const c=this._ParseDataURI(n);return this._BinaryStringToBlob(c.data,c.mime_type)}_ParseDataURI(n){const c=n.indexOf(",");if(c<0)throw new URIError("expected comma in data: uri");const _=n.substring(5,c),A=n.substring(c+1),P=_.split(";"),I=P[0]||"",O=P[1],R=P[2];let L;return O==="base64"||R==="base64"?L=atob(A):L=decodeURIComponent(A),{mime_type:I,data:L}}_BinaryStringToBlob(n,c){let _=n.length,A=_>>2,P=new Uint8Array(_),I=new Uint32Array(P.buffer,0,A),O,R;for(O=0,R=0;O<A;++O)I[O]=n.charCodeAt(R++)|n.charCodeAt(R++)<<8|n.charCodeAt(R++)<<16|n.charCodeAt(R++)<<24;let L=_&3;for(;L--;)P[R]=n.charCodeAt(R),++R;return new Blob([P],{type:c})}}}{let d=function(C){return C.sourceCapabilities&&C.sourceCapabilities.firesTouchEvents||C.originalEvent&&C.originalEvent.sourceCapabilities&&C.originalEvent.sourceCapabilities.firesTouchEvents},o=function(C){return new Promise((r,n)=>{const c=document.createElement("link");c.onload=()=>r(c),c.onerror=_=>n(_),c.rel="stylesheet",c.href=C,document.head.appendChild(c)})},l=function(C){return new Promise((r,n)=>{const c=new Image;c.onload=()=>r(c),c.onerror=_=>n(_),c.src=C})},h=function(C){return new Promise((r,n)=>{let c=new FileReader;c.onload=_=>r(_.target.result),c.onerror=_=>n(_),c.readAsText(C)})},v=function(C){do{if(C.parentNode&&C.hasAttribute("contenteditable"))return!0;C=C.parentNode}while(C);return!1},g=function(C){return b.has(C.tagName.toLowerCase())||v(C)},u=function(C){if(!C.target.tagName)return;const r=C.target.tagName.toLowerCase();f.has(r)&&C.preventDefault()},p=function(C){(C.metaKey||C.ctrlKey)&&C.preventDefault()},S=function(){try{return window.parent&&window.parent.document.hasFocus()}catch{return!1}},E=function(){const C=document.activeElement;if(!C)return!1;const r=C.tagName.toLowerCase(),n=new Set(["email","number","password","search","tel","text","url"]);return r==="textarea"?!0:r==="input"?n.has(C.type.toLowerCase()||"text"):v(C)};const m=self.RuntimeInterface,i=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),e={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},t={dispatchUserScriptEvent:!0},s={dispatchRuntimeEvent:!0};async function a(C){const r=URL.createObjectURL(C);try{return await l(r)}finally{URL.revokeObjectURL(r)}}async function y(C,r,n){if(!/firefox/i.test(navigator.userAgent))return await a(C);let c=await h(C);const A=new DOMParser().parseFromString(c,"image/svg+xml"),P=A.documentElement;if(P.hasAttribute("width")&&P.hasAttribute("height")){const O=P.getAttribute("width"),R=P.getAttribute("height");if(!O.includes("%")&&!R.includes("%"))return await a(C)}return P.setAttribute("width",r+"px"),P.setAttribute("height",n+"px"),c=new XMLSerializer().serializeToString(A),C=new Blob([c],{type:"image/svg+xml"}),await a(C)}const b=new Set(["input","textarea","datalist","select"]),f=new Set(["canvas","body","html"]);self.C3_GetSvgImageSize=async function(C){const r=await a(C);if(r.width>0&&r.height>0)return[r.width,r.height];{r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.visibility="hidden",document.body.appendChild(r);const n=r.getBoundingClientRect();return document.body.removeChild(r),[n.width,n.height]}},self.C3_RasterSvgImageBlob=async function(C,r,n,c,_){const A=await y(C,r,n),P=document.createElement("canvas");return P.width=c,P.height=_,P.getContext("2d").drawImage(A,0,0,r,n),P};let w=!1;document.addEventListener("pause",()=>w=!0),document.addEventListener("resume",()=>w=!1);const T="runtime",N=class extends self.DOMHandler{constructor(r){super(r,T),this._isFirstSizeUpdate=!0,this._enableWindowResizeEvent=!1,this._simulatedResizeTimerId=-1,this._targetOrientation="any",this._attachedDeviceOrientationEvent=!1,this._attachedDeviceMotionEvent=!1,this._screenReaderTextWrap=document.createElement("div"),this._screenReaderTextWrap.className="c3-screen-reader-text",this._screenReaderTextWrap.setAttribute("aria-live","polite"),document.body.appendChild(this._screenReaderTextWrap),this._debugHighlightElem=null,this._isExportToVideo=!1,this._exportVideoProgressMessage="",this._exportVideoUpdateTimerId=-1,this._enableAndroidVKDetection=!1,this._lastWindowWidth=r._GetWindowInnerWidth(),this._lastWindowHeight=r._GetWindowInnerHeight(),this._virtualKeyboardHeight=0,this._vkTranslateYOffset=0,r.AddRuntimeComponentMessageHandler("canvas","update-size",_=>this._OnUpdateCanvasSize(_)),r.AddRuntimeComponentMessageHandler("runtime","invoke-download",_=>this._OnInvokeDownload(_)),r.AddRuntimeComponentMessageHandler("runtime","load-webfonts",_=>this._OnLoadWebFonts(_)),r.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",_=>this._OnRasterSvgImage(_)),r.AddRuntimeComponentMessageHandler("runtime","get-svg-image-size",_=>this._OnGetSvgImageSize(_)),r.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",_=>this._OnSetTargetOrientation(_)),r.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>this._OnRegisterSW()),r.AddRuntimeComponentMessageHandler("runtime","post-to-debugger",_=>this._OnPostToDebugger(_)),r.AddRuntimeComponentMessageHandler("runtime","go-to-script",_=>this._OnPostToDebugger(_)),r.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>this._OnBeforeStartTicking()),r.AddRuntimeComponentMessageHandler("runtime","debug-highlight",_=>this._OnDebugHighlight(_)),r.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent()),r.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",()=>this._AttachDeviceMotionEvent()),r.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",_=>this._OnAddStylesheet(_)),r.AddRuntimeComponentMessageHandler("runtime","script-create-worker",_=>this._OnScriptCreateWorker(_)),r.AddRuntimeComponentMessageHandler("runtime","alert",_=>this._OnAlert(_)),r.AddRuntimeComponentMessageHandler("runtime","screen-reader-text",_=>this._OnScreenReaderTextEvent(_)),r.AddRuntimeComponentMessageHandler("runtime","hide-cordova-splash",()=>this._OnHideCordovaSplash()),r.AddRuntimeComponentMessageHandler("runtime","set-exporting-to-video",_=>this._SetExportingToVideo(_)),r.AddRuntimeComponentMessageHandler("runtime","export-to-video-progress",_=>this._OnExportVideoProgress(_)),r.AddRuntimeComponentMessageHandler("runtime","exported-to-video",_=>this._OnExportedToVideo(_)),r.AddRuntimeComponentMessageHandler("runtime","exported-to-image-sequence",_=>this._OnExportedToImageSequence(_));const n=new Set(["input","textarea","datalist"]);window.addEventListener("contextmenu",_=>{const A=_.target,P=A.tagName.toLowerCase();!n.has(P)&&!v(A)&&_.preventDefault()});const c=r.GetCanvas();if(window.addEventListener("selectstart",u),window.addEventListener("gesturehold",u),c.addEventListener("selectstart",u),c.addEventListener("gesturehold",u),window.addEventListener("touchstart",u,{passive:!1}),typeof PointerEvent<"u"?(window.addEventListener("pointerdown",u,{passive:!1}),c.addEventListener("pointerdown",u)):c.addEventListener("touchstart",u),this._mousePointerLastButtons=0,window.addEventListener("mousedown",_=>{_.button===1&&_.preventDefault()}),window.addEventListener("mousewheel",p,{passive:!1}),window.addEventListener("wheel",p,{passive:!1}),window.addEventListener("resize",()=>this._OnWindowResize()),window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("mozfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("fullscreenerror",_=>this._OnFullscreenError(_)),window.addEventListener("webkitfullscreenerror",_=>this._OnFullscreenError(_)),window.addEventListener("mozfullscreenerror",_=>this._OnFullscreenError(_)),r.IsiOSWebView())if(window.visualViewport){let _=1/0;window.visualViewport.addEventListener("resize",()=>{const A=window.visualViewport.height;A>_&&(document.scrollingElement.scrollTop=0),_=A})}else window.addEventListener("focusout",()=>{E()||(document.scrollingElement.scrollTop=0)});self.C3WrapperOnMessage=_=>this._OnWrapperMessage(_),this._mediaPendingPlay=new Set,this._mediaRemovedPendingPlay=new WeakSet,this._isSilent=!1}_OnBeforeStartTicking(){return self.setTimeout(()=>{this._enableAndroidVKDetection=!0},1e3),this._iRuntime.GetExportType()==="cordova"?(document.addEventListener("pause",()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",()=>this._OnVisibilityChange(document.hidden)),{isSuspended:!!(document.hidden||w)}}Attach(){window.addEventListener("focus",()=>this._PostRuntimeEvent("window-focus")),window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",{parentHasFocus:S()}),this._mousePointerLastButtons=0}),window.addEventListener("focusin",n=>{g(n.target)&&this._PostRuntimeEvent("keyboard-blur")}),window.addEventListener("keydown",n=>this._OnKeyEvent("keydown",n)),window.addEventListener("keyup",n=>this._OnKeyEvent("keyup",n)),window.addEventListener("dblclick",n=>this._OnMouseEvent("dblclick",n,e)),window.addEventListener("wheel",n=>this._OnMouseWheelEvent("wheel",n)),typeof PointerEvent<"u"?(window.addEventListener("pointerdown",n=>{this._HandlePointerDownFocus(n),this._OnPointerEvent("pointerdown",n)}),this._iRuntime.UsesWorker()&&typeof window.onpointerrawupdate<"u"&&self===self.top?window.addEventListener("pointerrawupdate",n=>this._OnPointerRawUpdate(n)):window.addEventListener("pointermove",n=>this._OnPointerEvent("pointermove",n)),window.addEventListener("pointerup",n=>this._OnPointerEvent("pointerup",n)),window.addEventListener("pointercancel",n=>this._OnPointerEvent("pointercancel",n))):(window.addEventListener("mousedown",n=>{this._HandlePointerDownFocus(n),this._OnMouseEventAsPointer("pointerdown",n)}),window.addEventListener("mousemove",n=>this._OnMouseEventAsPointer("pointermove",n)),window.addEventListener("mouseup",n=>this._OnMouseEventAsPointer("pointerup",n)),window.addEventListener("touchstart",n=>{this._HandlePointerDownFocus(n),this._OnTouchEvent("pointerdown",n)}),window.addEventListener("touchmove",n=>this._OnTouchEvent("pointermove",n)),window.addEventListener("touchend",n=>this._OnTouchEvent("pointerup",n)),window.addEventListener("touchcancel",n=>this._OnTouchEvent("pointercancel",n)));const r=()=>this._PlayPendingMedia();window.addEventListener("pointerup",r,!0),window.addEventListener("touchend",r,!0),window.addEventListener("click",r,!0),window.addEventListener("keydown",r,!0),window.addEventListener("gamepadconnected",r,!0),this._iRuntime.IsAndroid()&&!this._iRuntime.IsAndroidWebView()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.addEventListener("geometrychange",()=>{this._OnAndroidVirtualKeyboardChange(this._GetWindowInnerHeight(),navigator.virtualKeyboard.boundingRect.height)}))}_OnAndroidVirtualKeyboardChange(r,n){if(document.body.style.transform="",this._vkTranslateYOffset=0,n>0){const c=document.activeElement;if(c){const _=c.getBoundingClientRect(),A=(_.top+_.bottom)/2,P=(r-n)/2;let I=A-P;I>n&&(I=n),I<0&&(I=0),I>0&&(document.body.style.transform=`translateY(${-I}px)`,this._vkTranslateYOffset=I)}}}_PostRuntimeEvent(r,n){this.PostToRuntime(r,n||null,s)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_EnableWindowResizeEvent(){this._enableWindowResizeEvent=!0,this._lastWindowWidth=this._iRuntime._GetWindowInnerWidth(),this._lastWindowHeight=this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){if(this._isExportToVideo||!this._enableWindowResizeEvent)return;const r=this._GetWindowInnerWidth(),n=this._GetWindowInnerHeight();if(this._iRuntime.IsAndroidWebView())if(this._enableAndroidVKDetection)if(this._lastWindowWidth===r&&n<this._lastWindowHeight){this._virtualKeyboardHeight=this._lastWindowHeight-n,this._OnAndroidVirtualKeyboardChange(this._lastWindowHeight,this._virtualKeyboardHeight);return}else this._virtualKeyboardHeight>0&&(this._virtualKeyboardHeight=0,this._OnAndroidVirtualKeyboardChange(n,this._virtualKeyboardHeight)),this._lastWindowWidth=r,this._lastWindowHeight=n;else this._lastWindowWidth=r,this._lastWindowHeight=n;this.PostToRuntime("window-resize",{innerWidth:r,innerHeight:n,devicePixelRatio:window.devicePixelRatio,isFullscreen:m.IsDocumentFullscreen()}),this._iRuntime.IsiOSWebView()&&(this._simulatedResizeTimerId!==-1&&clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(r,n,0))}_ScheduleSimulatedResize(r,n,c){this._simulatedResizeTimerId!==-1&&clearTimeout(this._simulatedResizeTimerId),this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(r,n,c),48)}_OnSimulatedResize(r,n,c){const _=this._GetWindowInnerWidth(),A=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1,_!=r||A!=n?this.PostToRuntime("window-resize",{innerWidth:_,innerHeight:A,devicePixelRatio:window.devicePixelRatio,isFullscreen:m.IsDocumentFullscreen()}):c<10&&this._ScheduleSimulatedResize(_,A,c+1)}_OnSetTargetOrientation(r){this._targetOrientation=r.targetOrientation}_TrySetTargetOrientation(){const r=this._targetOrientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(r).catch(n=>console.warn("[Construct] Failed to lock orientation: ",n));else try{let n=!1;screen.lockOrientation?n=screen.lockOrientation(r):screen.webkitLockOrientation?n=screen.webkitLockOrientation(r):screen.mozLockOrientation?n=screen.mozLockOrientation(r):screen.msLockOrientation&&(n=screen.msLockOrientation(r)),n||console.warn("[Construct] Failed to lock orientation")}catch(n){console.warn("[Construct] Failed to lock orientation: ",n)}}_OnFullscreenChange(){if(this._isExportToVideo)return;const r=m.IsDocumentFullscreen();r&&this._targetOrientation!=="any"&&this._TrySetTargetOrientation(),this.PostToRuntime("fullscreenchange",{isFullscreen:r,innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnFullscreenError(r){console.warn("[Construct] Fullscreen request failed: ",r),this.PostToRuntime("fullscreenerror",{isFullscreen:m.IsDocumentFullscreen(),innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnVisibilityChange(r){r?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame(),this.PostToRuntime("visibilitychange",{hidden:r})}_OnKeyEvent(r,n){if(n.key==="Backspace"&&u(n),this._isExportToVideo)return;const c=i.get(n.code)||n.code;this._PostToRuntimeMaybeSync(r,{code:c,key:n.key,which:n.which,repeat:n.repeat,altKey:n.altKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey,shiftKey:n.shiftKey,timeStamp:n.timeStamp},e)}_OnMouseWheelEvent(r,n){this._isExportToVideo||this.PostToRuntime(r,{clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,deltaX:n.deltaX,deltaY:n.deltaY,deltaZ:n.deltaZ,deltaMode:n.deltaMode,timeStamp:n.timeStamp},e)}_OnMouseEvent(r,n,c){this._isExportToVideo||d(n)||this._PostToRuntimeMaybeSync(r,{button:n.button,buttons:n.buttons,clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,movementX:n.movementX||0,movementY:n.movementY||0,timeStamp:n.timeStamp},c)}_OnMouseEventAsPointer(r,n){if(this._isExportToVideo||d(n))return;const c=1,_=this._mousePointerLastButtons;(r==="pointerdown"&&_!==0||r==="pointerup"&&n.buttons!==0)&&(r="pointermove"),this._PostToRuntimeMaybeSync(r,{pointerId:c,pointerType:"mouse",button:n.button,buttons:n.buttons,lastButtons:_,clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,movementX:n.movementX||0,movementY:n.movementY||0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,timeStamp:n.timeStamp},e),this._mousePointerLastButtons=n.buttons,this._OnMouseEvent(n.type,n,t)}_OnPointerEvent(r,n){if(this._isExportToVideo)return;let c=0;if(n.pointerType==="mouse"&&(c=this._mousePointerLastButtons),this._PostToRuntimeMaybeSync(r,{pointerId:n.pointerId,pointerType:n.pointerType,button:n.button,buttons:n.buttons,lastButtons:c,clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,movementX:n.movementX||0,movementY:n.movementY||0,width:n.width||0,height:n.height||0,pressure:n.pressure||0,tangentialPressure:n.tangentialPressure||0,tiltX:n.tiltX||0,tiltY:n.tiltY||0,twist:n.twist||0,timeStamp:n.timeStamp},e),n.pointerType==="mouse"){let _="mousemove";r==="pointerdown"?_="mousedown":r==="pointerup"&&(_="mouseup"),this._OnMouseEvent(_,n,t),this._mousePointerLastButtons=n.buttons}}_OnPointerRawUpdate(r){this._OnPointerEvent("pointermove",r)}_OnTouchEvent(r,n){if(!this._isExportToVideo)for(let c=0,_=n.changedTouches.length;c<_;++c){const A=n.changedTouches[c];this._PostToRuntimeMaybeSync(r,{pointerId:A.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:A.clientX,clientY:A.clientY+this._vkTranslateYOffset,pageX:A.pageX,pageY:A.pageY+this._vkTranslateYOffset,movementX:n.movementX||0,movementY:n.movementY||0,width:(A.radiusX||A.webkitRadiusX||0)*2,height:(A.radiusY||A.webkitRadiusY||0)*2,pressure:A.force||A.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:A.rotationAngle||0,timeStamp:n.timeStamp},e)}}_HandlePointerDownFocus(r){window!==window.top&&window.focus(),this._IsElementCanvasOrDocument(r.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&document.activeElement.blur()}_IsElementCanvasOrDocument(r){return!r||r===document||r===window||r===document.body||r.tagName.toLowerCase()==="canvas"}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",r=>this._OnDeviceOrientation(r)),window.addEventListener("deviceorientationabsolute",r=>this._OnDeviceOrientationAbsolute(r)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=!0,window.addEventListener("devicemotion",r=>this._OnDeviceMotion(r)))}_OnDeviceOrientation(r){this._isExportToVideo||this.PostToRuntime("deviceorientation",{absolute:!!r.absolute,alpha:r.alpha||0,beta:r.beta||0,gamma:r.gamma||0,timeStamp:r.timeStamp,webkitCompassHeading:r.webkitCompassHeading,webkitCompassAccuracy:r.webkitCompassAccuracy},e)}_OnDeviceOrientationAbsolute(r){this._isExportToVideo||this.PostToRuntime("deviceorientationabsolute",{absolute:!!r.absolute,alpha:r.alpha||0,beta:r.beta||0,gamma:r.gamma||0,timeStamp:r.timeStamp},e)}_OnDeviceMotion(r){if(this._isExportToVideo)return;let n=null;const c=r.acceleration;c&&(n={x:c.x||0,y:c.y||0,z:c.z||0});let _=null;const A=r.accelerationIncludingGravity;A&&(_={x:A.x||0,y:A.y||0,z:A.z||0});let P=null;const I=r.rotationRate;I&&(P={alpha:I.alpha||0,beta:I.beta||0,gamma:I.gamma||0}),this.PostToRuntime("devicemotion",{acceleration:n,accelerationIncludingGravity:_,rotationRate:P,interval:r.interval,timeStamp:r.timeStamp},e)}_OnUpdateCanvasSize(r){const n=this.GetRuntimeInterface();if(n.IsExportingToVideo())return;const c=n.GetCanvas();c.style.width=r.styleWidth+"px",c.style.height=r.styleHeight+"px",c.style.marginLeft=r.marginLeft+"px",c.style.marginTop=r.marginTop+"px",document.documentElement.style.setProperty("--construct-scale",r.displayScale),this._isFirstSizeUpdate&&(c.style.display="",this._isFirstSizeUpdate=!1)}_OnInvokeDownload(r){const n=r.url,c=r.filename,_=document.createElement("a"),A=document.body;_.textContent=c,_.href=n,_.download=c,A.appendChild(_),_.click(),A.removeChild(_)}async _OnLoadWebFonts(r){const n=r.webfonts;await Promise.all(n.map(async c=>{const _=new FontFace(c.name,`url('${c.url}')`);document.fonts.add(_),await _.load()}))}async _OnRasterSvgImage(r){const n=r.blob,c=r.imageWidth,_=r.imageHeight,A=r.surfaceWidth,P=r.surfaceHeight,I=r.imageBitmapOpts,O=await self.C3_RasterSvgImageBlob(n,c,_,A,P);let R;return I?R=await createImageBitmap(O,I):R=await createImageBitmap(O),{imageBitmap:R,transferables:[R]}}async _OnGetSvgImageSize(r){return await self.C3_GetSvgImageSize(r.blob)}async _OnAddStylesheet(r){await o(r.url)}_PlayPendingMedia(){const r=[...this._mediaPendingPlay];if(this._mediaPendingPlay.clear(),!this._isSilent)for(const n of r){const c=n.play();c&&c.catch(_=>{this._mediaRemovedPendingPlay.has(n)||this._mediaPendingPlay.add(n)})}}TryPlayMedia(r){if(typeof r.play!="function")throw new Error("missing play function");this._mediaRemovedPendingPlay.delete(r);let n;try{n=r.play()}catch{this._mediaPendingPlay.add(r);return}n&&n.catch(c=>{this._mediaRemovedPendingPlay.has(r)||this._mediaPendingPlay.add(r)})}RemovePendingPlay(r){this._mediaPendingPlay.delete(r),this._mediaRemovedPendingPlay.add(r)}SetSilent(r){this._isSilent=!!r}_OnHideCordovaSplash(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}_OnDebugHighlight(r){if(!r.show){this._debugHighlightElem&&(this._debugHighlightElem.style.display="none");return}this._debugHighlightElem||(this._debugHighlightElem=document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));const c=this._debugHighlightElem;c.style.display="",c.style.left=r.left-1+"px",c.style.top=r.top-1+"px",c.style.width=r.width+2+"px",c.style.height=r.height+2+"px",c.textContent=r.name}_OnRegisterSW(){window.C3_RegisterSW&&window.C3_RegisterSW()}_OnPostToDebugger(r){window.c3_postToMessagePort&&(r.from="runtime",window.c3_postToMessagePort(r))}_InvokeFunctionFromJS(r,n){return this.PostToRuntimeAsync("js-invoke-function",{name:r,params:n})}_OnScriptCreateWorker(r){const n=r.url,c=r.opts,_=r.port2;new Worker(n,c).postMessage({type:"construct-worker-init",port2:_},[_])}_OnAlert(r){alert(r.message)}_OnWrapperMessage(r){r==="entered-fullscreen"?(m._SetWrapperIsFullscreenFlag(!0),this._OnFullscreenChange()):r==="exited-fullscreen"?(m._SetWrapperIsFullscreenFlag(!1),this._OnFullscreenChange()):console.warn("Unknown wrapper message: ",r)}_OnScreenReaderTextEvent(r){const n=r.type;if(n==="create"){const c=document.createElement("p");c.id="c3-sr-"+r.id,c.textContent=r.text,this._screenReaderTextWrap.appendChild(c)}else if(n==="update"){const c=document.getElementById("c3-sr-"+r.id);c?c.textContent=r.text:console.warn(`[Construct] Missing screen reader text with id ${r.id}`)}else if(n==="release"){const c=document.getElementById("c3-sr-"+r.id);c?c.remove():console.warn(`[Construct] Missing screen reader text with id ${r.id}`)}else console.warn(`[Construct] Unknown screen reader text update '${n}'`)}_SetExportingToVideo(r){this._isExportToVideo=!0;const n=document.createElement("h1");n.id="exportToVideoMessage",n.textContent=r.message,document.body.prepend(n),document.body.classList.add("exportingToVideo"),this.GetRuntimeInterface().GetCanvas().style.display="",this._iRuntime.SetIsExportingToVideo(r.duration)}_OnExportVideoProgress(r){this._exportVideoProgressMessage=r.message,this._exportVideoUpdateTimerId===-1&&(this._exportVideoUpdateTimerId=setTimeout(()=>this._DoUpdateExportVideoProgressMessage(),250))}_DoUpdateExportVideoProgressMessage(){this._exportVideoUpdateTimerId=-1;const r=document.getElementById("exportToVideoMessage");r&&(r.textContent=this._exportVideoProgressMessage)}_OnExportedToVideo(r){window.c3_postToMessagePort({type:"exported-video",arrayBuffer:r.arrayBuffer,contentType:r.contentType,time:r.time})}_OnExportedToImageSequence(r){window.c3_postToMessagePort({type:"exported-image-sequence",blobArr:r.blobArr,time:r.time,gif:r.gif})}};m.AddDOMHandlerClass(N)}{const m="dispatchworker.js",d="jobworker.js";self.JobSchedulerDOM=class{constructor(e){this._runtimeInterface=e,this._baseUrl=e.GetRuntimeBaseURL(),e.GetExportType()==="preview"?this._baseUrl+="workers/":this._baseUrl+=e.GetScriptFolder(),this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16),this._dispatchWorker=null,this._jobWorkers=[],this._inputPort=null,this._outputPort=null}_GetWorkerScriptFolder(){return this._runtimeInterface.GetExportType()==="playable-ad"?this._runtimeInterface.GetScriptFolder():""}async Init(){if(this._hasInitialised)throw new Error("already initialised");this._hasInitialised=!0;const e=this._runtimeInterface._GetWorkerURL(this._GetWorkerScriptFolder()+m);this._dispatchWorker=await this._runtimeInterface.CreateWorker(e,this._baseUrl,{name:"DispatchWorker"});const t=new MessageChannel;this._inputPort=t.port1,this._dispatchWorker.postMessage({type:"_init","in-port":t.port2},[t.port2]),this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const e=this._jobWorkers.length,t=this._runtimeInterface._GetWorkerURL(this._GetWorkerScriptFolder()+d),s=await this._runtimeInterface.CreateWorker(t,this._baseUrl,{name:"JobWorker"+e}),o=new MessageChannel,l=new MessageChannel;return this._dispatchWorker.postMessage({type:"_addJobWorker",port:o.port1},[o.port1]),s.postMessage({type:"init",number:e,"dispatch-port":o.port2,"output-port":l.port2},[o.port2,l.port2]),this._jobWorkers.push(s),l.port1}GetPortData(){return{inputPort:this._inputPort,outputPort:this._outputPort,maxNumWorkers:this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,this._outputPort]}}}window.C3_IsSupported&&(window.c3_runtimeInterface=new self.RuntimeInterface({useWorker:!1,workerMainUrl:"workermain.js",engineScripts:["scripts/c3runtime.js"],projectScripts:[],mainProjectScript:"",scriptFolder:"scripts/",workerDependencyScripts:[],exportType:"html5"}));{const m=180/Math.PI,d="audio";self.AudioDOMHandler=class extends self.DOMHandler{constructor(e){super(e,d),this._audioContext=null,this._destinationNode=null,this._hasUnblocked=!1,this._hasAttachedUnblockEvents=!1,this._unblockFunc=()=>this._UnblockAudioContext(),this._audioBuffers=[],this._audioInstances=[],this._lastAudioInstance=null,this._lastPlayedTags=[],this._loadedAudioUrls=new Set,this._lastTickCount=-1,this._pendingTags=new Map,this._masterVolume=1,this._isSilent=!1,this._timeScaleMode=0,this._timeScale=1,this._gameTime=0,this._panningModel="HRTF",this._distanceModel="inverse",this._refDistance=600,this._maxDistance=1e4,this._rolloffFactor=1,this._lastListenerPos=[0,0,0],this._lastListenerOrientation=[0,0,-1,0,1,0],this._playMusicAsSound=!1,this._hasAnySoftwareDecodedMusic=!1,this._supportsWebMOpus=this._iRuntime.IsAudioFormatSupported("audio/webm; codecs=opus"),this._effects=new Map,this._analysers=new Set,this._isPendingPostFxState=!1,this._hasStartedOfflineRender=!1,this._microphoneTag="",this._microphoneSource=null,self.C3Audio_OnMicrophoneStream=(t,s)=>this._OnMicrophoneStream(t,s),this._destMediaStreamNode=null,self.C3Audio_GetOutputStream=()=>this._OnGetOutputStream(),self.C3Audio_DOMInterface=this,this.AddRuntimeMessageHandlers([["create-audio-context",t=>this._CreateAudioContext(t)],["play",t=>this._Play(t)],["stop",t=>this._Stop(t)],["stop-all",()=>this._StopAll()],["set-paused",t=>this._SetPaused(t)],["set-volume",t=>this._SetVolume(t)],["fade-volume",t=>this._FadeVolume(t)],["set-master-volume",t=>this._SetMasterVolume(t)],["set-muted",t=>this._SetMuted(t)],["set-silent",t=>this._SetSilent(t)],["set-looping",t=>this._SetLooping(t)],["set-playback-rate",t=>this._SetPlaybackRate(t)],["set-stereo-pan",t=>this._SetStereoPan(t)],["seek",t=>this._Seek(t)],["preload",t=>this._Preload(t)],["unload",t=>this._Unload(t)],["unload-all",()=>this._UnloadAll()],["set-suspended",t=>this._SetSuspended(t)],["add-effect",t=>this._AddEffect(t)],["set-effect-param",t=>this._SetEffectParam(t)],["remove-effects",t=>this._RemoveEffects(t)],["tick",t=>this._OnTick(t)],["load-state",t=>this._OnLoadState(t)],["offline-render-audio",t=>this._OnOfflineRenderAudio(t)],["offline-render-finish",()=>this._OnOfflineRenderFinish()]])}async _CreateAudioContext(e){if((e.isiOSCordova||e.isSafari)&&(this._playMusicAsSound=!0),this._timeScaleMode=e.timeScaleMode,this._panningModel=["equalpower","HRTF","soundfield"][e.panningModel],this._distanceModel=["linear","inverse","exponential"][e.distanceModel],this._refDistance=e.refDistance,this._maxDistance=e.maxDistance,this._rolloffFactor=e.rolloffFactor,this._iRuntime.IsExportingToVideo()){this._playMusicAsSound=!0;const s=48e3;this._audioContext=new OfflineAudioContext({numberOfChannels:2,sampleRate:s,length:Math.ceil(this._iRuntime.GetExportToVideoDuration()*s)})}else{const s={latencyHint:e.latencyHint};if(this.SupportsWebMOpus()||(s.sampleRate=48e3),typeof AudioContext<"u")this._audioContext=new AudioContext(s);else if(typeof webkitAudioContext<"u")this._audioContext=new webkitAudioContext(s);else throw new Error("Web Audio API not supported");this._AttachUnblockEvents(),this._audioContext.onstatechange=()=>{this._audioContext.state!=="running"&&this._AttachUnblockEvents(),this.PostToRuntime("audiocontext-state",{audioContextState:this._audioContext.state})}}this._destinationNode=this._audioContext.createGain(),this._destinationNode.connect(this._audioContext.destination);const t=e.listenerPos;this._lastListenerPos[0]=t[0],this._lastListenerPos[1]=t[1],this._lastListenerPos[2]=t[2],this._audioContext.listener.setPosition(t[0],t[1],t[2]),this._audioContext.listener.setOrientation(...this._lastListenerOrientation),self.C3_GetAudioContextCurrentTime=()=>this.GetAudioCurrentTime();try{await Promise.all(e.preloadList.map(s=>this._GetAudioBuffer(s.originalUrl,s.url,s.type,!1)))}catch(s){console.error("[Construct] Preloading sounds failed: ",s)}return{sampleRate:this._audioContext.sampleRate,audioContextState:this._audioContext.state,outputLatency:this._audioContext.outputLatency||0}}_AttachUnblockEvents(){this._hasAttachedUnblockEvents||(this._hasUnblocked=!1,window.addEventListener("pointerup",this._unblockFunc,!0),window.addEventListener("touchend",this._unblockFunc,!0),window.addEventListener("click",this._unblockFunc,!0),window.addEventListener("keydown",this._unblockFunc,!0),this._hasAttachedUnblockEvents=!0)}_DetachUnblockEvents(){this._hasAttachedUnblockEvents&&(this._hasUnblocked=!0,window.removeEventListener("pointerup",this._unblockFunc,!0),window.removeEventListener("touchend",this._unblockFunc,!0),window.removeEventListener("click",this._unblockFunc,!0),window.removeEventListener("keydown",this._unblockFunc,!0),this._hasAttachedUnblockEvents=!1)}_UnblockAudioContext(){if(this._hasUnblocked)return;const e=this._audioContext;e.state==="suspended"&&e.resume&&e.resume();const t=e.createBuffer(1,220,22050),s=e.createBufferSource();s.buffer=t,s.connect(e.destination),s.start(0),e.state==="running"&&this._DetachUnblockEvents()}_MatchTagLists(e,t){for(const s of t){let o=!1;for(const l of e)if(self.AudioDOMHandler.EqualsNoCase(l,s)){o=!0;break}if(!o)return!1}return!0}GetAudioContext(){return this._audioContext}GetAudioCurrentTime(){return this._audioContext.currentTime}GetDestinationNode(){return this._destinationNode}GetDestinationForTag(e){const t=this._effects.get(e.toLowerCase());return t?t[0].GetInputNode():this.GetDestinationNode()}AddEffectForTag(e,t){e=e.toLowerCase();let s=this._effects.get(e);s||(s=[],this._effects.set(e,s)),t._SetIndex(s.length),t._SetTag(e),s.push(t),this._ReconnectEffects(e)}_ReconnectEffects(e){e=e.toLowerCase();let t=this.GetDestinationNode();const s=this._effects.get(e);if(s&&s.length){t=s[0].GetInputNode();for(let o=0,l=s.length;o<l;++o){const a=s[o];o+1===l?a.ConnectTo(this.GetDestinationNode()):a.ConnectTo(s[o+1].GetInputNode())}}for(const o of this.audioInstancesByEffectTag(e))o.Reconnect(t);this._microphoneSource&&this._microphoneTag===e&&(this._microphoneSource.disconnect(),this._microphoneSource.connect(t))}GetMasterVolume(){return this._masterVolume}IsSilent(){return this._isSilent}GetTimeScaleMode(){return this._timeScaleMode}GetTimeScale(){return this._timeScale}GetGameTime(){return this._gameTime}IsPlayMusicAsSound(){return this._playMusicAsSound}SupportsWebMOpus(){return this._supportsWebMOpus}_SetHasAnySoftwareDecodedMusic(){this._hasAnySoftwareDecodedMusic=!0}GetPanningModel(){return this._panningModel}GetDistanceModel(){return this._distanceModel}GetReferenceDistance(){return this._refDistance}GetMaxDistance(){return this._maxDistance}GetRolloffFactor(){return this._rolloffFactor}DecodeAudioData(e,t){return t?this._iRuntime._WasmDecodeWebMOpus(e).then(s=>{const o=this._audioContext.createBuffer(1,s.length,48e3);return o.getChannelData(0).set(s),o}):new Promise((s,o)=>{this._audioContext.decodeAudioData(e,s,o)})}TryPlayMedia(e){this._iRuntime.TryPlayMedia(e)}RemovePendingPlay(e){this._iRuntime.RemovePendingPlay(e)}ReleaseInstancesForBuffer(e){let t=0;for(let s=0,o=this._audioInstances.length;s<o;++s){const l=this._audioInstances[s];this._audioInstances[t]=l,l.GetBuffer()===e?l.Release():++t}this._audioInstances.length=t}ReleaseAllMusicBuffers(){let e=0;for(let t=0,s=this._audioBuffers.length;t<s;++t){const o=this._audioBuffers[t];this._audioBuffers[e]=o,o.IsMusic()?o.Release():++e}this._audioBuffers.length=e}*audioInstancesMatchingTags(e){if(e.length>0)for(const t of this._audioInstances)this._MatchTagLists(t.GetTags(),e)&&(yield t);else this._lastAudioInstance&&!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}*audioInstancesByEffectTag(e){if(e)for(const t of this._audioInstances)self.AudioDOMHandler.EqualsNoCase(t.GetEffectTag(),e)&&(yield t);else this._lastAudioInstance&&!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}async _GetAudioBuffer(e,t,s,o,l){for(const h of this._audioBuffers)if(h.GetUrl()===t)return await h.Load(),h;if(l)return null;o&&(this._playMusicAsSound||this._hasAnySoftwareDecodedMusic)&&this.ReleaseAllMusicBuffers();const a=self.C3AudioBuffer.Create(this,e,t,s,o);return this._audioBuffers.push(a),await a.Load(),this._loadedAudioUrls.has(e)||(this.PostToRuntime("buffer-metadata",{originalUrl:e,duration:a.GetDuration()}),this._loadedAudioUrls.add(e)),a}async _GetAudioInstance(e,t,s,o,l){for(const y of this._audioInstances)if(y.GetUrl()===t&&(y.CanBeRecycled()||l))return y.SetTags(o),y;const h=(await this._GetAudioBuffer(e,t,s,l)).CreateInstance(o);return this._audioInstances.push(h),h}_AddPendingTags(e){const t=e.join(" ");let s=this._pendingTags.get(t);if(!s){let o=null;s={pendingCount:0,promise:new Promise(a=>o=a),resolve:o},this._pendingTags.set(t,s)}s.pendingCount++}_RemovePendingTags(e){const t=e.join(" "),s=this._pendingTags.get(t);if(!s)throw new Error("expected pending tag");s.pendingCount--,s.pendingCount===0&&(s.resolve(),this._pendingTags.delete(t))}TagsReady(e){const t=(e.length===0?this._lastPlayedTags:e).join(" "),s=this._pendingTags.get(t);return s?s.promise:Promise.resolve()}_MaybeStartTicking(){if(this._analysers.size>0){this._StartTicking();return}for(const e of this._audioInstances)if(e.IsActive()){this._StartTicking();return}}Tick(){for(const s of this._analysers)s.Tick();const e=this.GetAudioCurrentTime();for(const s of this._audioInstances)s.Tick(e);const t=this._audioInstances.filter(s=>s.IsActive()).map(s=>s.GetState());this.PostToRuntime("state",{tickCount:this._lastTickCount,outputLatency:this._audioContext.outputLatency||0,audioInstances:t,analysers:[...this._analysers].map(s=>s.GetData())}),t.length===0&&this._analysers.size===0&&this._StopTicking()}PostTrigger(e,t,s){this.PostToRuntime("trigger",{type:e,tags:t,aiid:s})}async _Play(e){const t=e.originalUrl,s=e.url,o=e.type,l=e.isMusic,a=e.tags,h=e.isLooping,y=e.vol,v=e.pos,b=e.panning,g=e.stereoPan;let f=e.off;if(f>0&&!e.trueClock)if(this._audioContext.getOutputTimestamp){const u=this._audioContext.getOutputTimestamp();f=f-u.performanceTime/1e3+u.contextTime}else f=f-performance.now()/1e3+this._audioContext.currentTime;this._lastPlayedTags=a.slice(0),this._AddPendingTags(a);try{this._lastAudioInstance=await this._GetAudioInstance(t,s,o,a,l),b?(this._lastAudioInstance.SetPannerEnabled(!0),this._lastAudioInstance.SetPan(b.x,b.y,b.z,b.angle,b.innerAngle,b.outerAngle,b.outerGain),b.hasOwnProperty("uid")&&this._lastAudioInstance.SetUID(b.uid)):typeof g=="number"&&g!==0?(this._lastAudioInstance.SetStereoPannerEnabled(!0),this._lastAudioInstance.SetStereoPan(g)):(this._lastAudioInstance.SetPannerEnabled(!1),this._lastAudioInstance.SetStereoPannerEnabled(!1)),this._lastAudioInstance.Play(h,y,v,f)}catch(u){console.error("[Construct] Audio: error starting playback: ",u);return}finally{this._RemovePendingTags(a)}this._StartTicking()}_Stop(e){const t=e.tags;for(const s of this.audioInstancesMatchingTags(t))s.Stop()}_StopAll(){for(const e of this._audioInstances)e.Stop()}_SetPaused(e){const t=e.tags,s=e.paused;for(const o of this.audioInstancesMatchingTags(t))s?o.Pause():o.Resume();this._MaybeStartTicking()}_SetVolume(e){const t=e.tags,s=e.vol;for(const o of this.audioInstancesMatchingTags(t))o.SetVolume(s)}_SetStereoPan(e){const t=e.tags,s=e.p;for(const o of this.audioInstancesMatchingTags(t))o.SetStereoPannerEnabled(!0),o.SetStereoPan(s)}async _FadeVolume(e){const t=e.tags,s=e.vol,o=e.duration,l=e.stopOnEnd;await this.TagsReady(t);for(const a of this.audioInstancesMatchingTags(t))a.FadeVolume(s,o,l);this._MaybeStartTicking()}_SetMasterVolume(e){this._masterVolume=e.vol,this._destinationNode.gain.value=this._masterVolume}_SetMuted(e){const t=e.tags,s=e.isMuted;for(const o of this.audioInstancesMatchingTags(t))o.SetMuted(s)}_SetSilent(e){this._isSilent=e.isSilent,this._iRuntime.SetSilent(this._isSilent);for(const t of this._audioInstances)t._UpdateMuted()}_SetLooping(e){const t=e.tags,s=e.isLooping;for(const o of this.audioInstancesMatchingTags(t))o.SetLooping(s)}async _SetPlaybackRate(e){const t=e.tags,s=e.rate;await this.TagsReady(t);for(const o of this.audioInstancesMatchingTags(t))o.SetPlaybackRate(s)}async _Seek(e){const t=e.tags,s=e.pos;await this.TagsReady(t);for(const o of this.audioInstancesMatchingTags(t))o.Seek(s)}async _Preload(e){const t=e.originalUrl,s=e.url,o=e.type,l=e.isMusic;try{await this._GetAudioInstance(t,s,o,"",l)}catch(a){console.error("[Construct] Audio: error preloading: ",a)}}async _Unload(e){const t=e.url,s=e.type,o=e.isMusic,l=await this._GetAudioBuffer("",t,s,o,!0);if(!l)return;l.Release();const a=this._audioBuffers.indexOf(l);a!==-1&&this._audioBuffers.splice(a,1)}_UnloadAll(){for(const e of this._audioBuffers)e.Release();this._audioBuffers.length=0}_SetSuspended(e){const t=e.isSuspended;!t&&this._audioContext.resume&&this._audioContext.resume();for(const s of this._audioInstances)s.SetSuspended(t);t&&this._audioContext.suspend&&this._audioContext.suspend()}_OnTick(e){if(this._timeScale=e.timeScale,this._gameTime=e.gameTime,this._lastTickCount=e.tickCount,this._timeScaleMode!==0)for(const o of this._audioInstances)o._UpdatePlaybackRate();const t=e.listenerPos;t&&(this._lastListenerPos[0]!==t[0]||this._lastListenerPos[1]!==t[1]||this._lastListenerPos[2]!==t[2])&&(this._lastListenerPos[0]=t[0],this._lastListenerPos[1]=t[1],this._lastListenerPos[2]=t[2],this._audioContext.listener.setPosition(t[0],t[1],t[2]));const s=e.listenerOrientation;if(s&&(this._lastListenerOrientation[0]!==s[0]||this._lastListenerOrientation[1]!==s[1]||this._lastListenerOrientation[2]!==s[2]||this._lastListenerOrientation[3]!==s[3]||this._lastListenerOrientation[4]!==s[4]||this._lastListenerOrientation[5]!==s[5])){for(let o=0;o<6;++o)this._lastListenerOrientation[o]=s[o];this._audioContext.listener.setOrientation(...this._lastListenerOrientation)}for(const o of e.instPans){const l=o.uid;for(const a of this._audioInstances)a.GetUID()===l&&a.SetPanXYZA(o.x,o.y,o.z,o.angle)}}async _AddEffect(e){const t=e.type,s=e.tags,o=e.params;let l,a;if(t==="convolution")try{a=await this._GetAudioBuffer(e.bufferOriginalUrl,e.bufferUrl,e.bufferType,!1)}catch(h){console.log("[Construct] Audio: error loading convolution: ",h);return}for(const h of s){if(t==="filter")l=new self.C3AudioFilterFX(this,...o);else if(t==="delay")l=new self.C3AudioDelayFX(this,...o);else if(t==="convolution")l=new self.C3AudioConvolveFX(this,a.GetAudioBuffer(),...o),l._SetBufferInfo(e.bufferOriginalUrl,e.bufferUrl,e.bufferType);else if(t==="flanger")l=new self.C3AudioFlangerFX(this,...o);else if(t==="phaser")l=new self.C3AudioPhaserFX(this,...o);else if(t==="gain")l=new self.C3AudioGainFX(this,...o);else if(t==="stereopan")l=new self.C3AudioStereoPanFX(this,...o);else if(t==="tremolo")l=new self.C3AudioTremoloFX(this,...o);else if(t==="ringmod")l=new self.C3AudioRingModFX(this,...o);else if(t==="distortion")l=new self.C3AudioDistortionFX(this,...o);else if(t==="compressor")l=new self.C3AudioCompressorFX(this,...o);else if(t==="analyser")l=new self.C3AudioAnalyserFX(this,...o);else throw new Error("invalid effect type");this.AddEffectForTag(h,l)}this._PostUpdatedFxState()}_SetEffectParam(e){const t=e.tags,s=e.index,o=e.param,l=e.value,a=e.ramp,h=e.time;for(const y of t){const v=this._effects.get(y.toLowerCase());!v||s<0||s>=v.length||v[s].SetParam(o,l,a,h)}this._PostUpdatedFxState()}_RemoveEffects(e){const t=e.tags;for(const s of t){const o=s.toLowerCase(),l=this._effects.get(o);if(!l||!l.length)return;for(const a of l)a.Release();this._effects.delete(o),this._ReconnectEffects(o)}}_AddAnalyser(e){this._analysers.add(e),this._MaybeStartTicking()}_RemoveAnalyser(e){this._analysers.delete(e)}_PostUpdatedFxState(){this._isPendingPostFxState||(this._isPendingPostFxState=!0,Promise.resolve().then(()=>this._DoPostUpdatedFxState()))}_DoPostUpdatedFxState(){const e={};for(const[t,s]of this._effects)e[t]=s.map(o=>o.GetState());this.PostToRuntime("fxstate",{fxstate:e}),this._isPendingPostFxState=!1}async _OnLoadState(e){const t=e.saveLoadMode;if(t!==3){const a=[];for(const h of this._audioInstances)h.IsMusic()&&t===1||!h.IsMusic()&&t===2?a.push(h):h.Release();this._audioInstances=a}for(const a of this._effects.values())for(const h of a)h.Release();this._effects.clear(),this._timeScale=e.timeScale,this._gameTime=e.gameTime;const s=e.listenerPos;this._lastListenerPos[0]=s[0],this._lastListenerPos[1]=s[1],this._lastListenerPos[2]=s[2],this._audioContext.listener.setPosition(s[0],s[1],s[2]);const o=e.listenerOrientation;if(Array.isArray(o)){for(let a=0;a<6;++a)this._lastListenerOrientation[a]=o[a];this._audioContext.listener.setOrientation(...this._lastListenerOrientation)}this._isSilent=e.isSilent,this._iRuntime.SetSilent(this._isSilent),this._masterVolume=e.masterVolume,this._destinationNode.gain.value=this._masterVolume;const l=[];for(const a of Object.values(e.effects))l.push(Promise.all(a.map(h=>this._AddEffect(h))));await Promise.all(l),await Promise.all(e.playing.map(a=>this._LoadAudioInstance(a,t))),this._MaybeStartTicking()}async _LoadAudioInstance(e,t){if(t===3)return;const s=e.bufferOriginalUrl,o=e.bufferUrl,l=e.bufferType,a=e.isMusic,h=e.tags,y=e.isLooping,v=e.volume,b=e.playbackTime;if(a&&t===1||!a&&t===2)return;let g=null;try{g=await this._GetAudioInstance(s,o,l,h,a)}catch(f){console.error("[Construct] Audio: error loading audio state: ",f);return}g.LoadPanState(e.pan),g.LoadStereoPanState(e.stereoPan),g.Play(y,v,b,0),e.isPlaying||g.Pause(),g._LoadAdditionalState(e)}_OnMicrophoneStream(e,t){this._microphoneSource&&this._microphoneSource.disconnect(),this._microphoneTag=t.toLowerCase(),this._microphoneSource=this._audioContext.createMediaStreamSource(e),this._microphoneSource.connect(this.GetDestinationForTag(this._microphoneTag))}_OnGetOutputStream(){return this._destMediaStreamNode||(this._destMediaStreamNode=this._audioContext.createMediaStreamDestination(),this._destinationNode.connect(this._destMediaStreamNode)),this._destMediaStreamNode.stream}async _OnOfflineRenderAudio(e){try{const t=e.time,s=this._audioContext.suspend(t);this._hasStartedOfflineRender?this._audioContext.resume():(this._audioContext.startRendering().then(o=>this._OnOfflineRenderCompleted(o)).catch(o=>this._OnOfflineRenderError(o)),this._hasStartedOfflineRender=!0),await s}catch(t){this._OnOfflineRenderError(t)}}_OnOfflineRenderFinish(){this._audioContext.resume()}_OnOfflineRenderCompleted(e){const t=[];for(let s=0,o=e.numberOfChannels;s<o;++s){const l=e.getChannelData(s);t.push(l.buffer)}this._iRuntime.PostToRuntimeComponent("runtime","offline-audio-render-completed",{duration:e.duration,length:e.length,numberOfChannels:e.numberOfChannels,sampleRate:e.sampleRate,channelData:t},null,t)}_OnOfflineRenderError(e){console.error("[Audio] Offline rendering error: ",e)}static EqualsNoCase(e,t){return e===t||e.normalize().toLowerCase()===t.normalize().toLowerCase()}static ToDegrees(e){return e*m}static DbToLinearNoCap(e){return Math.pow(10,e/20)}static DbToLinear(e){return Math.max(Math.min(self.AudioDOMHandler.DbToLinearNoCap(e),1),0)}static LinearToDbNoCap(e){return Math.log(e)/Math.log(10)*20}static LinearToDb(e){return self.AudioDOMHandler.LinearToDbNoCap(Math.max(Math.min(e,1),0))}static e4(e,t){return 1-Math.exp(-t*e)}},self.RuntimeInterface.AddDOMHandlerClass(self.AudioDOMHandler)}self.C3AudioBuffer=class{constructor(d,i,e,t,s){this._audioDomHandler=d,this._originalUrl=i,this._url=e,this._type=t,this._isMusic=s,this._api="",this._loadState="not-loaded",this._loadPromise=null}Release(){this._loadState="not-loaded",this._audioDomHandler=null,this._loadPromise=null}static Create(d,i,e,t,s){const o=t==="audio/webm; codecs=opus"&&!d.SupportsWebMOpus();return s&&o&&d._SetHasAnySoftwareDecodedMusic(),!s||d.IsPlayMusicAsSound()||o?new self.C3WebAudioBuffer(d,i,e,t,s,o):new self.C3Html5AudioBuffer(d,i,e,t,s)}CreateInstance(d){return this._api==="html5"?new self.C3Html5AudioInstance(this._audioDomHandler,this,d):new self.C3WebAudioInstance(this._audioDomHandler,this,d)}_Load(){}Load(){return this._loadPromise||(this._loadPromise=this._Load()),this._loadPromise}IsLoaded(){}IsLoadedAndDecoded(){}HasFailedToLoad(){return this._loadState==="failed"}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}GetApi(){return this._api}GetOriginalUrl(){return this._originalUrl}GetUrl(){return this._url}GetContentType(){return this._type}IsMusic(){return this._isMusic}GetDuration(){}};self.C3Html5AudioBuffer=class extends self.C3AudioBuffer{constructor(d,i,e,t,s){super(d,i,e,t,s),this._api="html5",this._audioElem=new Audio,this._audioElem.crossOrigin="anonymous",this._audioElem.autoplay=!1,this._audioElem.preload="auto",this._loadResolve=null,this._loadReject=null,this._reachedCanPlayThrough=!1,this._audioElem.addEventListener("canplaythrough",()=>this._reachedCanPlayThrough=!0),this._outNode=this.GetAudioContext().createGain(),this._mediaSourceNode=null,this._audioElem.addEventListener("canplay",()=>{this._loadResolve&&(this._loadState="loaded",this._loadResolve(),this._loadResolve=null,this._loadReject=null),!(this._mediaSourceNode||!this._audioElem)&&(this._mediaSourceNode=this.GetAudioContext().createMediaElementSource(this._audioElem),this._mediaSourceNode.connect(this._outNode))}),this.onended=null,this._audioElem.addEventListener("ended",()=>{this.onended&&this.onended()}),this._audioElem.addEventListener("error",o=>this._OnError(o))}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this),this._outNode.disconnect(),this._outNode=null,this._mediaSourceNode.disconnect(),this._mediaSourceNode=null,this._audioElem&&!this._audioElem.paused&&this._audioElem.pause(),this.onended=null,this._audioElem=null,super.Release()}_Load(){return this._loadState="loading",new Promise((d,i)=>{this._loadResolve=d,this._loadReject=i,this._audioElem.src=this._url})}_OnError(d){console.error(`[Construct] Audio '${this._url}' error: `,d),this._loadReject&&(this._loadState="failed",this._loadReject(d),this._loadResolve=null,this._loadReject=null)}IsLoaded(){const d=this._audioElem.readyState>=4;return d&&(this._reachedCanPlayThrough=!0),d||this._reachedCanPlayThrough}IsLoadedAndDecoded(){return this.IsLoaded()}GetAudioElement(){return this._audioElem}GetOutputNode(){return this._outNode}GetDuration(){return this._audioElem.duration}};self.C3WebAudioBuffer=class extends self.C3AudioBuffer{constructor(d,i,e,t,s,o){super(d,i,e,t,s),this._api="webaudio",this._audioData=null,this._audioBuffer=null,this._needsSoftwareDecode=!!o}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this),this._audioData=null,this._audioBuffer=null,super.Release()}async _Fetch(){if(this._audioData)return this._audioData;const d=this._audioDomHandler.GetRuntimeInterface();if(d.GetExportType()==="cordova"&&d.IsRelativeURL(this._url)&&d.IsFileProtocol())this._audioData=await d.CordovaFetchLocalFileAsArrayBuffer(this._url);else{const i=await fetch(this._url);if(!i.ok)throw new Error(`error fetching audio data: ${i.status} ${i.statusText}`);this._audioData=await i.arrayBuffer()}}async _Decode(){if(this._audioBuffer)return this._audioBuffer;this._audioBuffer=await this._audioDomHandler.DecodeAudioData(this._audioData,this._needsSoftwareDecode),this._audioData=null}async _Load(){try{this._loadState="loading",await this._Fetch(),await this._Decode(),this._loadState="loaded"}catch(d){this._loadState="failed",console.error(`[Construct] Failed to load audio '${this._url}': `,d)}}IsLoaded(){return!!(this._audioData||this._audioBuffer)}IsLoadedAndDecoded(){return!!this._audioBuffer}GetAudioBuffer(){return this._audioBuffer}GetDuration(){return this._audioBuffer?this._audioBuffer.duration:0}};{let m=0;self.C3AudioInstance=class{constructor(i,e,t){this._audioDomHandler=i,this._buffer=e,this._tags=t,this._aiId=m++,this._gainNode=this.GetAudioContext().createGain(),this._gainNode.connect(this.GetDestinationNode()),this._pannerNode=null,this._isPannerEnabled=!1,this._pannerPosition=[0,0,0],this._pannerOrientation=[0,0,0],this._pannerConeParams=[0,0,0],this._stereoPannerNode=null,this._isStereoPannerEnabled=!1,this._stereoPan=0,this._isStopped=!0,this._isPaused=!1,this._resumeMe=!1,this._isLooping=!1,this._volume=1,this._isMuted=!1,this._playbackRate=1;const s=this._audioDomHandler.GetTimeScaleMode();this._isTimescaled=s===1&&!this.IsMusic()||s===2,this._instUid=-1,this._fadeEndTime=-1,this._stopOnFadeEnd=!1}Release(){this._audioDomHandler=null,this._buffer=null,this._pannerNode&&(this._pannerNode.disconnect(),this._pannerNode=null),this._stereoPannerNode&&(this._stereoPannerNode.disconnect(),this._stereoPannerNode=null),this._gainNode.disconnect(),this._gainNode=null}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}SetTags(i){this._tags=i}GetTags(){return this._tags}GetEffectTag(){return this._tags.length>0?this._tags[0]:""}GetDestinationNode(){return this._audioDomHandler.GetDestinationForTag(this.GetEffectTag())}GetCurrentTime(){return this._isTimescaled?this._audioDomHandler.GetGameTime():performance.now()/1e3}GetOriginalUrl(){return this._buffer.GetOriginalUrl()}GetUrl(){return this._buffer.GetUrl()}GetContentType(){return this._buffer.GetContentType()}GetBuffer(){return this._buffer}IsMusic(){return this._buffer.IsMusic()}GetAiId(){return this._aiId}HasEnded(){}CanBeRecycled(){}IsPlaying(){return!this._isStopped&&!this._isPaused&&!this.HasEnded()}IsActive(){return!this._isStopped&&!this.HasEnded()}GetPlaybackTime(){}GetDuration(i){let e=this._buffer.GetDuration();return i&&(e/=this._playbackRate||.001),e}Play(i,e,t,s){}Stop(){}Pause(){}IsPaused(){return this._isPaused}Resume(){}SetVolume(i){this._volume=i,this._gainNode.gain.cancelScheduledValues(0),this._fadeEndTime=-1,this._gainNode.gain.value=this.GetOutputVolume()}FadeVolume(i,e,t){if(this.IsMuted())return;const s=this._gainNode.gain;s.cancelScheduledValues(0);const o=this._audioDomHandler.GetAudioCurrentTime(),l=o+e;s.setValueAtTime(s.value,o),s.linearRampToValueAtTime(i,l),this._volume=i,this._fadeEndTime=l,this._stopOnFadeEnd=t}_UpdateVolume(){this.SetVolume(this._volume)}Tick(i){this._fadeEndTime!==-1&&i>=this._fadeEndTime&&(this._fadeEndTime=-1,this._stopOnFadeEnd&&this.Stop(),this._audioDomHandler.PostTrigger("fade-ended",this._tags,this._aiId))}GetOutputVolume(){const i=this._volume;return isFinite(i)?i:0}SetMuted(i){i=!!i,this._isMuted!==i&&(this._isMuted=i,this._UpdateMuted())}IsMuted(){return this._isMuted}IsSilent(){return this._audioDomHandler.IsSilent()}_UpdateMuted(){}SetLooping(i){}IsLooping(){return this._isLooping}SetPlaybackRate(i){this._playbackRate!==i&&(this._playbackRate=i,this._UpdatePlaybackRate())}_UpdatePlaybackRate(){}GetPlaybackRate(){return this._playbackRate}Seek(i){}SetSuspended(i){}SetPannerEnabled(i){i=!!i,this._isPannerEnabled!==i&&(this._isPannerEnabled=i,this._isPannerEnabled?(this.SetStereoPannerEnabled(!1),this._pannerNode||(this._pannerNode=this.GetAudioContext().createPanner(),this._pannerNode.panningModel=this._audioDomHandler.GetPanningModel(),this._pannerNode.distanceModel=this._audioDomHandler.GetDistanceModel(),this._pannerNode.refDistance=this._audioDomHandler.GetReferenceDistance(),this._pannerNode.maxDistance=this._audioDomHandler.GetMaxDistance(),this._pannerNode.rolloffFactor=this._audioDomHandler.GetRolloffFactor()),this._gainNode.disconnect(),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(this.GetDestinationNode())):(this._pannerNode.disconnect(),this._gainNode.disconnect(),this._gainNode.connect(this.GetDestinationNode())))}SetPan(i,e,t,s,o,l,a){if(!this._isPannerEnabled)return;this.SetPanXYZA(i,e,t,s);const h=self.AudioDOMHandler.ToDegrees;this._pannerConeParams[0]!==h(o)&&(this._pannerConeParams[0]=h(o),this._pannerNode.coneInnerAngle=h(o)),this._pannerConeParams[1]!==h(l)&&(this._pannerConeParams[1]=h(l),this._pannerNode.coneOuterAngle=h(l)),this._pannerConeParams[2]!==a&&(this._pannerConeParams[2]=a,this._pannerNode.coneOuterGain=a)}SetPanXYZA(i,e,t,s){if(!this._isPannerEnabled)return;const o=this._pannerPosition,l=this._pannerOrientation,a=Math.cos(s),h=Math.sin(s);(o[0]!==i||o[1]!==e||o[2]!==t)&&(o[0]=i,o[1]=e,o[2]=t,this._pannerNode.setPosition(...o)),(l[0]!==a||l[1]!==h||l[2]!==0)&&(l[0]=a,l[1]=h,l[2]=0,this._pannerNode.setOrientation(...l))}SetStereoPannerEnabled(i){i=!!i,this._isStereoPannerEnabled!==i&&(this._isStereoPannerEnabled=i,this._isStereoPannerEnabled?(this.SetPannerEnabled(!1),this._stereoPannerNode=this.GetAudioContext().createStereoPanner(),this._gainNode.disconnect(),this._gainNode.connect(this._stereoPannerNode),this._stereoPannerNode.connect(this.GetDestinationNode())):(this._stereoPannerNode.disconnect(),this._stereoPannerNode=null,this._gainNode.disconnect(),this._gainNode.connect(this.GetDestinationNode())))}SetStereoPan(i){this._isStereoPannerEnabled&&this._stereoPan!==i&&(this._stereoPannerNode.pan.value=i,this._stereoPan=i)}SetUID(i){this._instUid=i}GetUID(){return this._instUid}GetResumePosition(){}Reconnect(i){const e=this._stereoPannerNode||this._pannerNode||this._gainNode;e.disconnect(),e.connect(i)}GetState(){return{aiid:this.GetAiId(),tags:this._tags,duration:this.GetDuration(),volume:this._fadeEndTime===-1?this._volume:this._gainNode.gain.value,isPlaying:this.IsPlaying(),playbackTime:this.GetPlaybackTime(),playbackRate:this.GetPlaybackRate(),uid:this._instUid,bufferOriginalUrl:this.GetOriginalUrl(),bufferUrl:"",bufferType:this.GetContentType(),isMusic:this.IsMusic(),isLooping:this.IsLooping(),isMuted:this.IsMuted(),resumePosition:this.GetResumePosition(),pan:this.GetPanState(),stereoPan:this.GetStereoPanState()}}_LoadAdditionalState(i){this.SetPlaybackRate(i.playbackRate),this.SetMuted(i.isMuted)}GetPanState(){if(!this._pannerNode)return null;const i=this._pannerNode;return{pos:this._pannerPosition,orient:this._pannerOrientation,cia:i.coneInnerAngle,coa:i.coneOuterAngle,cog:i.coneOuterGain,uid:this._instUid}}LoadPanState(i){if(!i){this.SetPannerEnabled(!1);return}this.SetPannerEnabled(!0);const e=this._pannerNode,t=i.pos;this._pannerPosition[0]=t[0],this._pannerPosition[1]=t[1],this._pannerPosition[2]=t[2];const s=i.orient;this._pannerOrientation[0]=s[0],this._pannerOrientation[1]=s[1],this._pannerOrientation[2]=s[2],e.setPosition(...this._pannerPosition),e.setOrientation(...this._pannerOrientation),this._pannerConeParams[0]=i.cia,this._pannerConeParams[1]=i.coa,this._pannerConeParams[2]=i.cog,e.coneInnerAngle=i.cia,e.coneOuterAngle=i.coa,e.coneOuterGain=i.cog,this._instUid=i.uid}GetStereoPanState(){return this._stereoPannerNode?this._stereoPan:null}LoadStereoPanState(i){if(typeof i!="number"){this.SetStereoPannerEnabled(!1);return}this.SetStereoPannerEnabled(!0),this.SetStereoPan(i)}}}self.C3Html5AudioInstance=class extends self.C3AudioInstance{constructor(d,i,e){super(d,i,e),this._buffer.GetOutputNode().connect(this._gainNode),this._buffer.onended=()=>this._OnEnded()}Release(){this.Stop(),this._buffer.GetOutputNode().disconnect(),super.Release()}GetAudioElement(){return this._buffer.GetAudioElement()}_OnEnded(){this._isStopped=!0,this._instUid=-1,this._audioDomHandler.PostTrigger("ended",this._tags,this._aiId)}HasEnded(){return this.GetAudioElement().ended}CanBeRecycled(){return this._isStopped?!0:this.HasEnded()}GetPlaybackTime(){let d=this.GetAudioElement().currentTime;return this._isLooping||(d=Math.min(d,this.GetDuration())),d}Play(d,i,e,t){const s=this.GetAudioElement();if(s.playbackRate!==1&&(s.playbackRate=1),s.loop!==d&&(s.loop=d),this.SetVolume(i),s.muted&&(s.muted=!1),s.currentTime!==e)try{s.currentTime=e}catch(o){console.warn(`[Construct] Exception seeking audio '${this._buffer.GetUrl()}' to position '${e}': `,o)}this._audioDomHandler.TryPlayMedia(s),this._isStopped=!1,this._isPaused=!1,this._isLooping=d,this._playbackRate=1}Stop(){const d=this.GetAudioElement();d.paused||d.pause(),this._audioDomHandler.RemovePendingPlay(d),this._isStopped=!0,this._isPaused=!1,this._instUid=-1}Pause(){if(this._isPaused||this._isStopped||this.HasEnded())return;const d=this.GetAudioElement();d.paused||d.pause(),this._audioDomHandler.RemovePendingPlay(d),this._isPaused=!0}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._isPaused=!1)}_UpdateMuted(){this.GetAudioElement().muted=this._isMuted||this.IsSilent()}SetLooping(d){d=!!d,this._isLooping!==d&&(this._isLooping=d,this.GetAudioElement().loop=d)}_UpdatePlaybackRate(){let d=this._playbackRate;this._isTimescaled&&(d*=this._audioDomHandler.GetTimeScale());try{this.GetAudioElement().playbackRate=d}catch(i){console.warn(`[Construct] Unable to set playback rate '${d}':`,i)}}Seek(d){if(!(this._isStopped||this.HasEnded()))try{this.GetAudioElement().currentTime=d}catch(i){console.warn(`[Construct] Error seeking audio to '${d}': `,i)}}GetResumePosition(){return this.GetPlaybackTime()}SetSuspended(d){d?this.IsPlaying()?(this.GetAudioElement().pause(),this._resumeMe=!0):this._resumeMe=!1:this._resumeMe&&(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._resumeMe=!1)}};self.C3WebAudioInstance=class extends self.C3AudioInstance{constructor(d,i,e){super(d,i,e),this._bufferSource=null,this._onended_handler=t=>this._OnEnded(t),this._hasPlaybackEnded=!0,this._activeSource=null,this._playStartTime=0,this._playFromSeekPos=0,this._resumePosition=0,this._muteVol=1}Release(){this.Stop(),this._ReleaseBufferSource(),this._onended_handler=null,super.Release()}_ReleaseBufferSource(){this._bufferSource&&(this._bufferSource.onended=null,this._bufferSource.disconnect(),this._bufferSource.buffer=null),this._bufferSource=null,this._activeSource=null}_OnEnded(d){this._isPaused||this._resumeMe||d.target===this._activeSource&&(this._hasPlaybackEnded=!0,this._isStopped=!0,this._instUid=-1,this._ReleaseBufferSource(),this._audioDomHandler.PostTrigger("ended",this._tags,this._aiId))}HasEnded(){return!this._isStopped&&this._bufferSource&&this._bufferSource.loop||this._isPaused?!1:this._hasPlaybackEnded}CanBeRecycled(){return!this._bufferSource||this._isStopped?!0:this.HasEnded()}GetPlaybackTime(){let d=0;return this._isPaused?d=this._resumePosition:d=this._playFromSeekPos+(this.GetCurrentTime()-this._playStartTime)*this._playbackRate,this._isLooping||(d=Math.min(d,this.GetDuration())),d}Play(d,i,e,t){this._muteVol=1,this.SetVolume(i),this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=d,this._bufferSource.start(t,e),this._hasPlaybackEnded=!1,this._isStopped=!1,this._isPaused=!1,this._isLooping=d,this._playbackRate=1,this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=e}Stop(){if(this._bufferSource)try{this._bufferSource.stop(0)}catch{}this._isStopped=!0,this._isPaused=!1,this._instUid=-1}Pause(){this._isPaused||this._isStopped||this.HasEnded()||(this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._isPaused=!0,this._bufferSource.stop(0))}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource.start(0,this._resumePosition),this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,this._isPaused=!1)}GetOutputVolume(){return super.GetOutputVolume()*this._muteVol}_UpdateMuted(){this._muteVol=this._isMuted||this.IsSilent()?0:1,this._UpdateVolume()}SetLooping(d){d=!!d,this._isLooping!==d&&(this._isLooping=d,this._bufferSource&&(this._bufferSource.loop=d))}_UpdatePlaybackRate(){let d=this._playbackRate;this._isTimescaled&&(d*=this._audioDomHandler.GetTimeScale()),this._bufferSource&&(this._bufferSource.playbackRate.value=d)}Seek(d){this._isStopped||this.HasEnded()||(this._isPaused?this._resumePosition=d:(this.Pause(),this._resumePosition=d,this.Resume()))}GetResumePosition(){return this._resumePosition}SetSuspended(d){d?this.IsPlaying()?(this._resumeMe=!0,this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._bufferSource.stop(0)):this._resumeMe=!1:this._resumeMe&&(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource.start(0,this._resumePosition),this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,this._resumeMe=!1)}_LoadAdditionalState(d){super._LoadAdditionalState(d),this._resumePosition=d.resumePosition}};{class m{constructor(i){this._audioDomHandler=i,this._audioContext=i.GetAudioContext(),this._index=-1,this._tag="",this._type="",this._params=null}Release(){this._audioContext=null}_SetIndex(i){this._index=i}GetIndex(){return this._index}_SetTag(i){this._tag=i}GetTag(){return this._tag}CreateGain(){return this._audioContext.createGain()}GetInputNode(){}ConnectTo(i){}SetAudioParam(i,e,t,s){if(i.cancelScheduledValues(0),s===0){i.value=e;return}const o=this._audioContext.currentTime;switch(s+=o,t){case 0:i.setValueAtTime(e,s);break;case 1:i.setValueAtTime(i.value,o),i.linearRampToValueAtTime(e,s);break;case 2:i.setValueAtTime(i.value,o),i.exponentialRampToValueAtTime(e,s);break}}GetState(){return{type:this._type,tag:this._tag,params:this._params}}}self.C3AudioFilterFX=class extends m{constructor(i,e,t,s,o,l,a){super(i),this._type="filter",this._params=[e,t,s,o,l,a],this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode.gain.value=a,this._dryNode=this.CreateGain(),this._dryNode.gain.value=1-a,this._filterNode=this._audioContext.createBiquadFilter(),this._filterNode.type=e,this._filterNode.frequency.value=t,this._filterNode.detune.value=s,this._filterNode.Q.value=o,this._filterNode.gain.vlaue=l,this._inputNode.connect(this._filterNode),this._inputNode.connect(this._dryNode),this._filterNode.connect(this._wetNode)}Release(){this._inputNode.disconnect(),this._filterNode.disconnect(),this._wetNode.disconnect(),this._dryNode.disconnect(),super.Release()}ConnectTo(i){this._wetNode.disconnect(),this._wetNode.connect(i),this._dryNode.disconnect(),this._dryNode.connect(i)}GetInputNode(){return this._inputNode}SetParam(i,e,t,s){switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[5]=e,this.SetAudioParam(this._wetNode.gain,e,t,s),this.SetAudioParam(this._dryNode.gain,1-e,t,s);break;case 1:this._params[1]=e,this.SetAudioParam(this._filterNode.frequency,e,t,s);break;case 2:this._params[2]=e,this.SetAudioParam(this._filterNode.detune,e,t,s);break;case 3:this._params[3]=e,this.SetAudioParam(this._filterNode.Q,e,t,s);break;case 4:this._params[4]=e,this.SetAudioParam(this._filterNode.gain,e,t,s);break}}},self.C3AudioDelayFX=class extends m{constructor(i,e,t,s){super(i),this._type="delay",this._params=[e,t,s],this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode.gain.value=s,this._dryNode=this.CreateGain(),this._dryNode.gain.value=1-s,this._mainNode=this.CreateGain(),this._delayNode=this._audioContext.createDelay(e),this._delayNode.delayTime.value=e,this._delayGainNode=this.CreateGain(),this._delayGainNode.gain.value=t,this._inputNode.connect(this._mainNode),this._inputNode.connect(this._dryNode),this._mainNode.connect(this._wetNode),this._mainNode.connect(this._delayNode),this._delayNode.connect(this._delayGainNode),this._delayGainNode.connect(this._mainNode)}Release(){this._inputNode.disconnect(),this._wetNode.disconnect(),this._dryNode.disconnect(),this._mainNode.disconnect(),this._delayNode.disconnect(),this._delayGainNode.disconnect(),super.Release()}ConnectTo(i){this._wetNode.disconnect(),this._wetNode.connect(i),this._dryNode.disconnect(),this._dryNode.connect(i)}GetInputNode(){return this._inputNode}SetParam(i,e,t,s){const o=self.AudioDOMHandler.DbToLinear;switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[2]=e,this.SetAudioParam(this._wetNode.gain,e,t,s),this.SetAudioParam(this._dryNode.gain,1-e,t,s);break;case 4:this._params[1]=o(e),this.SetAudioParam(this._delayGainNode.gain,o(e),t,s);break;case 5:this._params[0]=e,this.SetAudioParam(this._delayNode.delayTime,e,t,s);break}}},self.C3AudioConvolveFX=class extends m{constructor(i,e,t,s){super(i),this._type="convolution",this._params=[t,s],this._bufferOriginalUrl="",this._bufferUrl="",this._bufferType="",this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode.gain.value=s,this._dryNode=this.CreateGain(),this._dryNode.gain.value=1-s,this._convolveNode=this._audioContext.createConvolver(),this._convolveNode.normalize=t,this._convolveNode.buffer=e,this._inputNode.connect(this._convolveNode),this._inputNode.connect(this._dryNode),this._convolveNode.connect(this._wetNode)}Release(){this._inputNode.disconnect(),this._convolveNode.disconnect(),this._wetNode.disconnect(),this._dryNode.disconnect(),super.Release()}ConnectTo(i){this._wetNode.disconnect(),this._wetNode.connect(i),this._dryNode.disconnect(),this._dryNode.connect(i)}GetInputNode(){return this._inputNode}SetParam(i,e,t,s){switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[1]=e,this.SetAudioParam(this._wetNode.gain,e,t,s),this.SetAudioParam(this._dryNode.gain,1-e,t,s);break}}_SetBufferInfo(i,e,t){this._bufferOriginalUrl=i,this._bufferUrl=e,this._bufferType=t}GetState(){const i=super.GetState();return i.bufferOriginalUrl=this._bufferOriginalUrl,i.bufferUrl="",i.bufferType=this._bufferType,i}},self.C3AudioFlangerFX=class extends m{constructor(i,e,t,s,o,l){super(i),this._type="flanger",this._params=[e,t,s,o,l],this._inputNode=this.CreateGain(),this._dryNode=this.CreateGain(),this._dryNode.gain.value=1-l/2,this._wetNode=this.CreateGain(),this._wetNode.gain.value=l/2,this._feedbackNode=this.CreateGain(),this._feedbackNode.gain.value=o,this._delayNode=this._audioContext.createDelay(e+t),this._delayNode.delayTime.value=e,this._oscNode=this._audioContext.createOscillator(),this._oscNode.frequency.value=s,this._oscGainNode=this.CreateGain(),this._oscGainNode.gain.value=t,this._inputNode.connect(this._delayNode),this._inputNode.connect(this._dryNode),this._delayNode.connect(this._wetNode),this._delayNode.connect(this._feedbackNode),this._feedbackNode.connect(this._delayNode),this._oscNode.connect(this._oscGainNode),this._oscGainNode.connect(this._delayNode.delayTime),this._oscNode.start(0)}Release(){this._oscNode.stop(0),this._inputNode.disconnect(),this._delayNode.disconnect(),this._oscNode.disconnect(),this._oscGainNode.disconnect(),this._dryNode.disconnect(),this._wetNode.disconnect(),this._feedbackNode.disconnect(),super.Release()}ConnectTo(i){this._wetNode.disconnect(),this._wetNode.connect(i),this._dryNode.disconnect(),this._dryNode.connect(i)}GetInputNode(){return this._inputNode}SetParam(i,e,t,s){switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[4]=e,this.SetAudioParam(this._wetNode.gain,e/2,t,s),this.SetAudioParam(this._dryNode.gain,1-e/2,t,s);break;case 6:this._params[1]=e/1e3,this.SetAudioParam(this._oscGainNode.gain,e/1e3,t,s);break;case 7:this._params[2]=e,this.SetAudioParam(this._oscNode.frequency,e,t,s);break;case 8:this._params[3]=e/100,this.SetAudioParam(this._feedbackNode.gain,e/100,t,s);break}}},self.C3AudioPhaserFX=class extends m{constructor(i,e,t,s,o,l,a){super(i),this._type="phaser",this._params=[e,t,s,o,l,a],this._inputNode=this.CreateGain(),this._dryNode=this.CreateGain(),this._dryNode.gain.value=1-a/2,this._wetNode=this.CreateGain(),this._wetNode.gain.value=a/2,this._filterNode=this._audioContext.createBiquadFilter(),this._filterNode.type="allpass",this._filterNode.frequency.value=e,this._filterNode.detune.value=t,this._filterNode.Q.value=s,this._oscNode=this._audioContext.createOscillator(),this._oscNode.frequency.value=l,this._oscGainNode=this.CreateGain(),this._oscGainNode.gain.value=o,this._inputNode.connect(this._filterNode),this._inputNode.connect(this._dryNode),this._filterNode.connect(this._wetNode),this._oscNode.connect(this._oscGainNode),this._oscGainNode.connect(this._filterNode.frequency),this._oscNode.start(0)}Release(){this._oscNode.stop(0),this._inputNode.disconnect(),this._filterNode.disconnect(),this._oscNode.disconnect(),this._oscGainNode.disconnect(),this._dryNode.disconnect(),this._wetNode.disconnect(),super.Release()}ConnectTo(i){this._wetNode.disconnect(),this._wetNode.connect(i),this._dryNode.disconnect(),this._dryNode.connect(i)}GetInputNode(){return this._inputNode}SetParam(i,e,t,s){switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[5]=e,this.SetAudioParam(this._wetNode.gain,e/2,t,s),this.SetAudioParam(this._dryNode.gain,1-e/2,t,s);break;case 1:this._params[0]=e,this.SetAudioParam(this._filterNode.frequency,e,t,s);break;case 2:this._params[1]=e,this.SetAudioParam(this._filterNode.detune,e,t,s);break;case 3:this._params[2]=e,this.SetAudioParam(this._filterNode.Q,e,t,s);break;case 6:this._params[3]=e,this.SetAudioParam(this._oscGainNode.gain,e,t,s);break;case 7:this._params[4]=e,this.SetAudioParam(this._oscNode.frequency,e,t,s);break}}},self.C3AudioGainFX=class extends m{constructor(i,e){super(i),this._type="gain",this._params=[e],this._node=this.CreateGain(),this._node.gain.value=e}Release(){this._node.disconnect(),super.Release()}ConnectTo(i){this._node.disconnect(),this._node.connect(i)}GetInputNode(){return this._node}SetParam(i,e,t,s){const o=self.AudioDOMHandler.DbToLinear;switch(i){case 4:this._params[0]=o(e),this.SetAudioParam(this._node.gain,o(e),t,s);break}}},self.C3AudioStereoPanFX=class extends m{constructor(i,e){super(i),this._type="stereopan",this._params=[e],this._node=this._audioContext.createStereoPanner(),this._node.pan.value=e}Release(){this._node.disconnect(),super.Release()}ConnectTo(i){this._node.disconnect(),this._node.connect(i)}GetInputNode(){return this._node}SetParam(i,e,t,s){switch(e=Math.min(Math.max(e/100,-1),1),i){case 9:this._params[0]=e,this.SetAudioParam(this._node.pan,e,t,s);break}}},self.C3AudioTremoloFX=class extends m{constructor(i,e,t){super(i),this._type="tremolo",this._params=[e,t],this._node=this.CreateGain(),this._node.gain.value=1-t/2,this._oscNode=this._audioContext.createOscillator(),this._oscNode.frequency.value=e,this._oscGainNode=this.CreateGain(),this._oscGainNode.gain.value=t/2,this._oscNode.connect(this._oscGainNode),this._oscGainNode.connect(this._node.gain),this._oscNode.start(0)}Release(){this._oscNode.stop(0),this._oscNode.disconnect(),this._oscGainNode.disconnect(),this._node.disconnect(),super.Release()}ConnectTo(i){this._node.disconnect(),this._node.connect(i)}GetInputNode(){return this._node}SetParam(i,e,t,s){switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[1]=e,this.SetAudioParam(this._node.gain,1-e/2,t,s),this.SetAudioParam(this._oscGainNode.gain,e/2,t,s);break;case 7:this._params[0]=e,this.SetAudioParam(this._oscNode.frequency,e,t,s);break}}},self.C3AudioRingModFX=class extends m{constructor(i,e,t){super(i),this._type="ringmod",this._params=[e,t],this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode.gain.value=t,this._dryNode=this.CreateGain(),this._dryNode.gain.value=1-t,this._ringNode=this.CreateGain(),this._ringNode.gain.value=0,this._oscNode=this._audioContext.createOscillator(),this._oscNode.frequency.value=e,this._oscNode.connect(this._ringNode.gain),this._oscNode.start(0),this._inputNode.connect(this._ringNode),this._inputNode.connect(this._dryNode),this._ringNode.connect(this._wetNode)}Release(){this._oscNode.stop(0),this._oscNode.disconnect(),this._ringNode.disconnect(),this._inputNode.disconnect(),this._wetNode.disconnect(),this._dryNode.disconnect(),super.Release()}ConnectTo(i){this._wetNode.disconnect(),this._wetNode.connect(i),this._dryNode.disconnect(),this._dryNode.connect(i)}GetInputNode(){return this._inputNode}SetParam(i,e,t,s){switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[1]=e,this.SetAudioParam(this._wetNode.gain,e,t,s),this.SetAudioParam(this._dryNode.gain,1-e,t,s);break;case 7:this._params[0]=e,this.SetAudioParam(this._oscNode.frequency,e,t,s);break}}},self.C3AudioDistortionFX=class extends m{constructor(i,e,t,s,o,l){super(i),this._type="distortion",this._params=[e,t,s,o,l],this._inputNode=this.CreateGain(),this._preGain=this.CreateGain(),this._postGain=this.CreateGain(),this._SetDrive(s,o),this._wetNode=this.CreateGain(),this._wetNode.gain.value=l,this._dryNode=this.CreateGain(),this._dryNode.gain.value=1-l,this._waveShaper=this._audioContext.createWaveShaper(),this._curve=new Float32Array(65536),this._GenerateColortouchCurve(e,t),this._waveShaper.curve=this._curve,this._inputNode.connect(this._preGain),this._inputNode.connect(this._dryNode),this._preGain.connect(this._waveShaper),this._waveShaper.connect(this._postGain),this._postGain.connect(this._wetNode)}Release(){this._inputNode.disconnect(),this._preGain.disconnect(),this._waveShaper.disconnect(),this._postGain.disconnect(),this._wetNode.disconnect(),this._dryNode.disconnect(),super.Release()}_SetDrive(i,e){i<.01&&(i=.01),this._preGain.gain.value=i,this._postGain.gain.value=Math.pow(1/i,.6)*e}_GenerateColortouchCurve(i,e){for(let o=0;o<32768;++o){let l=o/32768;l=this._Shape(l,i,e),this._curve[32768+o]=l,this._curve[32768-o-1]=-l}}_Shape(i,e,t){const o=1.05*t*e-e,l=i<0?-1:1,a=i<0?-i:i;let h=a<e?a:e+o*self.AudioDOMHandler.e4(a-e,1/o);return h*=l,h}ConnectTo(i){this._wetNode.disconnect(),this._wetNode.connect(i),this._dryNode.disconnect(),this._dryNode.connect(i)}GetInputNode(){return this._inputNode}SetParam(i,e,t,s){switch(i){case 0:e=Math.max(Math.min(e/100,1),0),this._params[4]=e,this.SetAudioParam(this._wetNode.gain,e,t,s),this.SetAudioParam(this._dryNode.gain,1-e,t,s);break}}},self.C3AudioCompressorFX=class extends m{constructor(i,e,t,s,o,l){super(i),this._type="compressor",this._params=[e,t,s,o,l],this._node=this._audioContext.createDynamicsCompressor(),this._node.threshold.value=e,this._node.knee.value=t,this._node.ratio.value=s,this._node.attack.value=o,this._node.release.value=l}Release(){this._node.disconnect(),super.Release()}ConnectTo(i){this._node.disconnect(),this._node.connect(i)}GetInputNode(){return this._node}SetParam(i,e,t,s){}},self.C3AudioAnalyserFX=class extends m{constructor(i,e,t){super(i),this._type="analyser",this._params=[e,t],this._node=this._audioContext.createAnalyser(),this._node.fftSize=e,this._node.smoothingTimeConstant=t,this._freqBins=new Float32Array(this._node.frequencyBinCount),this._signal=new Uint8Array(e),this._peak=0,this._rms=0,this._audioDomHandler._AddAnalyser(this)}Release(){this._audioDomHandler._RemoveAnalyser(this),this._node.disconnect(),super.Release()}Tick(){this._node.getFloatFrequencyData(this._freqBins),this._node.getByteTimeDomainData(this._signal);const i=this._node.fftSize;this._peak=0;let e=0;for(let s=0;s<i;++s){let o=(this._signal[s]-128)/128;o<0&&(o=-o),this._peak<o&&(this._peak=o),e+=o*o}const t=self.AudioDOMHandler.LinearToDb;this._peak=t(this._peak),this._rms=t(Math.sqrt(e/i))}ConnectTo(i){this._node.disconnect(),this._node.connect(i)}GetInputNode(){return this._node}SetParam(i,e,t,s){}GetData(){return{tag:this.GetTag(),index:this.GetIndex(),peak:this._peak,rms:this._rms,binCount:this._node.frequencyBinCount,freqBins:this._freqBins}}}}{const m="touch",d=class extends self.DOMHandler{constructor(e){super(e,m),this.AddRuntimeMessageHandler("request-permission",t=>this._OnRequestPermission(t))}async _OnRequestPermission(e){const t=e.type;let s=!0;t===0?s=await this._RequestOrientationPermission():t===1&&(s=await this._RequestMotionPermission()),this.PostToRuntime("permission-result",{type:t,result:s})}async _RequestOrientationPermission(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;try{return await self.DeviceOrientationEvent.requestPermission()==="granted"}catch(e){return console.warn("[Touch] Failed to request orientation permission: ",e),!1}}async _RequestMotionPermission(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return await self.DeviceMotionEvent.requestPermission()==="granted"}catch(e){return console.warn("[Touch] Failed to request motion permission: ",e),!1}}};self.RuntimeInterface.AddDOMHandlerClass(d)}{let m=function(t,s){if(t){if(s)return Array.from(document.querySelectorAll(t));{const o=document.querySelector(t);return o?[o]:[]}}else return[document.documentElement]},d=function(){};const i="browser",e=class extends self.DOMHandler{constructor(s){super(s,i),this._exportType="",this.AddRuntimeMessageHandlers([["get-initial-state",o=>this._OnGetInitialState(o)],["ready-for-sw-messages",()=>this._OnReadyForSWMessages()],["alert",o=>this._OnAlert(o)],["close",()=>this._OnClose()],["set-focus",o=>this._OnSetFocus(o)],["vibrate",o=>this._OnVibrate(o)],["lock-orientation",o=>this._OnLockOrientation(o)],["unlock-orientation",()=>this._OnUnlockOrientation()],["navigate",o=>this._OnNavigate(o)],["request-fullscreen",o=>this._OnRequestFullscreen(o)],["exit-fullscreen",()=>this._OnExitFullscreen()],["set-hash",o=>this._OnSetHash(o)],["set-document-css-style",o=>this._OnSetDocumentCSSStyle(o)],["get-document-css-style",o=>this._OnGetDocumentCSSStyle(o)]]),window.addEventListener("online",()=>this._OnOnlineStateChanged(!0)),window.addEventListener("offline",()=>this._OnOnlineStateChanged(!1)),window.addEventListener("hashchange",()=>this._OnHashChange()),document.addEventListener("backbutton",()=>this._OnCordovaBackButton())}_OnGetInitialState(s){return this._exportType=s.exportType,{location:location.toString(),isOnline:!!navigator.onLine,referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isConstructArcade:typeof window.is_scirra_arcade<"u"}}_OnReadyForSWMessages(){!window.C3_RegisterSW||!window.OfflineClientInfo||window.OfflineClientInfo.SetMessageCallback(s=>this.PostToRuntime("sw-message",s.data))}_OnOnlineStateChanged(s){this.PostToRuntime("online-state",{isOnline:s})}_OnCordovaBackButton(){this.PostToRuntime("backbutton")}GetNWjsWindow(){return this._exportType==="nwjs"?nw.Window.get():null}_OnAlert(s){alert(s.message)}_OnClose(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}_OnSetFocus(s){const o=s.isFocus;if(this._exportType==="nwjs"){const l=this.GetNWjsWindow();o?l.focus():l.blur()}else o?window.focus():window.blur()}_OnVibrate(s){navigator.vibrate&&navigator.vibrate(s.pattern)}_OnLockOrientation(s){const o=s.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(o).catch(l=>console.warn("[Construct] Failed to lock orientation: ",l));else try{let l=!1;screen.lockOrientation?l=screen.lockOrientation(o):screen.webkitLockOrientation?l=screen.webkitLockOrientation(o):screen.mozLockOrientation?l=screen.mozLockOrientation(o):screen.msLockOrientation&&(l=screen.msLockOrientation(o)),l||console.warn("[Construct] Failed to lock orientation")}catch(l){console.warn("[Construct] Failed to lock orientation: ",l)}}_OnUnlockOrientation(){try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch{}}_OnNavigate(s){const o=s.type;if(o==="back")navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.history.back();else if(o==="forward")window.history.forward();else if(o==="reload")location.reload();else if(o==="url"){const l=s.url,a=s.target,h=s.exportType;self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(l,"_system"):h==="preview"||h==="windows-webview2"?window.open(l,"_blank"):this._isConstructArcade||(a===2?window.top.location=l:a===1?window.parent.location=l:window.location=l)}else if(o==="new-window"){const l=s.url,a=s.tag;self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(l,"_system"):window.open(l,a)}}_OnRequestFullscreen(s){if(this._exportType==="windows-webview2"||this._exportType==="macos-wkwebview")self.RuntimeInterface._SetWrapperIsFullscreenFlag(!0),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!0});else{const o={navigationUI:"auto"},l=s.navUI;l===1?o.navigationUI="hide":l===2&&(o.navigationUI="show");const a=document.documentElement;let h;a.requestFullscreen?h=a.requestFullscreen(o):a.mozRequestFullScreen?h=a.mozRequestFullScreen(o):a.msRequestFullscreen?h=a.msRequestFullscreen(o):a.webkitRequestFullScreen&&(typeof Element.ALLOW_KEYBOARD_INPUT<"u"?h=a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):h=a.webkitRequestFullScreen()),h instanceof Promise&&h.catch(d)}}_OnExitFullscreen(){if(this._exportType==="windows-webview2"||this._exportType==="macos-wkwebview")self.RuntimeInterface._SetWrapperIsFullscreenFlag(!1),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!1});else{let s;document.exitFullscreen?s=document.exitFullscreen():document.mozCancelFullScreen?s=document.mozCancelFullScreen():document.msExitFullscreen?s=document.msExitFullscreen():document.webkitCancelFullScreen&&(s=document.webkitCancelFullScreen()),s instanceof Promise&&s.catch(d)}}_OnSetHash(s){location.hash=s.hash}_OnHashChange(){this.PostToRuntime("hashchange",{location:location.toString()})}_OnSetDocumentCSSStyle(s){const o=s.prop,l=s.value,a=s.selector,h=s["is-all"];try{const y=m(a,h);for(const v of y)o.startsWith("--")?v.style.setProperty(o,l):v.style[o]=l}catch(y){console.warn("[Browser] Failed to set style: ",y)}}_OnGetDocumentCSSStyle(s){const o=s.prop,l=s.selector;try{const a=document.querySelector(l);return a?{isOk:!0,result:window.getComputedStyle(a).getPropertyValue(o)}:{isOk:!1}}catch(a){return console.warn("[Browser] Failed to get style: ",a),{isOk:!1}}}};self.RuntimeInterface.AddDOMHandlerClass(e)}{let o=function(f,u){f(null,u)},l=function(f,u){f(u,null)},a=function(f,u){m[f]=u,self.admob.configRequest(m)},y=function(){return!!d},v=function(f,u,p,w,S,E,T){d||(d={id:f,pubID:u,privacyPolicy:p,showFree:w,showConsent:S,debug:E,debugLocation:T},Object.freeze(d))},g=function(f,u){if(self.cordova.platformId==="android")return f;if(self.cordova.platformId==="ios"){const p=!!e[u];return d.debug&&!s&&p?(console.log("[C3 advert]","USING TEST AD UNITS"),e[u]):f}};const m={};let d=null,i=null;const e={banner:"ca-app-pub-3940256099942544/2934735716",interstitial:"ca-app-pub-3940256099942544/4411468910",rewarded:"ca-app-pub-3940256099942544/1712485313",rewardedInterstitial:"ca-app-pub-3940256099942544/6978759866"},t=5e3;let s=!1;async function h(f,u){return u=typeof u<"u"?u:d.debug,i||(i=new Promise((p,w)=>{document.addEventListener("deviceready",async()=>{try{const S=setTimeout(()=>{p(!1),l(f,"failure to initialize")},t);if(await self.admob.start(),clearTimeout(S),u){const E=await b();a("testDeviceIds",[E])}p(!0)}catch{p(!1),l(f,"Initialization failure")}})}),i)}async function b(){if(self.cordova.platformId==="android")return self.C3AdUtilsMD5(self.device.uuid).toUpperCase();if(self.cordova.platformId==="ios"){const u=await self.cordova.plugins.idfa.getInfo();if(!u.trackingLimited)return s=!0,self.C3AdUtilsMD5(u.idfa).toUpperCase()}}self.C3AdUtils={Success:o,Failure:l,StartAdmobPlus:h,UpdateAdmobPlusRequest:a,SetInitConfigureOptions:v,HasInitConfigurationOptions:y,GetAdUnit:g,get ConfigurationOptions(){return d},get TestId(){return b()}}}{let v=function(b){const g=u=>{this._adLoading=!1,d(b,"banner ad loaded"),document.removeEventListener(h.LOAD,g),document.removeEventListener(h.LOAD_FAIL,f),this._load_settled_promise_resolver&&this._load_settled_promise_resolver()},f=u=>{this._ad=null,this._adLoading=!1,i(b,"banner ad failed to load"),document.removeEventListener(h.LOAD,g),document.removeEventListener(h.LOAD_FAIL,f),this._load_settled_promise_resolver&&this._load_settled_promise_resolver()};this._remove_load_listeners=()=>{document.removeEventListener(h.LOAD,g),document.removeEventListener(h.LOAD_FAIL,f),document.removeEventListener(h.LOAD,g),document.removeEventListener(h.LOAD_FAIL,f)},document.addEventListener(h.LOAD,g),document.addEventListener(h.LOAD_FAIL,f)};const m=self.C3AdUtils,d=m.Success,i=m.Failure,e=0,t=1,s=2,o=3,l=4,a=5,h={get LOAD(){return self.admob.Events.bannerLoad},get LOAD_FAIL(){return self.admob.Events.bannerLoadFail}};class y{constructor(g,f,u,p){if(!g)return i(p,"Unit ID not specified");if(!f)return i(p,"Ad size not specified");if(!u)return i(p,"Ad position not specified");switch(this._adUnitId=g,this._position=u,this._size="",f){case"portrait":{this._size=a;break}case"landscape":{this._size=a;break}case"standard":{this._size=e;break}case"large":{this._size=t;break}case"medium":{this._size=s;break}case"full":{this._size=o;break}case"leaderboard":{this._size=l;break}default:this._size=a}this._ad=null,this._adLoading=!1,this._adShowing=!1,this._remove_load_listeners=null,this._load_settled_promise=null,this._load_settled_promise_resolver=null}Release(){this._remove_load_listeners&&this._remove_load_listeners(),this._remove_load_listeners=null,this._load_settled_promise=null,this._load_settled_promise_resolver=null,this._ad=null}Load(g,f){if(this._ad)return d(f,"banner ad loaded");v.call(this,f);const u={adUnitId:m.GetAdUnit(this._adUnitId,"banner"),size:this._size,position:this._position,offset:0,npa:g==="NON_PERSONALIZED"?"1":"0"};this._ad=new self.admob.BannerAd(u),this._load_settled_promise=new Promise(p=>this._load_settled_promise_resolver=p),this._ad.load()}async Show(g){if(!this._ad)return i(g,"banner ad not created");if(this._adLoading)return i(g,"banner ad still loading");if(this._adShowing)return d(g,"banner ad already shown");await this._ad.show(),this._adShowing=!0,d(g,"banner shown")}async Hide(g){if(!this._ad)return i(g,"banner ad not created");if(this._adLoading)return i(g,"banner ad still loading");if(!this._adShowing)return d(g,"banner ad not being shown");await this._ad.hide(),this._adShowing=!1,d(g,"banner ad hidden")}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}OnLoadSettled(){return this._load_settled_promise}}self.C3BannerAd=y}{let s=function(l){const a=y=>{this._adLoading=!1,this.ResolveLoadPromise(!0),l&&d(l,"interstitial ad load"),document.removeEventListener(e.LOAD,a),document.removeEventListener(e.LOAD_FAIL,h)},h=y=>{this._adLoading=!1,this.ResolveLoadPromise(!1),l&&i(l,"interstitial ad failed to load"),document.removeEventListener(e.LOAD,a),document.removeEventListener(e.LOAD_FAIL,h)};document.addEventListener(e.LOAD,a),document.addEventListener(e.LOAD_FAIL,h)},o=function(l){const a=y=>{this._adShowing=!0,self.C3MobileAdvertsAPI.real.suspendRuntime(),l&&d(l,"interstitial ad show"),document.removeEventListener(e.SHOW,a),document.removeEventListener(e.SHOW_FAIL,h)},h=y=>{this._adShowing=!1,l&&i(l,"interstitial ad failed to show"),document.removeEventListener(e.SHOW,a),document.removeEventListener(e.SHOW_FAIL,h)};document.addEventListener(e.SHOW,a),document.addEventListener(e.SHOW_FAIL,h)};const m=self.C3AdUtils,d=m.Success,i=m.Failure,e={get LOAD(){return self.admob.Events.interstitialLoad},get LOAD_FAIL(){return self.admob.Events.interstitialLoadFail},get SHOW(){return self.admob.Events.interstitialShow},get SHOW_FAIL(){return self.admob.Events.interstitialShowFail},get DISMISS(){return self.admob.Events.interstitialDismiss}};class t{constructor(a,h){if(!a)return i(h,"Unit ID not specified");this._adUnitId=a,this._ad=null,this._adLoading=!1,this._adShowing=!1,this._loadSuccess=!1,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise(),document.addEventListener(e.DISMISS,async y=>{this._adShowing=!1,this._adLoading=!0,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),s.call(this),self.C3MobileAdvertsAPI.real.resumeRuntime(),await this._ad.load()})}GetLoadPromise(){return this._loadPromise?this._loadPromise:(this._loadPromise=new Promise(a=>{this._loadPromiseResolver=a}),this._loadPromise)}ResolveLoadPromise(a){this._loadSuccess=a,this._loadPromiseResolver&&this._loadPromiseResolver(a),this._loadPromise=null,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise()}Load(a,h){const y={adUnitId:m.GetAdUnit(this._adUnitId,"interstitial"),npa:a==="NON_PERSONALIZED"?"1":"0"};this._adLoading=!0,this._adShowing=!1,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),this._ad=new self.admob.InterstitialAd(y),s.call(this,h),this._ad.load()}HandleOnLoadedResult(a,h){a?m.Success(h,"interstitial ad load"):m.Failure(h,"interstitial ad failed to load")}async Show(a){if(!this._ad)return i(a,"interstitial ad not created");if(this._adShowing)return d(a,"interstitial ad already shown");const h=async()=>{this._loadSuccess?(o.call(this,a),await this._ad.show()):(s.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad.load(),await this.GetLoadPromise(),this._loadSuccess?(o.call(this,a),await this._ad.show()):i(a,"interstitial ad failed to load"))};this._adLoading?(await this.GetLoadPromise(),await h()):await h()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}self.C3InterstitialAd=t}{let s=function(l){const a=y=>{this._adLoading=!1,this.ResolveLoadPromise(!0),l&&d(l,"rewarded ad load"),document.removeEventListener(e.LOAD,a),document.removeEventListener(e.LOAD_FAIL,h)},h=y=>{this._adLoading=!1,this.ResolveLoadPromise(!1),l&&i(l,"rewarded ad failed to load"),document.removeEventListener(e.LOAD,a),document.removeEventListener(e.LOAD_FAIL,h)};document.addEventListener(e.LOAD,a),document.addEventListener(e.LOAD_FAIL,h)},o=function(l){const a=b=>{this._adShowing=!0,self.C3MobileAdvertsAPI.real.suspendRuntime()},h=b=>{this._reward=b.reward},y=b=>{this._adShowing=!1,l&&i(l,"rewarded ad failed to show"),document.removeEventListener(e.SHOW,a),document.removeEventListener(e.SHOW_FAIL,y),document.removeEventListener(e.REWARD,h),document.removeEventListener(e.DISMISS,v)},v=b=>{if(this._reward!==null){const g=String(this._reward.type),f=String(this._reward.amount);l&&d(l,JSON.stringify([g,f]))}else l&&i(l,"closed with no reward");this._reward=null,this._adShowing=!1,this._adLoading=!0,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),s.call(this),self.C3MobileAdvertsAPI.real.resumeRuntime(),this._ad.load(),document.removeEventListener(e.SHOW,a),document.removeEventListener(e.SHOW_FAIL,y),document.removeEventListener(e.REWARD,h),document.removeEventListener(e.DISMISS,v)};document.addEventListener(e.SHOW,a),document.addEventListener(e.SHOW_FAIL,y),document.addEventListener(e.REWARD,h),document.addEventListener(e.DISMISS,v)};const m=self.C3AdUtils,d=m.Success,i=m.Failure,e={get LOAD(){return self.admob.Events.rewardedLoad},get LOAD_FAIL(){return self.admob.Events.rewardedLoadFail},get SHOW(){return self.admob.Events.rewardedShow},get SHOW_FAIL(){return self.admob.Events.rewardedShowFail},get DISMISS(){return self.admob.Events.rewardedDismiss},get REWARD(){return self.admob.Events.rewardedReward}};class t{constructor(a,h){if(!a)return i(h,"Unit ID not specified");this._adUnitId=a,this._ad=null,this._adLoading=!1,this._adShowing=!1,this._loadSuccess=!1,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise(),this._reward=null}GetLoadPromise(){return this._loadPromise?this._loadPromise:(this._loadPromise=new Promise(a=>{this._loadPromiseResolver=a}),this._loadPromise)}ResolveLoadPromise(a){this._loadSuccess=a,this._loadPromiseResolver&&this._loadPromiseResolver(a),this._loadPromise=null,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise()}Load(a,h){const y={adUnitId:m.GetAdUnit(this._adUnitId,"rewarded"),npa:a==="NON_PERSONALIZED"?"1":"0"};this._adLoading=!0,this._adShowing=!1,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),this._ad=new self.admob.RewardedAd(y),s.call(this,h),this._ad.load()}HandleOnLoadedResult(a,h){a?m.Success(h,"rewarded ad load"):m.Failure(h,"rewarded ad failed to load")}async Show(a){if(!this._ad)return i(a,"rewarded ad not created");if(this._adShowing)return d(a,"rewarded ad already shown");const h=async()=>{this._loadSuccess?(o.call(this,a),await this._ad.show()):(s.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad.load(),await this.GetLoadPromise(),this._loadSuccess?(o.call(this,a),await this._ad.show()):i(a,"rewarded ad failed to load"))};this._adLoading?(await this.GetLoadPromise(),await h()):await h()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}self.C3RewardedAd=t}{let s=function(l){const a=y=>{this._adLoading=!1,this.ResolveLoadPromise(!0),l&&d(l,"rewarded interstitial ad load"),document.removeEventListener(e.LOAD,a),document.removeEventListener(e.LOAD_FAIL,h)},h=y=>{this._adLoading=!1,this.ResolveLoadPromise(!1),l&&i(l,"rewarded interstitial ad failed to load"),document.removeEventListener(e.LOAD,a),document.removeEventListener(e.LOAD_FAIL,h)};document.addEventListener(e.LOAD,a),document.addEventListener(e.LOAD_FAIL,h)},o=function(l){const a=b=>{this._adShowing=!0,self.C3MobileAdvertsAPI.real.suspendRuntime()},h=b=>{this._reward=b.reward},y=b=>{this._adShowing=!1,l&&i(l,"rewarded interstitial ad failed to show"),document.removeEventListener(e.SHOW,a),document.removeEventListener(e.SHOW_FAIL,y),document.removeEventListener(e.REWARD,h),document.removeEventListener(e.DISMISS,v)},v=b=>{if(this._reward!==null){const g=String(this._reward.type),f=String(this._reward.amount);l&&d(l,JSON.stringify([g,f]))}else l&&i(l,"closed with no reward");this._reward=null,this._adShowing=!1,this._adLoading=!0,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),s.call(this),self.C3MobileAdvertsAPI.real.resumeRuntime(),this._ad.load(),document.removeEventListener(e.SHOW,a),document.removeEventListener(e.SHOW_FAIL,y),document.removeEventListener(e.REWARD,h),document.removeEventListener(e.DISMISS,v)};document.addEventListener(e.SHOW,a),document.addEventListener(e.SHOW_FAIL,y),document.addEventListener(e.REWARD,h),document.addEventListener(e.DISMISS,v)};const m=self.C3AdUtils,d=m.Success,i=m.Failure,e={get LOAD(){return self.admob.Events.rewardedInterstitialLoad},get LOAD_FAIL(){return self.admob.Events.rewardedInterstitialLoadFail},get SHOW(){return self.admob.Events.rewardedInterstitialShow},get SHOW_FAIL(){return self.admob.Events.rewardedInterstitialShowFail},get DISMISS(){return self.admob.Events.rewardedInterstitialDismiss},get REWARD(){return self.admob.Events.rewardedInterstitialReward}};class t{constructor(a,h){if(!a)return i(h,"Unit ID not specified");this._adUnitId=a,this._ad=null,this._adLoading=!1,this._adShowing=!1,this._loadSuccess=!1,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise(),this._reward=null}GetLoadPromise(){return this._loadPromise?this._loadPromise:(this._loadPromise=new Promise(a=>{this._loadPromiseResolver=a}),this._loadPromise)}ResolveLoadPromise(a){this._loadSuccess=a,this._loadPromiseResolver&&this._loadPromiseResolver(a),this._loadPromise=null,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise()}Load(a,h){const y={adUnitId:m.GetAdUnit(this._adUnitId,"rewardedInterstitial"),npa:a==="NON_PERSONALIZED"?"1":"0"};this._adLoading=!0,this._adShowing=!1,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),this._ad=new self.admob.RewardedInterstitialAd(y),s.call(this,h),this._ad.load()}HandleOnLoadedResult(a,h){a?m.Success(h,"rewarded interstitial ad load"):m.Failure(h,"rewarded interstitial ad failed to load")}async Show(a){if(!this._ad)return i(a,"rewarded interstitial ad not created");if(this._adShowing)return d(a,"rewarded interstitial ad already shown");const h=async()=>{this._loadSuccess?(o.call(this,a),await this._ad.show()):(s.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad.load(),await this.GetLoadPromise(),this._loadSuccess?(o.call(this,a),await this._ad.show()):i(a,"rewarded interstitial ad failed to load"))};this._adLoading?(await this.GetLoadPromise(),await h()):await h()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}self.C3RewardedInterstitialAd=t}{let b=function(){switch(this._consentStatusIndex){case l:return!0;case o:return!1;case a:return!1;case s:return!0}},g=function(){switch(this._consentStatusIndex){case l:return this._adPersonalization="NON_PERSONALIZED";case o:return this._adPersonalization="PERSONALIZED";case a:return this._adPersonalization="PERSONALIZED";case s:return this._adPersonalization="NON_PERSONALIZED"}};const m=self.C3AdUtils,d=m.Success,i=m.Failure,e=self.cordova?self.cordova.platformId==="ios":!1,t=self.cordova?self.cordova.platformId==="android":!1,s=0,o=2,l=1,a=3;class h{constructor(){this._adPersonalization="UNKNOWN",this._inEEAorUnknown="",this._consentStatusIndex=0,this._consentStatusString="UNKNOWN",this._trackingStatusString="not-determined",this._hasConsentForm=!1}async Reset(){m.ConfigurationOptions.debug&&await self.consent.reset()}GetAdPersonalization(){return this._adPersonalization}async RequestTrackingAuthorization(){e&&await self.admob.requestTrackingAuthorization()}async GetTrackingAuthorizationStatus(){if(t)return this._trackingStatusString="not-determined";const S=self.cordova.plugins.idfa,E=await S.getInfo();if(!E.trackingLimited)return this._trackingStatusString="authorized";switch(E.trackingPermission){case S.TRACKING_PERMISSION_NOT_DETERMINED:return this._trackingStatusString="not-determined";case S.TRACKING_PERMISSION_RESTRICTED:return this._trackingStatusString="denied";case S.TRACKING_PERMISSION_DENIED:return this._trackingStatusString="denied";case S.TRACKING_PERMISSION_AUTHORIZED:return this._trackingStatusString="authorized"}}async RequestIDFA(S){if(t)return d(S,"not-determined");if(e)return await f.call(this),this._inEEAorUnknown==="true"?await this.RequestTrackingAuthorization():(await this.GetTrackingAuthorizationStatus(),this._trackingStatusString==="not-determined"&&(await y.call(this),this._hasConsentForm?await this.ShowIDFAMessage():await this.RequestTrackingAuthorization())),await this.GetTrackingAuthorizationStatus(),d(S,this._trackingStatusString)}async RequestInfoUpdateForTesting(S,E,T){return await p.call(this,S,E,C=>{C?typeof C=="object"?i(T,C.message):i(T,C):i(T,"requestInfoUpdate error")})}async RequestInfoUpdateForTestingSkipErrors(S,E,T){await p.call(this,S,E)}async ShowConsentForm(S,E=!1){switch(await v.call(this),S){case"eu":{const T=await y.call(this);b.call(this)&&T&&await(await self.consent.loadForm()).show();break}case"always":{const T=await y.call(this),N=await f.call(this);T&&N==="true"?await(await self.consent.loadForm()).show():T&&E&&await(await self.consent.loadForm()).show();break}}await v.call(this),await f.call(this),await g.call(this)}async ShowIDFAMessage(S){await this.ShowConsentForm("always",!0)}async UpdateConsentStatus(){await v.call(this),await f.call(this),await g.call(this)}async SuccessResponse(S){await this.GetTrackingAuthorizationStatus(),d(S,`${this._consentStatusString}&&${this._trackingStatusString}&&${this._inEEAorUnknown}`)}async FailureResponse(S,E){i(S,E)}async StatusUpdateSuccessResponse(S){await this.UpdateConsentStatus(),await this.GetTrackingAuthorizationStatus(),d(S,`${this._consentStatusString}&&${this._trackingStatusString}&&${this._inEEAorUnknown}`)}}async function y(){const w=await self.consent.getFormStatus();return this._hasConsentForm=w===self.consent.FormStatus.Available,this._hasConsentForm}async function v(){const w=await self.consent.getConsentStatus();switch(this._consentStatusIndex=w,this._consentStatusIndex){case l:return this._consentStatusString="REQUIRED";case o:return this._consentStatusString="NOT_REQUIRED";case a:return this._consentStatusString="OBTAINED";case s:return this._consentStatusString="UNKNOWN"}}async function f(){if(t)switch(this._consentStatusIndex){case l:return this._inEEAorUnknown="true";case o:return this._inEEAorUnknown="false";case a:return this._inEEAorUnknown="true";case s:return this._inEEAorUnknown="true"}if(e)return await u.call(this,"IABTCF_gdprApplies","getInt")?this._inEEAorUnknown="true":this._inEEAorUnknown="false"}async function u(w,S){return new Promise((E,T)=>{self.NativeStorage[S](w,N=>E(N),N=>E(1))})}async function p(w,S,E){let T="",N=null;if(w){switch(S){case"EEA":{T=self.consent.DebugGeography.EEA;break}case"NOT_EEA":{T=self.consent.DebugGeography.NotEEA;break}default:{T=self.consent.DebugGeography.Disabled;break}}N=[await m.TestId]}try{return w?await self.consent.requestInfoUpdate({debugGeography:T,testDeviceIds:N}):await self.consent.requestInfoUpdate(),!0}catch(C){return E&&E(C),!1}}self.C3Consent=new h}{const m=(g,f)=>{let u=g[0],p=g[1],w=g[2],S=g[3];u=i(u,p,w,S,f[0],7,-680876936),S=i(S,u,p,w,f[1],12,-389564586),w=i(w,S,u,p,f[2],17,606105819),p=i(p,w,S,u,f[3],22,-1044525330),u=i(u,p,w,S,f[4],7,-176418897),S=i(S,u,p,w,f[5],12,1200080426),w=i(w,S,u,p,f[6],17,-1473231341),p=i(p,w,S,u,f[7],22,-45705983),u=i(u,p,w,S,f[8],7,1770035416),S=i(S,u,p,w,f[9],12,-1958414417),w=i(w,S,u,p,f[10],17,-42063),p=i(p,w,S,u,f[11],22,-1990404162),u=i(u,p,w,S,f[12],7,1804603682),S=i(S,u,p,w,f[13],12,-40341101),w=i(w,S,u,p,f[14],17,-1502002290),p=i(p,w,S,u,f[15],22,1236535329),u=e(u,p,w,S,f[1],5,-165796510),S=e(S,u,p,w,f[6],9,-1069501632),w=e(w,S,u,p,f[11],14,643717713),p=e(p,w,S,u,f[0],20,-373897302),u=e(u,p,w,S,f[5],5,-701558691),S=e(S,u,p,w,f[10],9,38016083),w=e(w,S,u,p,f[15],14,-660478335),p=e(p,w,S,u,f[4],20,-405537848),u=e(u,p,w,S,f[9],5,568446438),S=e(S,u,p,w,f[14],9,-1019803690),w=e(w,S,u,p,f[3],14,-187363961),p=e(p,w,S,u,f[8],20,1163531501),u=e(u,p,w,S,f[13],5,-1444681467),S=e(S,u,p,w,f[2],9,-51403784),w=e(w,S,u,p,f[7],14,1735328473),p=e(p,w,S,u,f[12],20,-1926607734),u=t(u,p,w,S,f[5],4,-378558),S=t(S,u,p,w,f[8],11,-2022574463),w=t(w,S,u,p,f[11],16,1839030562),p=t(p,w,S,u,f[14],23,-35309556),u=t(u,p,w,S,f[1],4,-1530992060),S=t(S,u,p,w,f[4],11,1272893353),w=t(w,S,u,p,f[7],16,-155497632),p=t(p,w,S,u,f[10],23,-1094730640),u=t(u,p,w,S,f[13],4,681279174),S=t(S,u,p,w,f[0],11,-358537222),w=t(w,S,u,p,f[3],16,-722521979),p=t(p,w,S,u,f[6],23,76029189),u=t(u,p,w,S,f[9],4,-640364487),S=t(S,u,p,w,f[12],11,-421815835),w=t(w,S,u,p,f[15],16,530742520),p=t(p,w,S,u,f[2],23,-995338651),u=s(u,p,w,S,f[0],6,-198630844),S=s(S,u,p,w,f[7],10,1126891415),w=s(w,S,u,p,f[14],15,-1416354905),p=s(p,w,S,u,f[5],21,-57434055),u=s(u,p,w,S,f[12],6,1700485571),S=s(S,u,p,w,f[3],10,-1894986606),w=s(w,S,u,p,f[10],15,-1051523),p=s(p,w,S,u,f[1],21,-2054922799),u=s(u,p,w,S,f[8],6,1873313359),S=s(S,u,p,w,f[15],10,-30611744),w=s(w,S,u,p,f[6],15,-1560198380),p=s(p,w,S,u,f[13],21,1309151649),u=s(u,p,w,S,f[4],6,-145523070),S=s(S,u,p,w,f[11],10,-1120210379),w=s(w,S,u,p,f[2],15,718787259),p=s(p,w,S,u,f[9],21,-343485551),g[0]=b(u,g[0]),g[1]=b(p,g[1]),g[2]=b(w,g[2]),g[3]=b(S,g[3])},d=(g,f,u,p,w,S)=>(f=b(b(f,g),b(p,S)),b(f<<w|f>>>32-w,u)),i=(g,f,u,p,w,S,E)=>d(f&u|~f&p,g,f,w,S,E),e=(g,f,u,p,w,S,E)=>d(f&p|u&~p,g,f,w,S,E),t=(g,f,u,p,w,S,E)=>d(f^u^p,g,f,w,S,E),s=(g,f,u,p,w,S,E)=>d(u^(f|~p),g,f,w,S,E),o=g=>{const f=g.length,u=[1732584193,-271733879,-1732584194,271733878];let p;for(p=64;p<=g.length;p+=64)m(u,l(g.substring(p-64,p)));g=g.substring(p-64);const w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(p=0;p<g.length;p++)w[p>>2]|=g.charCodeAt(p)<<(p%4<<3);if(w[p>>2]|=128<<(p%4<<3),p>55)for(m(u,w),p=0;p<16;p++)w[p]=0;return w[14]=f*8,m(u,w),u},l=g=>{const f=[];for(let u=0;u<64;u+=4)f[u>>2]=g.charCodeAt(u)+(g.charCodeAt(u+1)<<8)+(g.charCodeAt(u+2)<<16)+(g.charCodeAt(u+3)<<24);return f},a="0123456789abcdef".split(""),h=g=>{let f="";for(let u=0;u<4;u++)f+=a[g>>u*8+4&15]+a[g>>u*8&15];return f},y=g=>{for(let f=0;f<g.length;f++)g[f]=h(g[f]);return g.join("")},v=g=>y(o(g));let b=(g,f)=>g+f&4294967295;v("hello")!="5d41402abc4b2a76b9719d911017c592",self.C3AdUtilsMD5=v}{const m=self.C3AdUtils,d=self.C3Consent,i=self.C3BannerAd,e=self.C3InterstitialAd,t=self.C3RewardedAd,s=self.C3RewardedInterstitialAd;let o=null,l=null,a=null,h=null,y=null;const v={},b=(g,f)=>{v[g]=f};b("CreateBannerAdvert",async(g,f,u,p,w,S)=>{if(!await m.StartAdmobPlus(S,u))return;w&&o&&(await o.OnLoadSettled(),await o.Hide(()=>!0),o.Release(),o=null);const E=await d.GetAdPersonalization();o||(o=new i(g,f,p,S)),o.Load(E,S)}),b("ShowBannerAdvert",async g=>{if(!o)return m.Failure(g,"banner ad not created");o.Show(g)}),b("HideBannerAdvert",async g=>{if(!o)return m.Failure(g,"banner ad not created");o.Hide(g)}),b("CreateInterstitialAdvert",async(g,f,u)=>{if(l){if(l.IsShowing())return m.Success(u,"interstitial ad already showing");if(l.IsLoading()){const w=await l.GetLoadPromise();l.HandleOnLoadedResult(w,u)}else{const w=await d.GetAdPersonalization();l.Load(w,u)}return}if(!await m.StartAdmobPlus(u,f))return;const p=await d.GetAdPersonalization();l=new e(g,u),l.Load(p,u)}),b("ShowInterstitialAdvert",async g=>{if(!l)return m.Failure(g,"interstitial ad not created");l.Show(g)}),b("CreateVideoAdvert",async(g,f,u)=>{if(a||h){if(h){if(h.IsShowing())return m.Success(u,"rewarded ad already showing");if(h.IsLoading()){const w=await h.GetLoadPromise();h.HandleOnLoadedResult(w,u)}else{const w=await d.GetAdPersonalization();h.Load(w,u)}return}if(a){if(a.IsShowing())return m.Success(u,"rewarded ad already showing");if(a.IsLoading()){const w=await a.GetLoadPromise();a.HandleOnLoadedResult(w,u)}else{const w=await d.GetAdPersonalization();a.Load(w,u)}return}}if(!await m.StartAdmobPlus(u,f))return;const p=await d.GetAdPersonalization();a=new t(g,u),a.Load(p,u)}),b("ShowVideoAdvert",async g=>{if(!a)return m.Failure(g,"video ad not created");a.Show(g)}),b("CreateRewardedAdvert",async(g,f,u)=>{if(h||a){if(h){if(h.IsShowing())return m.Success(u,"rewarded ad already showing");if(h.IsLoading()){const w=await h.GetLoadPromise();h.HandleOnLoadedResult(w,u)}else{const w=await d.GetAdPersonalization();h.Load(w,u)}return}if(a){if(a.IsShowing())return m.Success(u,"rewarded ad already showing");if(a.IsLoading()){const w=await a.GetLoadPromise();a.HandleOnLoadedResult(w,u)}else{const w=await d.GetAdPersonalization();a.Load(w,u)}return}}if(!await m.StartAdmobPlus(u,f))return;const p=await d.GetAdPersonalization();h=new t(g,u),h.Load(p,u)}),b("ShowRewardedAdvert",async g=>{if(!h)return m.Failure(g,"rewarded ad not created");h.Show(g)}),b("CreateRewardedInterstitialAdvert",async(g,f,u)=>{if(y){if(y.IsShowing())return m.Success(u,"rewarded interstitial ad already showing");if(y.IsLoading()){const w=await y.GetLoadPromise();y.HandleOnLoadedResult(w,u)}else{const w=await d.GetAdPersonalization();y.Load(w,u)}return}if(!await m.StartAdmobPlus(u,f))return;const p=await d.GetAdPersonalization();y=new s(g,u),y.Load(p,u)}),b("ShowRewardedInterstitialAdvert",async g=>{if(!y)return m.Failure(g,"rewarded interstitial ad not created");y.Show(g)}),b("Configure",async(g,f,u,p,w,S,E,T,N)=>{const C=!m.HasInitConfigurationOptions();if(m.SetInitConfigureOptions(g,f,u,p,w,S,E),!await m.StartAdmobPlus(N,S))return d.FailureResponse(N,"failure to initialize");if(C&&await d.Reset(),!await d.RequestInfoUpdateForTesting(S,E,N))return d.FailureResponse(N,"failure to update consent information");C?T?await d.ShowConsentForm("eu"):await d.UpdateConsentStatus():await d.ShowConsentForm("always"),await d.SuccessResponse(N)}),b("RequestConsent",async g=>{v.Configure(m.ConfigurationOptions.id,m.ConfigurationOptions.pubID,m.ConfigurationOptions.privacyPolicy,m.ConfigurationOptions.showFree,"always",m.ConfigurationOptions.debug,m.ConfigurationOptions.debugLocation,!1,g)}),b("SetMaxAdContentRating",async(g,f)=>{if(await m.StartAdmobPlus(f)){if(!g)return m.Failure(f,"Label not specified");try{m.UpdateAdmobPlusRequest("maxAdContentRating",g),m.Success(f,"")}catch{m.Failure(f,"invalid label")}}}),b("TagForChildDirectedTreatment",async(g,f)=>{if(await m.StartAdmobPlus(f))try{m.UpdateAdmobPlusRequest("tagForChildDirectedTreatment",g===1),m.Success(f,"")}catch{m.Failure(f,"invalid label")}}),b("TagForUnderAgeOfConsent",async(g,f)=>{if(await m.StartAdmobPlus(f))try{m.UpdateAdmobPlusRequest("tagForUnderAgeOfConsent",g===1),m.Success(f,"")}catch{m.Failure(f,"invalid label")}}),b("RequestIDFA",async g=>{await m.StartAdmobPlus(g)&&d.RequestIDFA(g)}),b("StatusUpdate",async(g,f,u)=>{if(!await m.StartAdmobPlus(u,g))return d.FailureResponse(u,"failure to initialize");await d.RequestInfoUpdateForTestingSkipErrors(g,f,u),await d.StatusUpdateSuccessResponse(u)}),self.C3MobileAdvertsAPI||(self.C3MobileAdvertsAPI={}),self.C3MobileAdvertsAPI.real=v}{let h=function(y,v){const b=v.slice(0,-1),g=v[v.length-1];return console.log(y,b),[b,g]};const m="PERSONALIZED",d={},i=(y,v)=>d[y]=v,e=y=>new Promise(v=>setTimeout(v,y));let t=null,s=null,o=null,l=null,a=null;i("CreateBannerAdvert",async(...y)=>{const[v,b]=h("CreateBannerAdvert",y);await e(50),t?b("Banner already exists"):(t="ready",b(null,"Created banner"))}),i("ShowBannerAdvert",async(...y)=>{const[v,b]=h("ShowBannerAdvert",y);await e(50),t!="ready"?b("Banner cannot be shown"):(t="shown",b(null,"Showed banner"))}),i("HideBannerAdvert",async(...y)=>{const[v,b]=h("HideBannerAdvert",y);await e(50),t!="shown"?b("Banner cannot be hidden"):(t=null,b(null,"Hid banner"))}),i("CreateInterstitialAdvert",async(...y)=>{const[v,b]=h("CreateInterstitialAdvert",y);await e(50),s?b("Intersitial already exists"):(s="ready",b(null,"Created interstitial"))}),i("ShowInterstitialAdvert",async(...y)=>{const[v,b]=h("ShowInterstitialAdvert",y);await e(50),s!="ready"?b("Cannot show interstitial"):(s=null,b(null,"Interstitial shown"))}),i("CreateVideoAdvert",async(...y)=>{const[v,b]=h("CreateVideoAdvert",y);await e(50),o?b("Video already exists"):(o="ready",b(null,"Created video"))}),i("ShowVideoAdvert",async(...y)=>{const[v,b]=h("ShowVideoAdvert",y);await e(50),o!="ready"?b("Cannot show video"):(o=null,b(null,'["example type", 20]'))}),i("CreateRewardedAdvert",async(...y)=>{const[v,b]=h("CreateRewardedAdvert",y);await e(50),l?b("Rewarded already exists"):(l="ready",b(null,"Created rewarded"))}),i("ShowRewardedAdvert",async(...y)=>{const[v,b]=h("ShowRewardedAdvert",y);await e(50),l!="ready"?b("Cannot show rewarded"):(l=null,b(null,'["example type", 20]'))}),i("CreateRewardedInterstitialAdvert",async(...y)=>{const[v,b]=h("CreateRewardedInterstitialAdvert",y);await e(50),a?b("Rewarded intersitial already exists"):(a="ready",b(null,"Created rewarded interstitial"))}),i("ShowRewardedInterstitialAdvert",async(...y)=>{const[v,b]=h("ShowRewardedInterstitialAdvert",y);await e(50),a!="ready"?b("Cannot show rewarded interstitial"):(a=null,b(null,"Rewarded interstitial shown"))}),i("Configure",async(...y)=>{const[v,b]=h("Configure",y);await e(50),b(null,m+"&&true")}),i("RequestConsent",async(...y)=>{const[v,b]=h("RequestConsent",y);await e(50),b(null,m+"&&true")}),i("RequestIDFA",async(...y)=>{const[v,b]=h("RequestIDFA",y);await e(50),b(null,"authorized")}),self.C3MobileAdvertsAPI||(self.C3MobileAdvertsAPI={}),self.C3MobileAdvertsAPI.fake=d}{const m=self.C3AdUtils,d={},i=(a,h)=>{d[a]=h};let e=!1,t=null;const s=async a=>d.webAdsScriptLoaded?(e||(self.adsbygoogle=self.adsbygoogle||[],self.adBreak=self.adConfig=h=>self.adsbygoogle.push(h),e=!0),t||(t=new Promise((h,y)=>{self.adConfig({preloadAdBreaks:"on",onReady:()=>h(!0)})}),t)):(m.Failure(a,"advert script not loaded, likely blocked by an ad blocker"),!1),o=()=>{d.suspendRuntime&&d.suspendRuntime()},l=()=>{d.resumeRuntime&&d.resumeRuntime()};i("CreateBannerAdvert",async(a,h,y,v,b,g)=>{m.Failure(g,"banner ads not supported in web platform")}),i("ShowBannerAdvert",async a=>{m.Failure(a,"banner ads not supported in web platform")}),i("HideBannerAdvert",async a=>{m.Failure(a,"banner ads not supported in web platform")}),i("CreateInterstitialAdvert",async(a,h,y)=>{await s(y)&&m.Success(y,"interstitial ad created")}),i("ShowInterstitialAdvert",async a=>{await s(a)&&self.adBreak({type:"next",beforeAd:()=>o(),afterAd:()=>l(),adBreakDone:h=>{switch(h.breakStatus){case"viewed":case"dismissed":{m.Success(a,"interstitial ad show");break}default:console.table(h),m.Failure(a,"interstitial ad failed to show")}}})}),i("CreateVideoAdvert",async(a,h,y)=>{m.Failure(y,"video ads are deprecated")}),i("ShowVideoAdvert",async a=>{m.Failure(a,"video ads are deprecated")}),i("CreateRewardedAdvert",async(a,h,y)=>{await s(y)&&m.Success(y,"rewarded ad created")}),i("ShowRewardedAdvert",async a=>{await s(a)&&self.adBreak({type:"reward",beforeAd:()=>o(),afterAd:()=>l(),adBreakDone:h=>{switch(h.breakStatus){case"viewed":case"dismissed":{m.Success(a,"rewarded ad show");break}case"ignored":{m.Failure(a,"rewarded ad ignored");break}default:console.table(h),m.Failure(a,"rewarded ad failed to show")}},beforeReward:h=>{h()},adDismissed:()=>{m.Failure(a,"closed with no reward")},adViewed:()=>{m.Success(a,JSON.stringify(["Reward",1]))}})}),i("CreateRewardedInterstitialAdvert",async(a,h,y)=>{await s(y)&&m.Success(y,"rewarded interstitial ad created")}),i("ShowRewardedInterstitialAdvert",async a=>{await s(a)&&self.adBreak({type:"reward",beforeAd:()=>o(),afterAd:()=>l(),adBreakDone:h=>{switch(h.breakStatus){case"viewed":case"dismissed":{m.Success(a,"rewarded interstitial ad show");break}case"ignored":{m.Failure(a,"rewarded interstitial ad ignored");break}default:console.table(h),m.Failure(a,"rewarded interstitial ad failed to show")}},beforeReward:h=>{h()},adDismissed:()=>{m.Failure(a,"closed with no reward")},adViewed:()=>{m.Success(a,JSON.stringify(["Reward",1]))}})}),i("Configure",async(a,h,y,v,b,g,f,u,p)=>{d.webAdsScriptLoaded?m.Success(p,"UNKNOWN&&not-determined&&true"):m.Failure(p,"advert script not loaded, likely blocked by an ad blocker")}),i("RequestConsent",async a=>{m.Success(a,"UNKNOWN&&not-determined&&true")}),i("SetMaxAdContentRating",async(a,h)=>{m.Failure(h,"setting max ad content rating not supported in web platform")}),i("TagForChildDirectedTreatment",async(a,h)=>{m.Failure(h,"tagging for children not supported in web platform")}),i("TagForUnderAgeOfConsent",async(a,h)=>{m.Failure(h,"tagging for under age of consent not supported in web platform")}),i("RequestIDFA",async a=>{m.Success(a,"not-determined")}),i("StatusUpdate",async(a,h,y)=>{m.Success(y,"UNKNOWN&&not-determined&&true")}),self.C3MobileAdvertsAPI||(self.C3MobileAdvertsAPI={}),self.C3MobileAdvertsAPI.web=d}{const m="advert";let d=!1;const i=class extends self.DOMHandler{constructor(t){super(t,m);const s=l=>[l,a=>this._CallMethod(l,a)],o=l=>[l,a=>this._AddScript(a[0],a[1])];this.AddRuntimeMessageHandlers([s("CreateBannerAdvert"),s("ShowBannerAdvert"),s("HideBannerAdvert"),s("CreateInterstitialAdvert"),s("ShowInterstitialAdvert"),s("CreateVideoAdvert"),s("ShowVideoAdvert"),s("CreateRewardedAdvert"),s("ShowRewardedAdvert"),s("CreateRewardedInterstitialAdvert"),s("ShowRewardedInterstitialAdvert"),s("Configure"),s("RequestConsent"),s("SetUserPersonalisation"),s("SetMaxAdContentRating"),s("TagForChildDirectedTreatment"),s("TagForUnderAgeOfConsent"),s("RequestIDFA"),s("StatusUpdate"),o("AddScript")])}_GetApi(){if(self.cordova)return self.C3MobileAdvertsAPI.real;if(!self.cordova)return self.C3MobileAdvertsAPI.web}_SuspendRuntime(){this.GetRuntimeInterface().PostToRuntimeComponent("runtime","visibilitychange",{hidden:!0})}_ResumeRuntime(){this.GetRuntimeInterface().PostToRuntimeComponent("runtime","visibilitychange",{hidden:!1})}async _CallMethod(t,s){const o=this._GetApi();if(o.suspendRuntime||(o.suspendRuntime=()=>this._SuspendRuntime()),o.resumeRuntime||(o.resumeRuntime=()=>this._ResumeRuntime()),!o)throw d||(d=!0,console.warn("The Mobile Advert plugin is not loaded. Please note that it only works in Android or iOS exports")),new Error("advert plugin not loaded");return new Promise((l,a)=>{const h=o[t];h(...s,(y,v)=>{y?a(y):l(v)})})}async _AddScript(t,s=null){const o=this._GetApi();return o.webAdsScriptLoaded=!1,new Promise((l,a)=>{const h=document.createElement("script");if(s)for(let y in s)h.setAttribute(y,s[y]);h.onload=function(){o.webAdsScriptLoaded=!0,l()},h.onerror=function(v){o.webAdsScriptLoaded=!1,l()},h.src=t,document.head.appendChild(h)})}};self.RuntimeInterface.AddDOMHandlerClass(i)}window.C3_RegisterSW=async function(){if(navigator.serviceWorker)try{const d=await navigator.serviceWorker.register("sw.js",{scope:"./"});console.info("Registered service worker on "+d.scope)}catch(d){console.warn("Failed to register service worker: ",d)}};
