import{_ as R}from"./dHzXw_au.js";import{d as B,e as m,i as L,u as j,l as q,m as z,j as F,k as G,b as H,r as K,f as Y,D as Z,o as W,x as J,y as Q,a as t,n as E,g as i,w as y,v as b,h as x,z as I,U as V,B as X}from"./e6MoXQDD.js";import{u as ee}from"./fgFIniLu.js";import{s as te}from"./DaKhLqBn.js";import{r as A}from"./C9R-i3qr.js";import"./D2ZKPdBb.js";const se={class:"relative w-1/2 max-w-[300px] mt-8"},ne={class:"flex items-center justify-center"},ae=["disabled"],ie={class:"p-auto m-auto"},oe={class:"flex items-center justify-center"},re={class:"mt-2"},le={class:"text-gray-400 mt-2 -mb-2"},ue=["disabled"],ye=B({__name:"email",setup(de){const a=m(),d=m(),p=m(!0),f=m(!0),{$client:w}=L(),{GMAIL_VERIFY_NUM_CNT:D,TOAST_SUCCESS_TIMEOUT:M,TOAST_WARNING_TIMEOUT:c,TOAST_ERROR_TIMEOUT:_,AUTH_CODE_LIMIT_TIME:N}=j().public.CONSTANTS,h=q(),C=z(),O=F(),T=G(),r=H(),k=m(),o=K({isPending:!1,startCntDown:!1}),g=s=>{if(!a.value||!d.value)return;const e=!V.chckIsValidateEmail(a.value.value);p.value=e,s.key==="Enter"&&v()},S=()=>{if(!a.value||!d.value)return;const s=!(d.value.value.length>=D);f.value=s},v=async(s=!1)=>{if(!a.value||o.isPending)return;const e=a.value.value.trim();if(!e){r.warning("이메일을 적어주세요",{timeout:c});return}o.isPending=!0;const n=await w.auth.sendEmailCode.mutate({email:e,sendAnotherOne:s});if(console.log("data: ",n),o.isPending=!1,!n){r.error("데이터를 가져오는 도중 에러가 났어요. 잠시 후에 다시 시도해주세요",{timeout:_});return}if(n.message==="none"){r.warning("이메일을 적어주세요",{timeout:c});return}if(n.isOverlapped){n.message==="email"&&r.warning(`${e} 이미 가입되어있는 이메일이에요`,{timeout:c}),n.message==="token"&&O.show({msg:`
                    이미 코드를 보낸 이메일입니다.
                    그래도 다시 보내시겠습니까?
                    아니면 기존에 보냈던 코드로 인증하시겠습니까?
                `,btn:"yesno",btnOpt:{txt:{yesno:["코드 새로 발급","기존 코드 활용해서 인증"]},isToggleMenu:!1},onYes:async()=>{T.show({msg:"다시 코드를 보내는 중..."}),await v(!0),T.hide()}}),n.message==="quarantined"&&r.error("많은 인증 횟수로 인하여 1시간 후에 다시 시도해주세요",{timeout:_});return}o.startCntDown=!0,P(N/1e3,k.value),r.success("코드를 보냈어요! 메일을 확인해주세요",{timeout:M})},U=async()=>{if(!a.value||!d.value)return;const s=a.value.value,e=d.value.value;await w.auth.verifyEmail.mutate({email:s,code:e})?C.push({path:"/auth/info",query:{email:s}}):r.warning("코드가 맞지 않아요 다시 확인해주세요",{timeout:c})},$=()=>{if(!a.value)return;const s=a.value.value;if(!s||!V.chckIsValidateEmail(s)){r.warning("본인 이메일만 써주고 다시 눌러주세요!",{timeout:c});return}C.push({path:"/auth/info",query:{email:s}})},P=(s,e)=>{let n=s,l,u;te(function(){l=parseInt((n/60).toString(),10),u=parseInt((n%60).toString(),10),l=l<10?"0"+l:l,u=u<10?"0"+u:u,e.textContent=l+":"+u,--n<0&&(n=s)},1e3)};return Y(async()=>{ee().mountedGoogle("google-signup-btn",async s=>{console.log("result from register email: ",s)},{text:"signup_with"}),setTimeout(()=>{a.value&&h.query.email&&(a.value.value=h.query.email,g({}))},1)}),Z({title:"Register"}),(s,e)=>{const n=R,l=X;return W(),J(l,{name:"auth"},{default:Q(()=>[t("div",se,[e[2]||(e[2]=t("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3.5 pointer-events-none"},[t("svg",{class:"w-4 h-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 16"},[t("path",{d:"m10.036 8.278 9.258-7.79A1.979 1.979 0 0 0 18 0H2A1.987 1.987 0 0 0 .641.541l9.395 7.737Z"}),t("path",{d:"M11.241 9.817c-.36.275-.801.425-1.255.427-.428 0-.845-.138-1.187-.395L0 2.6V14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2.5l-8.759 7.317Z"})])],-1)),t("div",ne,[t("input",{ref_key:"$email",ref:a,type:"text",id:"email-address-icon",class:"bg-gray-50 border border-gray-300 text-sm rounded-lg text-black focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5",placeholder:"id@email.com",onChange:g,onKeyup:g},null,544),t("button",{class:E(["rounded-lg text-sm text-center p-auto text-white flex flex-none items-center justify-center px-2 py-2.5 ml-0.5",i(p)?"cursor-default bg-gray-700":"cursor-pointer bg-blue-700 hover:bg-blue-800"]),disabled:i(p)||i(o).isPending,onClick:e[0]||(e[0]=u=>v())},[y(t("div",ie,[x(n,{w:6,h:6})],512),[[b,i(o).isPending]]),y(t("div",oe,[e[1]||(e[1]=t("div",null,"보내기",-1)),x(i(A),{class:"h-6 w-6"})],512),[[b,!i(o).isPending]])],10,ae)])]),t("div",re,[t("input",{ref_key:"$verificationInput",ref:d,type:"text",id:"verification-code",class:"text-center bg-gray-50 border border-gray-300 text-sm text-gray-500 rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:"메일 인증 코드",onChange:S,onKeyup:S},null,544)]),y(t("div",le,[e[3]||(e[3]=I(" 코드 만료까지 ")),t("span",{ref_key:"$timer",ref:k,class:"text-gray-200"},null,512),e[4]||(e[4]=I(" 남음 "))],512),[[b,i(o).startCntDown]]),t("button",{class:E(["w-1/3 mt-8 max-w-[500px] text-white font-medium rounded-lg text-sm px-5 py-2.5 text-center",i(f)?"bg-gray-700":"bg-blue-700 hover:bg-blue-800"]),disabled:i(f)||i(o).isPending,onClick:U}," 다음 ",10,ue),t("span",{"data-popover-target":"auth-email-popover",class:"mt-4 cursor-pointer flex items-center justify-center",onClick:$},[e[5]||(e[5]=t("div",null," 나중에 인증 (skip) ",-1)),x(i(A),{class:"h-6 w-6 text-gray-500"})]),e[6]||(e[6]=t("div",{"data-popover":"",id:"auth-email-popover",role:"tooltip",class:"absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0"},[t("div",{class:"px-3 py-2 border-b border-gray-200 rounded-lg"},[t("h3",{class:"font-semibold text-gray-700 text-center"},"메일만 쓰고 이 버튼을 누르면 인증을 나중에 합니다")]),t("div",{"data-popper-arrow":""})],-1))]),_:1})}}});export{ye as default};
